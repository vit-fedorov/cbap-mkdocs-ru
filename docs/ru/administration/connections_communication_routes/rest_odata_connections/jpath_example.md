---
title: HTTP-запросы. Обработка данных с помощью JSONPath
kbTitle: HTTP-запросы. Получение и обработка данных с помощью JSONPath. Настройка подключения, пути передачи данных и сценария
kbId: 5084
tags:
    - JSON
    - JSONPath
    - JPath
    - интеграции
    - HTTP-запрос
hide: tags
---

# HTTP-запросы. Получение и обработка данных с помощью JSONPath {# http_receive_jpath }

## Введение

**{{ productName }}** позволяет использовать JSONPath и XPath для обработки полученных HTTP-запросов в соответствующем формате.

JSONPath — язык запросов к базам данных и информационно-поисковым системам для работы с данными в формате JSON. Аналогичен XPath для работы с данными в формате XML.

Здесь представлен пример настройки подключения, пути передачи данных и сценария для обработки ответа на HTTP-запрос с помощью JSONPath и записи данных в атрибуты шаблона записи.

Настройка с использованием XPath будет аналогичной.

## Прикладная задача

- Имеется шаблон записи _«Картотека»_, в котором хранятся данные о книгах.
- Имеется внешний сервер, выдающий в ответ на HTTP-запрос данные о книгах в формате JSON, например:

    ``` json
    {
        "Date": "17.10.2024",
        "Books": [
            {
                "Author": "Толстой Л. Н.",
                "Title": "Война и мир",
                "Price": 895
            },
            {
                "Author": "Пушкин А. С.",
                "Title": "Капитанская дочка",
                "Price": 499
            },
            {
                "Author": "Лермонтов М. Ю.",
                "Title": "Мцыри",
                "Price": 372
            }
        ]
    }
    ```

- Требуется настроить кнопку, загружающую данные о книгах с внешнего сервера посредством HTTP-запроса.
- При получении ответа на HTTP-запрос требуется создать записи с данными книг в _Картотеке_.

## Порядок настройки отправки и обработки HTTP-запросов с помощью сценария

1. Настройте [шаблон записи](#настройка-шаблона-записи) для хранения данных из HTTP-запросов.
2. Создайте и настройте [подключение для отправки HTTP-запросов](#настройка-подключения).
3. Создайте и настройте [путь передачи данных для отправки HTTP-запросов](#настройка-пути-передачи-данных).
4. Настройте [сценарий](#настройка-сценария), который будет обрабатывать данные из HTTP-запросов, полученных посредством настроенных подключения и пути передачи данных, и помещать их в записи шаблона.

### Настройка шаблона записи

1. Создайте шаблон записи _«Картотека»_ со следующими атрибутами:

    | Название   | Тип данных |
    | ---------- | ---------- |
    | _Автор_    | **Текст**  |
    | _Название_ | **Текст**  |
    | _Цена_     | **Число**  |

2. Создайте кнопку _«Получить данные о книгах»_ со следующими свойствами:

    - **Контекст операции: запись**
    - **Операция: вызвать событие «Нажата кнопка»**
    - **Результат выполнения: обновить данные**

3. Поместите созданные атрибуты и кнопку на форму.

## Настройка подключения

--8<-- "http_send_connection_configure.md"

## Настройка пути передачи данных

--8<-- "http_send_connection_communication_route_configure.md"

### Основные свойства

На вкладке «**Основные свойства**» настройте параметры использования пути передачи данных.

- **Подключение** — выберите ранее созданное [подключение для отправки HTTP-запросов](#настройка-подключения).
- **Системное имя** — введите уникальное имя пути передачи данных.
    --8<-- "system_name_requirements.md:no_autofill"
- **Отключить** — установите этот флажок, если требуется временно деактивировать путь передачи данных.
- **Описание** — введите наглядное описание назначения пути передачи данных, например _«Получение файлов по HTTP»_.
- **Номер шины данных** — выберите номер от 0 до 3, если требуется распределить потоки данных нескольких путей для повышения производительности.

### Атрибуты сообщений

На вкладке «**Атрибуты сообщения**» настройте атрибуты, значения которых требуется извлечь из полученных данных в формате JSON.

!!! warning "Составление атрибута сообщения типа «Объект»"

    Чтобы составить **атрибут сообщения** типа «**Объект**» для хранения имени и содержимого файла, необходимо создать структуру из родительского и дочерних атрибутов:

    --8<-- "communication_route_message_attribute_object.md"

1. Укажите **тип сообщения** «**Отправка HTTP-запросов**».
2. В таблице «**Ответ**» добавьте атрибут

    - **Системное имя:** _Books_ — должно совпадать с именем соответствующего поля HTTP-запроса.
    - **Тип: объект**
    - **Массив:** флажок установлен

3. К атрибуту _Books_ добавьте следующие дочерние атрибуты:

    - _Author_ типа **строка**;
    - _Title_ типа **строка**;
    - _Price_ типа **число**.

    Системные имена атрибутов должны совпадать с именами соответствующих полей HTTP-запроса.

### Интеграция

На вкладке «**Интеграция**» укажите **атрибут для десериализации ответа без ошибки**:

- **Путь к атрибуту:** _Books_ — системное имя атрибута с вкладки «**Атрибуты сообщения**».
- **Выражение на языке запросов:**

    ``` js
    $.Books[*]
    ```

!!! tip "Обращение к данным с помощью JSONPath"

    Чтобы обратиться к определённым сегментам данных, полученных из JSON, требуется составить соответствующий запрос на языке JSONPath:

    - `$` — обращение ко всему JSON.
    - `$.object` — обращение к объекту `object`.
    - `$.array[X, Y]` — обращение к элементам массива `array` под номерами `X` и `Y` (**отсчёт начинается с `0`**).
    - `$.array[X:Y]` — обращение к элементам массива `array` под номерами от `X` до `Y-1`.
    - `$.array[*]` — обращение ко всем элементам массива `array`.

    Примеры запросов на JSONPath и возвращаемых значений:

    <table>
    <tbody>
    <tr markdown="block">
    <td markdown="block">**Запрос**</td>
    <td markdown="block">**Возвращаемое значение**</td>
    </tr>
    <tr markdown="block">
    <td markdown="block">
    ``` js
    $
    ```
    </td>
    <td markdown="block">
    ``` json
    {
    "Date": "17.10.2024",
    "Books": [
        { "Author": "Толстой Л. Н.",
            "Title": "Война и мир",
            "Price": 895
        },
        { "Author": "Пушкин А. С.",
            "Title": "Капитанская дочка",
            "Price": 499
        },
        { "Author": "Лермонтов М. Ю.",
            "Title": "Мцыри",
            "Price": 372
        }
        ]
    }
    ```
    </td>
    </tr>
    <tr markdown="block">
    <td markdown="block">
    ``` js
    $.Date
    ```
    </td>
    <td markdown="block">
    ``` json
    "17.10.2024"
    ```
    </td>
    </tr>
    <tr markdown="block">
    <td markdown="block">
    ``` js
    $.Books[0,2]
    ```
    </td>
    <td markdown="block">
    ``` json
    {
        "Author": "Толстой Л. Н.",
        "Title": "Война и мир",
        "Price": 895
    },
    {
        "Author": "Лермонтов М. Ю.",
        "Title": "Мцыри",
        "Price": 372
    }
    ```
    </td>
    </tr>
    <tr markdown="block">
    <td markdown="block">
    ``` js
    $.Books[1].Title
    ```
    </td>
    <td markdown="block">
    ``` json
    "Капитанская дочка"
    ```
    </td>
    </tr>
    </tbody>
    </table>

### Настройка сценария

1. Создайте сценарий _«Получение данных о книгах»_.
2. В свойствах события «**Нажатие кнопки**» выберите **контекстный шаблон** _«Картотека»_ и **кнопку** _«Получить данные о книгах»_.
3. Добавьте действие «**Отправить сообщение**» со следующими свойствами:

    - **Подключение:** выберите [подключение для отправки HTTP-запросов](#настройка-подключения).
    - **Путь передачи данных:** выберите [путь передачи данных для отправки HTTP-запросов](#настройка-пути-передачи-данных).
    - **Переменная для успешного ответа**: _Response_

4. Добавьте и настройте действие «**Повторять по количеству объектов**»:

    - **Переменная**: _Book_
    - **Атрибут или выражение для поиска объектов**: формула

        ``` cs
        $$Response->Books
        ```

        Здесь `Books` — системное имя **атрибута сообщения**, настроенного в [пути передачи данных](#настройка-пути-передачи-данных).

5. Внутри действия «**Повторять по количеству объектов**» добавьте действие «**Создать запись**».
6. Внутри действия «**Создать запись**» добавьте действие «**Изменить значения атрибутов**».
7. В действии «**Изменить значения атрибутов**» на вкладке «**Дополнительно**» установите флажок «**Сбрасывать кэш значений**».
8. На вкладке «**Основные**» добавьте атрибуты, значения которых требуется заполнить из ответа на HTTP-запрос:

    | Атрибут    | Операция со значениями | Значение                      |
    | ---------- | ---------------------- | ----------------------------- |
    | _Автор_    | **Заменить**           | **Формула:** `$$Book->Author` |
    | _Название_ | **Заменить**           | **Формула:** `$$Book->Title`  |
    | _Цена_     | **Заменить**           | **Формула:** `$$Book->Price`  |

_![Сценарий обработки данных из запроса с помощью JSONPath](img/jpath_example_scenario.png)_

### Тестирование

1. Настройте внешний сервер на отправку ответа на HTTP-запросы с данными в формате JSON, соответствующем [прикладной задаче](#прикладная-задача).
2. В **{{ productName }}** нажмите кнопку _«Получить данные о книгах»_.
3. Через некоторое время в шаблоне _«Картотека»_ должны появиться новые записи с данными, полученными с сервера.
4. Просмотрите новые записи.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Отправка HTTP-запросов. Настройка подключения][http_send_connection]_
- _[Отправка HTTP-запросов типа GET. Пример: настройка подключения, пути передачи данных и сценария для обработки запросов в формате JSON][http_send_example]_
- _[Событие и действия сценария. Определения, типы, свойства, настройка][scenario_elements]_

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
