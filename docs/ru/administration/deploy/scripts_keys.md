---
title: 'Скрипты и их ключи'
kbId: 
---

# Поддерживаемые ключи скриптов {: #scripts_keys}


!!! tip "Обязательные ключи для скриптов"

    Если не указать обязательный ключ для любого скрипта, он запросит его после запуска.

## Условные обозначения

`<instanceName>` — название экземпляра ПО
`<versionNumber>` — номер версии ПО
`<portNumber>` — номер порта
`<versionPath>` — путь до директории с версией ПО
`<hostName>` — имя хоста для экземпляра ПО
`<value>` — 

## Скрипты установки вспомогательного ПО

`X.X-release-ru-<versionNumber>.prerequisites.windows\CMW_Windows<versionNumber>\scripts`

### files_unblock.ps1
Назначение: Разблокировка установочных файлов скачанных из Интернета

| **Ключ** | **Описание**                                                                     |
| -------- | -------------------------------------------------------------------------------- |
| `path`   | путь до распакованной папки с установочными файлами (**опционально**)            |
| `h`      | вызвать справку по использованию скрипта (**указывается без остальных ключей**). |

### prerequisites_install.ps1
Назначение: Установка вспомогательного ПО

Скрипт не имеет параметров.

### prerequisites_list.ps1
Назначение: Вывод списка установленных компонентов вспомогательного ПО

Скрипт не имеет параметров.


## Скрипты установки {{ productName }}

`X.X-release-ru-<versionNumber>.windows\CMW_Windows<versionNumber>\scripts`

### version_install.ps1
Назначение: Установка версии ПО

Скрипт не имеет параметров.

### version_delete.ps1
Назначение: Удаление версии ПО

**WINDOWS**

| **Ключ**  | **Описание**                                                                 |
| --------- | ---------------------------------------------------------------------------- |
| `version` | указать номер версии ПО вида `X.X.XXXX.X` (например: `5.0.1234.0`).          |
| `h`       | вызвать справку по использованию скрипта (указывается без остальных ключей). |

**Пример:**
``` powershell
.\version_delete.ps1 -version <versionNumber>
```

**LINUX**

| **Ключ**            | **Описание**                                                                 |
| ------------------- | ---------------------------------------------------------------------------- |
| `-v=`, `--version=` | указать номер версии ПО вида `X.X.XXXX.X` (например: `5.0.1234.0`).          |
| `-h`, `--help`      | вызвать справку по использованию скрипта (указывается без остальных ключей). |

**Пример:**
``` sh
bash version_delete.sh -v=5.0.12345.0
```

### version_list.ps1
Назначение: Вывод установленных выводов ПО

Скрипт не имеет параметров.

### instance_create.ps1
Назначение: Создание экземпляра ПО

Скрипт поддерживает следующие ключи:

**WINDOWS**

| **Ключ**                    | **Описание**                                                                                                                                |
| --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| `name <instanceName>`       | **обязательный** ключ с именем экземпляра ПО.                                                                                               |
| `port <portNumber>`         | порт для экземпляра ПО, по умолчанию: 80 (необязательный ключ).                                                                             |
| `version <versionNumber>`   | развернуть ПО указанной версии вида `X.X.XXXX.X` (например: `5.0.1234.0`) из папки вида `C:\Program Files\Comindware\CBAP\<versionNumber>`. |
| `versionPath <versionPath>` | развернуть ПО из указанной папки `<versionPath>` с версией ПО.                                                                              |
| `demoDB`                    | создать экземпляр ПО **{{ productName }}** c демонстрационной базой данных.                                                                 |
| `fqdn <hostName>`           | имя хоста для экземпляра ПО (необязательный ключ). По умолчанию: `localhost`.                                                               |
| `h`                         | вызвать справку по использованию скрипта (указывается без остальных ключей).                                                                |

**Пример:**
``` powershell
.\instance_create.ps1 -name <instanceName> -port <portNumber> -version <versionNumber> 
```

!!! tip "Обязательные ключи для скриптов"

	Если не указать обязательный ключ для любого скрипта, он запросит его после запуска.


**LINUX**

Обязательные
  `-n=<value>`|`--name=<value>` —  имя экземпляра ПО (например: `cp_instance`).
  `-p=<value>`|`--port=<value>` — порт для экземпляра ПО (по умолчанию: `80`)
  `-v=<value>`|`--version=<value>` — развернуть ПО указанной версии (например: `5.0.12345.0`)

Необязательные
  `-fqdn=<value>`|`--instance-fqdn=<value>` — имя хоста для экземпляра ПО для NGINX (по умолчанию: `localhost`)
  `-el=<value>`|`--elasticsearch-url=<value>` — указывает ссылку или IP-адрес для Elasticsearch (например: `192.168.0.1`)
  `-kf=<value>`|`--kafka-url=<value>` — указывает ссылку или IP-адрес для Kafka Message Broker (например: `192.168.0.1`)
  `-d`|`--demoDB` — создать экземпляр ПО **{{ productName }}** c демонстрационной базой данных
  `-h`|`--help` — Вызвать справку по использованию скрипта (указывается без остальных ключей).

**Пример:**
``` sh
bash instance_create.sh -n=cp_instance -p=80 -v=5.0.12345.0
```


### instance_start.ps1
Назначение: Запуск экземпляра ПО

| **Ключ** | **Описание**                                  |
| -------- | --------------------------------------------- |
| `-name`  | **обязательный** ключ с именем экземпляра ПО. |

 
**Пример:**
``` powershell
.\instance_start.ps1 -name <instanceName>
```

### instance_stop.ps1
Назначение: Остановка экземпляра ПО

** Пример:**
``` powershell
.\instance_stop.ps1 -name <instanceName>
```

| **Ключ** | **Описание**                                  |
| -------- | --------------------------------------------- |
| `-name`  | **обязательный** ключ с именем экземпляра ПО. |

### instance_upgrade.ps1
Назначение: Обновление экземпляра ПО

Скрипт поддерживает следующие ключи:

  - `name <instanceName>` — **обязательный** ключ с именем экземпляра ПО.
  - `version <versionNumber>` — **обязательный** ключ с указанием номера версии  до указанной необходимо обновить экземпляр ПО (например: `5.0.1234.0`) из папки вида `C:\Program Files\Comindware\CBAP\<versionNumber>`.
  - `versionPath <versionPath>` — обновить экземпляр ПО до версии из указанной папки `<versionPath>`.
  - `h` — вызвать справку по использованию скрипта (указывается без остальных ключей).

**Пример:**
  ``` powershell
  .\instance_upgrade.ps1 -name <instanceName> -version <versionNumber> 
  ```


### instance_list.ps1
Назначение: Вывод списка установленных экземпляров ПО.

| **Ключ**    | **Описание**                               |
| ----------- | ------------------------------------------ |
| `help`, `h` | Показать справку по использованию скрипта. |

Скрипт не требует обязательных параметров.

**Пример вызова:**
```powershell
.\instance_list.ps1
```

**Пример вывода:**
```
=======================================================================================
Source folder: C:\ProgramData\Comindware\Instances
=======================================================================================
Instance name                    | Version        | Web site state | App pool state
=======================================================================================
demo1                            | 5.0.1234.0     | Started        | Started
test2                            | 5.0.1234.0     | Stopped        | Stopped
prod3                            | 5.0.5678.1     | Started        | Started
=======================================================================================
Command executed.
Complete script instance_list.ps1.
=======================================================================================
Status: Completed
```

### instance_delete.ps1
Назначение: Удаление экземпляра ПО

**WINDOWS**

- `name <instanceName>` — **обязательный** ключ с именем экземпляра ПО. Если не указать другие ключи, будет удалена только служба `comindware<instanceName>`.
- `deleteData` — удалить базу данных из папки вида `C:\ProgramData\Comindware\Instances\<instanceName>\Data` и пользовательские файлы экземпляра ПО из папки вида `C:\ProgramData\Comindware\Instances\<instanceName>\Streams`. Без указания этого ключа или ключа `clear` база данных экземпляра ПО не будет удалена.
- `clear` — удалить все файлы, папки, базу данных и пользовательские файлы вместе с папкой вида `C:\ProgramData\Comindware\Instances\<instanceName>`, а также службы экземпляра ПО, сайт и пул приложения из IIS.

**Пример:**
``` powershell
.\instance_delete.ps1 -name <instanceName> -clear
```

**LINUX**

**Обязательные**
`  -n=<value>`|`--name=<value>` —  имя экземпляра ПО (например: `cp_instance`).

**Необязательные**
  `--deleteData` — удалить базу данных и пользовательские файлы экземпляра ПО

  `--deleteLogs` — удалить журналы экземпляра ПО

  `--deleteBackups` — удалить резервные копии экземпляра ПО

  `-h`|`--help` — вызвать справку по использованию скрипта (указывается без остальных ключей).

**Пример:**
``` sh
bash instance_delete.sh -n=cp_instance
```


<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- [Пути и содержимое директорий экземпляра ПО][paths]

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}

# Ключи скриптов из папки scripts

В этом разделе приведены поддерживаемые ключи для дополнительных скриптов, находящихся в папке `scripts` дистрибутива. Некоторые из них используются только другими скриптами и не предназначены для самостоятельного запуска.

## Общие ключи для всех скриптов (Windows)

Почти все скрипты поддерживают универсальные ключи для вывода справки:

| **Ключ** | **Описание** |
|----------|--------------------------------------------------|
| `-help`  | Показать справку по использованию скрипта.        |
| `-h`     | Показать справку по использованию скрипта.        |

Указание любого из этих ключей приведёт к выводу справочной информации и завершению работы скрипта без выполнения основной логики.

## Ключи скриптов из папки scripts

В этом разделе приведены поддерживаемые ключи для дополнительных скриптов, находящихся в папке `scripts` дистрибутива. Некоторые из них используются только другими скриптами и не предназначены для самостоятельного запуска.

## files_unblock.ps1
Назначение: Разблокировка установочных файлов, скачанных из Интернета.

| **Ключ**    | **Описание**                                                       |
| ----------- | ------------------------------------------------------------------ |
| `path`      | Путь до распакованной папки с установочными файлами (опционально). |
| `help`, `h` | Показать справку по использованию скрипта.                         |

**Пример:**
```powershell
.\files_unblock.ps1 -path 'C:\temp\4.4-release-4.4.4444.4.windows'
```

## instance_restore_from_backup.ps1
Назначение: Восстановление экземпляра из резервной копии.

| **Ключ**        | **Описание**                                               |
| --------------- | ---------------------------------------------------------- |
| `zipPath`       | Путь к архиву резервной копии.                             |
| `dataPath`      | Путь к папке с данными экземпляра.                         |
| `streamsPath`   | Путь к папке с пользовательскими файлами экземпляра.       |
| `tempDir`       | Временная папка для распаковки архива (опционально).       |
| `deleteOldData` | Удалить старые данные перед восстановлением (опционально). |
| `help`, `h`     | Показать справку по использованию скрипта.                 |

**Пример:**
```powershell
.\instance_restore_from_backup.ps1 -zipPath c:\temp\backup.cdbbz -dataPath C:\ProgramData\comindware\Instances\demo\Database -streamsPath C:\ProgramData\comindware\Instances\demo\Streams -deleteOldData
```

## upgrade_config_file.ps1
Назначение: Удаление устаревших параметров логирования из конфигурационного файла.

| **Ключ**            | **Описание**                               |
| ------------------- | ------------------------------------------ |
| `configFilePath`    | Путь к конфигурационному файлу.            |
| `obsoleteLogFields` | Массив устаревших параметров для удаления. |

**Пример:**
```powershell
.\upgrade_config_file.ps1 -configFilePath 'C:\ProgramData\comindware\Instances\demo\config\adapterhost.yml' -obsoleteLogFields 'log.maxArchiveFiles','log.archiveAboveSize'
```

## Служебные скрипты (вызываются только другими скриптами)

Следующие скрипты не предназначены для самостоятельного запуска пользователем. Они используются как вспомогательные и вызываются другими скриптами платформы:

| **Скрипт**                | **Назначение**                                                                                 |
|---------------------------|----------------------------------------------------------------------------------------------|
| adapterhost_config.ps1    | Генерация конфигурационного файла adapterhost.yml для экземпляра.                             |
| adapterhost_register.ps1  | Регистрация AdapterHost как службы, создание симлинков и необходимых директорий.              |
| adapterhost_start.ps1     | Запуск службы AdapterHost и связанного сайта/IIS пула.                                        |
| adapterhost_stop.ps1      | Остановка службы AdapterHost и связанного сайта/IIS пула.                                      |
| adapterhost_unregister.ps1| Удаление службы AdapterHost, очистка файлов и симлинков.                                      |
| apigateway_register.ps1   | Регистрация ApiGateway как службы, создание симлинков и необходимых директорий.               |
| apigateway_start.ps1      | Запуск службы ApiGateway и связанного сайта/IIS пула.                                         |
| apigateway_stop.ps1       | Остановка службы ApiGateway и связанного сайта/IIS пула.                                       |
| apigateway_unregister.ps1 | Удаление службы ApiGateway, очистка файлов и симлинков.                                       |

**Признаки служебных скриптов:**
- В параметрах только `-help`/`-h` (или вообще нет пользовательских параметров).
- В справке или выводе явно указано: _"Do not run this script. This script is used by other scripts and not intended for separate execution."_
- Не имеют пользовательских сценариев запуска и не требуют пользовательского ввода.

> ⚠️ Для выполнения операций используйте основные сценарии (`instance_create.ps1`, `instance_delete.ps1` и т.д.), которые автоматически вызывают служебные скрипты по необходимости.
