---
title: Обновление версии экземпляра ПО с 3.5 на 4.2. Инструкции, подготовка базы данных, устранение проблем
kbId: 2129
---

# Обновление версии экземпляра ПО с 3.5 на 4.2. Инструкции, подготовка базы данных, устранение проблем

## Введение

В данной статье представлены инструкции по обновлению экземпляра ПО **{{ productName }}** (далее «ПО») с версии 3.5 на версию 4.2 для Windows, включая устранение ошибок, которые могут возникнуть при обновлении.

## Требования для обновления

Для обновления версии экземпляра ПО требуется заранее подготовить:

1. Резервную копию экземпляра ПО версии 3.5 в формате `.CDBBZ`.
2. Работающий экземпляр ПО версии 3.5.
3. Дистрибутив ПО версии 3.5.1058 или выше: `ComindwarePlatform_3.5.1058.0.msi`.
4. Дистрибутив ПО версии 3.5.1076 или выше: `ComindwarePlatform_3.5.1076.0.msi`.
5. Дистрибутив ПО версии 3.5.1100 или выше: `ComindwarePlatform_3.5.1100.0.msi`.
6. Дистрибутив ПО версии 4.2, например, `ComindwarePlatform_4.2.278.0.msi`.
7. Развернутый сервер Elasticsearch, см. статью «[Установка Elasticsearch. Краткое руководство для Windows]({{ kbArticleURLPrefix }}2094)».

## Порядок обновления ПО

1. Установите ПО версии 3.5.1058 с помощью файла `ComindwarePlatform_3.5.1058.0.msi` и Утилиты администрирования. См. статью «[Установка продукта {{ productName }}]({{ kbArticleURLPrefix }}2028)».
2. С помощью Утилиты администрирования обновите экземпляр ПО версии 3.5 до версии 3.5.1058. См. статью «[Обновление версии продукта для экземпляра]({{ kbArticleURLPrefix }}2031)».
3. Запустите экземпляр ПО.
4. Выполните вход в экземпляр ПО с аккаунтом системного администратора.
5. При отображении запросов на обновление базы данных и инициализацию экземпляра ПО, нажимайте кнопку «**Далее**».
6. Дождитесь отображения начальной страницы экземпляра ПО.
7. Проверьте работоспособность экземпляра ПО, устраните возможные ошибки и при необходимости проведите дополнительную настройку экземпляра ПО, чтобы обеспечить его штатную работу.
8. Создайте резервную копию экземпляра ПО в формате `.CDBBZ` с помощью раздела «**Администрирование**» — «**Инфраструктура**» — «**Резервное копирование**» в экземпляре ПО.
9. Повторите шаги 1–8 для ПО версии 3.5.1076 или выше, а затем для версии 3.5.1100 или выше. В результате у вас должен быть работоспособный экземпляр ПО версии 3.5.1100 (или выше) и его резервная копия.
10. С помощью Утилиты администрирования обновите версию экземпляра ПО до версии 4.2. См. статью «[Обновление версии продукта для экземпляра]({{ kbArticleURLPrefix }}2031)».
11. При отображении запросов на обновление базы данных, индексов Elasticsearch и инициализацию экземпляра ПО, нажимайте кнопку «**Далее**».
12. Дождитесь отображения начальной страницы экземпляра ПО.
13. В процессе обновления версии экземпляра ПО в папке журналов экземпляров ПО будет создан файл `upgrade.log`.
14. Откройте папку журналов экземпляра ПО. Путь к этой папке указан в Утилите администрирования в поле «**Журнал системы**» на вкладке «**Пути к файлам**» в окне «**Конфигурация** **экземпляра системы**». См. «[Обновление версии продукта для экземпляра]({{ kbArticleURLPrefix }}2301)».


![Путь к папке журналов экземпляра ПО в Утилите администрирования](https://kb.comindware.ru/assets/img_632c16a5d2547.png)

*Путь к папке журналов экземпляра ПО в Утилите администрирования*
15. Откройте файл `upgrade.log` в папке журналов экземпляра ПО   

![Файл upgrade.log в папке журналов экземпляра ПО](https://kb.comindware.ru/assets/img_632c1702b0dcb.png)

Файл upgrade.log в папке журналов экземпляра ПО
16. В файле `upgrade.log` найдите все ошибки по ключевым словам `ERROR` и `ошиб`.


![Пример ошибок в журнале обновления экземпляра ПО](https://kb.comindware.ru/assets/img_632c16c77cf4f.png)

Пример ошибок в журнале обновления экземпляра ПО
17. Если в файле `upgrade.log` ошибки отсутствуют, обновление версии экземпляра ПО выполнено успешно и его можно эксплуатировать в штатном режиме. Шаги 18–25 выполнять не требуется.
18. Если в файле `upgrade.log`имеются ошибки, переходите к шагам 19–25.
19. С помощью Утилиты администрирования смените версию экземпляра ПО на версию 3.5.1058. См. статью «`![](https://kb.comindware.ru/images/marker.png){Article-ID:2031}`  »  .
20. С помощью Утилиты администрирования восстановите экземпляр ПО из резервной копии версии 3.5 в формате `.CDBBZ`, созданной на шаге 8 или 23.
21. Запустите экземпляр ПО.
22. Выполните вход в экземпляр ПО с аккаунтом системного администратора.
23. Устраните все ошибки, указанные в файле `upgrade.log`.
24. Создайте резервную копию экземпляра ПО.
25. Снова обновите экземпляр ПО до версии 4.2.
26. Повторяйте шаги 9–25 до тех пор, пока не удастся запустить экземпляр ПО в штатном режиме.
27. Переходите к [устранению возможных проблем в работоспособном экземпляре версии 4.2](#возможные-проблемыпосле-обновления-и-способы-их-устранения).

## Возможные проблемы после обновления и способы их устранения

После того как экземпляр ПО версии 4.2 будет запущен, проверьте наличие перечисленных ниже потенциальных проблем и устраните их при необходимости.

| Использование выражения CONST(" ") и пустых значений в сценариях | |
| --- | --- |
| **Проблема** | **Решение** |
| В сценариях в действии «**Изменить значение атрибутов**»   в версии 3.5 для установки в атрибуте пустого значения в него записывалось пустое значение или использовалось выражение  `CONST(" ")`. | Чтобы установить в атрибуте пустое значение, укажите операцию со значением «**Удалить**»  . |
| Выделение памяти для Elasticsearch | |
| **Проблема** | **Решение** |
| Сервис Elasticsearch работает некорректно или не работает. В информационной панели экземпляра ПО отображаются сообщения об ошибках Elasticsearch. | Проверьте конфигурацию сервера Elasticsearch: выделите достаточный объем памяти и необходимое количество шардов в соответствии с объемом исторических данных. |
| Перекомпиляция скриптов на C# | |
| **Проблема** | **Решение** |
| Не все скрипты на C# из версии 3.5 могут без изменений работать в версии 4.2. Например, в функции `Api.Process.ProcessObjectService.CreateWithObjectId()` было четыре параметра, а в версии 4.2 а стало три. В некоторых случаях после обновления с версии 3.5 на версию 4.2 может отображаться сообщение об ошибке «Could not find a part of the path». | 1. Перекомпилируйте скрипты, нажав кнопку «**Перекомпилировать библиотеки скриптов**» на странице «**Администрирование**» — «**Глобальная конфигурация**». 2. Ознакомьтесь с журналом компиляции скриптов. 3. Исправьте выявленные ошибки в скриптах. |
| Преобразование глобальных функций | |
| **Проблема** | **Решение** |
| Глобальные функции из версии 3.5 не поддерживаются в версии 4.2. | Вместо глобальных функций следует создать аналогичные сценарии или скрипты на C#. |
| Использование специальных символов в имени пользователя | |
| **Проблема** | **Решение** |
| В версии 3.5 в имени пользователя можно было указать специальные символы. В версии 4.2 в имени пользователя разрешено использовать только буквы латинского алфавита (строчные и прописные), цифры, символ подчеркивания, точку и дефис: a-z A-Z 0-9 \_ . - Все остальные символы недопустимы. | 1. Исправьте имена пользователей, содержащие недопустимые символы, на странице «**Администрирование**» — «**Аккаунты**». 2. Исправьте выражения и скрипты на C#, в которых могут присваиваться имена пользователей с недопустимыми символами. |
| Преобразование повторно используемых подпроцессов | |
| **Проблема** | **Решение** |
| Элемент диаграммы процесса «**Повторно используемый подпроцесс**» из версии 3.5 в версии 4.2 переименован в «**Вызов под процесса**». В версии 4.2 вызов процесса настраивается и может работать несколько иначе, чем в версии 3.5. | Проверьте конфигурацию и работоспособность элементов «**Вызов под процесса**» на всех диаграммах процессов. Исправьте конфигурацию при необходимости. |
| Преобразование правил для данных у промежуточных событий | |
| **Проблема** | **Решение** |
| Правила для данных *на входе и выходе* промежуточных событий из версии 3.5 при обновлении до версии 4.2 преобразуются в сценарии *на выходе*. В результирующем сценарии на выходе из промежуточного события все действия выстраиваются последовательно — сначала идут действия из правил на входе, затем — из правил на выходе. | 1. Если требуется полностью сохранить прежнюю логику работы правил для данных на входе в промежуточное событие: 	- Создайте дополнительное промежуточное событие перед имеющимся. 	- Перенесите на его выход действия из правил на входе исходного события. 2. Проверьте сценарии на выходе из промежуточных событий на всех диаграммах процессов на предмет корректной работы. Исправьте сценарии при необходимости. |
| Преобразование формул | |
| **Проблема** | **Решение** |
| В версии 3.5 в формулах можно было не выполнять проверку на пустое значение атрибутов. В версии 4.2 такая проверка необходима во избежание деления на 0 и других неполадок, в противном случае будет возникать ошибка. | В формулах необходимо проверять наличие значений у атрибутов с помощью функции `NOT(EMPTY())` либо обеспечивать ненулевое значение с помощью функции `VALUE()`. |
| Настройка разрешений для шаблонов процессов | |
| **Проблема** | **Решение** |
| В версии 3.5 не требовалось разрешение на создание экземпляра процесса. В версии 4.2 для создания экземпляра процесса у аккаунта должно быть разрешение. | В свойствах ролей добавьте разрешение «**Создание**» для соответствующих шаблонов процессов. |
| Настройка кнопок и разрешений для таблиц на формах | |
| **Проблема** | **Решение** |
| В версии 3.5 для коллекции (таблицы) на форме кнопки операций с записями создавались автоматически в соответствии с разрешениями на соответствующие операции, заданными в свойствах коллекции (таблицы) на форме. В версии 4.2 кнопки операций с записями в таблице на форме требуется выносить на область кнопок таблицы. При этом вынесенные кнопки определяют разрешения на соответствующие операции с записями в таблице. | Если у таблицы на форме не отображаются или не работают должным образом кнопки операций с записями в таблице, например «**Редактировать**», «**Создать**», «**Сохранить**», «**Удалить**»:- в конструкторе формы выберите область кнопок таблицы; - перетащите на область кнопок требуемые кнопки, при этом будут разрешены соответствующие операции с записями в таблице; - проверьте и настройте свойства таблицы на форме. |
| Публикация диаграмм процессов | |
| **Проблема** | **Решение** |
| При обновлении с версии 3.5 на версию 4.2 некоторые процессы могут перестать выполняться. | Откройте диаграмму процесса, который не выполняется должным образом или выдаёт ошибку. Опубликуйте её заново, выбрав способ «**Создать новую версию**». |



