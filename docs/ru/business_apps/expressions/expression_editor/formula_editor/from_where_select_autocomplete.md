---
title: Ввод запроса from where select
kbId: 2466
tags:
  - выражения
  - формулы
  - from where select
  - функции
  - шаблоны
  - атрибуты
  - вычисляемые атрибуты
  - проверка значения
  - предиктивный ввод
  - подсказки
  - переменные
  - редактор выражений
  - операторы
  - оператор ==
  - оператор ->
  - прямая стрелка
  - атрибут-заголовок записей шаблона
  - сценарии
hide:
  - tags
---

# Ввод запроса from where select {: #formula_editor_from_where_select_autocomplete}

Запрос `#!mysql from where select` возвращает список значений из указанного источника данных, соответствующих заданному условию.

## Ввод заготовки конструкции from where select

С помощью предиктивного ввода можно вставить заготовку запроса `#!mysql from where select`.

1. Нажмите клавиши ++ctrl+space++.
2. Отобразится список источников данных для запроса — атрибутов типа «**Запись**» в текущем шаблоне и шаблонов в текущем приложении.
    *![Список источников данных для запроса from where select](formula_editor_from_where_select_autocomplete_data_source.png)*
3. Дважды нажмите системное имя атрибута или шаблона в списке, чтобы вставить в формулу заготовку конструкции `#!mysql from where select` для него:
    *![Заготовка конструкции from where select](formula_editor_from_where_select_autocomplete_entered_source_attribute.png)*
4. Замените строку `Ваше условие` после оператора `#!mysql where` на условие выборки записей из источника данных.

!!! note "Примечание"

    * В качестве источника данных для запроса `#!mysql from where select` рекомендуется использовать атрибут типа «**Запись**», содержащий ID записей, из которых требуется произвести выборку.
    * Запрос по записям, связанным с атрибутом, выполняется быстрее, чем запрос по всем записям из шаблона.
    * В качестве источника данных можно использовать атрибуты типа «**Запись**», у которых установлен флажок «**Хранить несколько значений**».
    * Атрибуты, подходящие для запроса, отображаются в подсказке в начале списка с префиксом `$` и суффиксом `(запрос)`: `$AttributeName (запрос)`.

## Синтаксис запроса from where select {: .pageBreakBefore }

* `#!mysql from a` — объявление локальной переменной-селектора `a`, в которую будут помещены записи из источника данных.
* `#!mysql in` — объявление источника данных:
    - `#!mysql db->TemplateName` — шаблон записи с системным именем `TemplateName`;
    - `#!mysql $RecordAttributeName` — атрибут типа «**Запись**» с системным именем `RecordAttributeName`, хранящий несколько значений;
    - `#!mysql (from where select)` — вложенный запрос. Вложенный запрос необходимо заключить в скобки и использовать в нём уникальную переменную-селектор:
    ```mysql
    from a in (from b in $DataSource2 where Condition2 select b->Attribute2)
    where Condition1 select a->Attribute1
    ```
* `#!mysql where Condition` — выбор записей, для которых выражение `Condition` возвращает `true`.
* `#!mysql orderby SortAttribute ascending` — сортировка записей по значению атрибута `SortAttribute`. Порядок сортировки указывается оператором `ascending` — по возрастанию (порядок по умолчанию, указывать необязательно) или `descending` — по убыванию.
* `#!mysql select a->ReturnAttribute` — выборка значений атрибута `ReturnAttribute` записей из источника данных. Оператор `select` может содержать выражение.

```mysql title="Пример: запрос записей районов Москвы с сортировкой по убыванию названия района"
from a in $Cities
where a->CityName == "Москва"
orderby a->Districts->DistrictName descending
select a->Districts
```

```mysql title="Пример: запрос названий и авторов книг, у которых указан автор, с сортировкой по возрастанию имени автора и выводом в формате «Название: название книги. Автор: имя автора»"
from book in $Books
where NOT(EMPTY(book->Author))
orderby a->boook->Author->Name
select CONCAT(LIST('Название: ', book->Name, '. Автор: ', book->Author->Name))
```

!!! warning "Внимание! Зарезервированные слова"
    Следующие слова нельзя использовать в запросе в качестве локальной переменной, так как они зарезервированы как системные:

    * `and`, `ascending`, `between`, `by`, `db`, `descending`, `equals`, `from`, `group`, `in`, `into`, `item`, `join`, `let`, `on`, `orderby`, `select`, `source`, `where`
    * слова, начинающиеся с подчеркивания (`_`)
    * имена функций и литералы

## Ввод запроса из атрибута текущего шаблона {: .pageBreakBefore }

1. Введите строку:
      ```mysql
      from a in
      ```
2. После ввода оператора `in` отобразится список доступных источников данных. Этот список также можно вызвать, нажав клавиши ++ctrl+space++ в позиции после оператора `in`.
      *![Список источников данных](formula_editor_application_templates_autocomplete_attribute_source.png)*
3. Дважды нажмите системное имя атрибута типа «**Запись**», отображающегося в списке с префиксом `$` и **_без суффикса_** `(запрос)`, чтобы вставить его в формулу.
4. Введите условие выборки записей и атрибут для выборки с помощью операторов `where` и `select`.

```mysql title="Пример: формула, возвращающая список записей в шаблоне, связанном с атрибутом Costs, в которых значение атрибута TotalAmount больше значения атрибута PlannedCosts в текущей записи"
from a in $Costs where a->TotalAmount > $PlannedCosts select a->id
```

## Ввод запроса из шаблона текущего приложения {: .pageBreakBefore }

1. Введите строку:
      ```mysql
      from a in db->
      ```
2. После ввода символов `db->` отобразится список шаблонов текущего приложения. Этот список также можно вызвать, нажав клавиши ++ctrl+space++ в позиции после `db->`.
      *![Список шаблонов в текущем приложении](formula_editor_application_templates_autocomplete.png)*
3. Дважды нажмите системное имя шаблона, чтобы вставить его в формулу.
4. Введите условие выборки записей и атрибут для выборки с помощью операторов `where` и `select`.

```mysql title="Пример: формула, возвращающая количество записей в шаблоне Cars, с таким же значением атрибута Make, как в текущей записи"
COUNT(from a in db->Cars where a->Make == $Make select a->id)
```

## Ввод системного имени атрибута после переменной-селектора {: .pageBreakBefore }

Здесь используется приведённый ниже [пример конфигурации приложения](#app-configuration).

1. Введите строку:
      ```mysql
      from a in $RequestedCars where a->
      ```
2. После ввода символов `a->` отобразится список атрибутов шаблона, связанного с атрибутом `RequestedCars`, на который ссылается локальная переменная-селектор `a`. Этот список также можно вызвать, нажав клавиши ++ctrl+space++ в позиции после `a->`.
      *![Список атрибутов, вызванный посредством переменной-селектора](formula_editor_linked_record_attributes_selector_autocomplete.png)*
3. Дважды нажмите системное имя атрибута `_creator`, чтобы вставить его в формулу. `_creator` — это **[системный атрибут][attributes_system]**, в котором хранится ID аккаунта, создавшего запись.
4. Введите строку:
      ```mysql
      == USER() select a->id
      ```

```mysql title="Пример: формула, возвращающая количество записей в шаблоне, связанном с атрибутом RequestedCars, созданных под текущим аккаунтом"
COUNT(from a in $RequestedCars where a->_creator == USER() select a->id)
```

## Ввод системного имени атрибута из цепочки связанных шаблонов

Здесь используется приведённый ниже [пример конфигурации приложения](#app-configuration).

1. Введите строку:
      ```mysql
      from a in $$RequestedCars where b->_creator->
      ```
2. После ввода символов `_creator->` отобразится список атрибутов системного **[шаблона аккаунта][attribute_account]**, с которым связан системный атрибут `_creator`. Этот список также можно вызвать, нажав клавиши ++ctrl+space++ в позиции после оператора `->`.
*![Список атрибутов, вызванный по цепочке связанных шаблонов](formula_editor_linked_record_attributes_selector_nested_autocomplete.png)*
3. Дважды нажмите системное имя атрибута username, чтобы вставить его в формулу.
4. Введите строку:
      ```mysql
      == "admin" select a->id
      ```

```mysql title="Пример: формула, возвращающая список записей в шаблоне, связанном с атрибутом $RequestedCars, созданных под аккаунтом admin"
from a in $RequestedCars where a->_creator->username == "admin" select a->id
```

## Практический пример

!!! example "Подсчёт количества автомобилей марки «Лада» в заявке"

    **Конфигурация приложения**
    {: #app-configuration}

    * Шаблон записи _«Заявка на автомобили»_
        - Атрибут _«Запрошенные автомобили»_
            - **Системное имя**: _RequestedCars_
            - **Тип данных**: **запись**
            -  **Связанный шаблон**: _Автомобили_
            -  **Хранить несколько значений**: флажок установлен
        - Запись: заявка на несколько автомобилей разных марок
    * Шаблон записи _«Автомобили»_
        - Атрибут _«Марка»_
            - **Системное имя**: _Make_
            - **Тип данных**: **текст**
            -  **Использовать как заголовок записей**: флажок установлен
        - Записи: `УАЗ`, `Москвич`, `Лада`

    **Составление формулы**

    1. Введите функцию `#!mysql COUNT()`. См. «**[Ввод имени функции и просмотр подсказки по функции][formula_editor_function_autocompete]**».
    2. В позиции аргумента функции нажмите клавиши ++ctrl+space++.
    3. Отобразится список источников данных.
         *![Список источников данных для запроса](formula_editor_from_where_select_autocomplete.png)*
    4. Дважды нажмите в списке пункт _$RequestedCars (запрос)_, чтобы вставить в формулу заготовку конструкции `#!mysql from where select` для него:
         *![Заготовка запроса](formula_editor_from_where_select_autocomplete_entered.png)*

    {% if pdfOutput %}
!!! example "Подсчёт количества автомобилей марки «Лада» в заявке — продолжение"
    <div markdown="block" class="olReset" style="counter-increment: start 4;">
    {% endif %}
    5. Выделите строку `Ваше условие` после оператора `#!mysql where`, чтобы заменить её на условие выборки записей из шаблона _«Автомобили»_.
    6. Введите строку `#!mysql where a->`.
    7. В отобразившемся списке атрибутов шаблона _«Автомобили»_ дважды нажмите системное имя атрибута _Make_, чтобы вставить его в формулу. См. «**[Ввод системного имени атрибута после переменной-селектора](#ввод-системного-имени-атрибута-после-переменной-селектора)**»
        *![Список атрибутов шаблона _«Автомобили»_](formula_editor_from_where_select_autocomplete_condition_record_attribute_list.png)*
    8. Введите оператор `==` и нажмите клавиши ++ctrl+space++.
    9.  Отобразится список записей шаблона _«Автомобили»_ в виде марок автомобилей. См. «**[Ввод заголовка записи связанного шаблона][formula_editor_record_heading_autocomplete]**».
         *![Список записей в шаблоне _«Автомобили»_](formula_editor_from_where_select_autocomplete_condition_record_heading_list.png)*
    10.   Дважды нажмите пункт _«Лада»_, чтобы вставить в формулу строковый литерал `#!mysql "Лада"`.
    {% if pdfOutput %}
    </div>
    {% endif %}

    ```mysql title="Формула, подсчитывающая автомобили «Лада» в заявке"
    COUNT(from a in $RequestedCars where a->Make == "Лада" select a->id)
    ```

    **Синтаксис формулы**

    * `COUNT()` — возвращает количество элементов в списке, переданном в качестве аргумента.
    * `#!mysql from a` — объявление локальной переменной `a`.
    * `#!mysql in $RequestedCars` — объявление атрибута `RequestedCars` в качестве источника данных.
    * `#!mysql where a->Make == "Лада"` — выборка в переменную `a` записей, связанных с атрибутом `RequestedCars`, у которых атрибут `Make` имеет значение `"Лада"`.
    * `#!mysql select a->id` — выборка значений атрибута `id` полученных записей и передача списка этих значений в функцию `COUNT()`.
    {% include-markdown ".snippets/pdfEndOfBlockHack.md" %}

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Редактор выражений][expression_editor]_
- _[Примеры использования формул. База знаний Comindware][formula_use_examples]_
- _[Ввод имени функции и просмотр подсказки по функции][formula_editor_function_autocompete]_

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
