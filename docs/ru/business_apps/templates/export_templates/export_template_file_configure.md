---
title: Подготовка файла шаблона экспорта
kbId: 4796
tags:
  - шаблон экспорта
  - создание файла шаблона экспорта
  - настройка файла шаблона экспорта
  - настройка шаблона экспорта
  - файл шаблона экспорта
  - DOCX
  - Word
  - XLSX
  - Excel
  - поля-заполнители
  - поля шаблона экспорта
  - синтаксис полей шаблона экспорта
  - экспорт данных
  - атрибут-заголовок записи
  - экспорт с помощью C#
  - Экспорт в Word
  - Экспорт в Excel
hide:
  - tags
---

# Подготовка файла шаблона экспорта {: #export_template_file_configure}

<div class="admonition question" markdown="block">

## Определения {: .admonition-title #definitions}

* **Файл шаблона экспорта** представляет собой макет для выгрузки данных записи с требуемым визуальным оформлением.
* Файл шаблона можно сформировать в формате `DOCX` или `XLSX`.
* В файл шаблона экспорта необходимо вставить поля согласно определённому [синтаксису](#синтаксис-полей-шаблона-экспорта). Эти поля будут заменены на экспортируемые данные.

</div>

## Создание файла шаблона экспорта

1. Создайте документ Excel (`XLSX`) или Word (`DOCX`).
2. Введите в документ требуемые сведения.
3. Отформатируйте документ обычным образом.
4. Введите [поля](#синтаксис-полей-шаблона-экспорта) в те места документа, куда требуется экспортировать данные записи.
5. Должен получиться документ следующего вида (см. [пример][export_template_file_example]):

*![Пример простейшего файла шаблона экспорта](img/export_template_file_example.png)*

## Синтаксис полей шаблона экспорта {: .pageBreakBefore }

В файле шаблона экспорта используются поля-заполнители. При экспорте данных записи поля заменяются значениями атрибутов, а остальной текст остаётся без изменений.

Синтаксис полей зависит от того, используется ли для экспорта данных [скрипт C#](#синтаксис-для-экспорта-с-использованием-c).

### Синтаксис для экспорта без использования C\#

{% raw %}

* В документ введите поля вида `{AttributeSystemName}` (_без пробелов_ в фигурных скобках), где `AttributeSystemName` — системное имя атрибута, значение которого необходимо экспортировать в файл. Значение атрибута будет экспортировано в формате отображения, заданном в свойствах атрибута.
* `{RecordAttribute.LinkedTemplateAttribute}` — чтобы экспортировать значение атрибута связанного шаблона, укажите его системное имя через точку _без пробела_ после системного имени атрибута типа «**Запись**».
* `{#LinkedTemplateAttribute}` — чтобы экспортировать значение атрибута типа «**Запись**» в виде гиперссылки на запись связанного шаблона, укажите системное атрибута с префиксом `#`. Гиперссылка будет содержать идентификатор или заголовок записи (если в шаблоне указан [атрибут-заголовок][attribute_displayed]).
* `{foreach:RecordAttribute} {#LinkedAttribute1} {LinkedAttribute2} {end:RecordAttribute}` —
для экспорта данных из нескольких записей связанного шаблона используйте операторы `foreach` и `end` в строке таблицы:

    * Строка таблицы с операторами `foreach` и `end` будет преобразована в несколько строк с данными записей связанного шаблона.
    * В первом столбце строки введите в фигурных скобках оператор `foreach` и через двоеточие _без пробела_ системное имя атрибута типа «**Запись**».
    * В последнем столбце строки введите в фигурных скобках оператор `end` и через двоеточие _без пробела_ системное имя атрибута типа «**Запись**»;
    * Между операторами `foreach` и `end` введите системные имена атрибутов связанного шаблона в фигурных скобках.

* **`{AttributeSystemName} полужирный текст`**_`{AttributeSystemName2} курсив`_ — между полями можно располагать произвольный текст. Текст и поля можно форматировать (курсивом, полужирным шрифтом и т.&nbsp;п.). Экспортируемые данные будут отформатированы соответствующим образом.
* `{ImageAttributeSystemName}` — если в поле указано системное имя атрибута типа «**[Изображение][attribute_image]**», поле будет заменено на изображение, хранящееся в атрибуте.

* `{QRCodeAttributeSystemName:200:100}` — если в поле указано системное имя атрибута типа «**[Штрихкод][attribute_barcode]**», поле будет заменено на изображение штрихкода, сформированного по значению атрибута. Для штрихкода можно указать ширину и высоту через двоеточие после системного имени атрибута. Если указать только ширину, то штрихкод будет квадратным. Если не указывать ширину и высоту, то будет использоваться стандартный размер штрихкода.

{% endraw %}

*![Пример синтаксиса полей шаблона экспорта](img/export_template_file_advanced_syntax_example.png)*
{% include-markdown ".snippets/pdfEndOfBlockHack.md" %}

### Синтаксис для экспорта с использованием C\# {: .pageBreakBefore }

Экспортировать данные посредством шаблона экспорта можно с помощью скрипта C#. Это позволяет более гибко настроить параметры экспорта, например с дополнительной фильтрацией, заменой информации, форматированным выводом [атрибутов типа «**Запись**»][attribute_record] с несколькими значениями (коллекций).

Скрипт C# для шаблона экспорта следует ввести на вкладке «**Скрипт**» [кнопки экспорта][export_template_button_configure], которая автоматически создаётся для каждого шаблона экспорта.

Примеры скриптов C# для экспорта данных см. в статьях _«[Настройка шаблона экспорта с использованием C#][export_template_csharp_configure]»_, и _«[Настройка выгрузки нескольких коллекций и изображений][export_template_csharp_collection_download]»_

При экспорте данных с помощью С# синтаксис полей шаблона экспорта различается в зависимости от формата файла шаблона экспорта:

#### Синтаксис C# для XLSX-файлов

* Скрипт C# должен передавать данные в функцию:

    ``` csharp
    Api.TeamNetwork.ObjectAppExportService.ExecuteExcelExportTemplate("exportTemplate.N", dataToExport)
    ```

    Здесь:

    * `exportTemplate.N` — ID шаблона экспорта;
    * `dataToExport` — массив объектов с экспортируемыми данными.

* В ячейки введите поля вида `&=data.propertyName`.

    * Здесь `data` — массив экспортируемых данных, переданный скриптом C#.
    * `propertyName` — имя свойства элемента массива `data`, значение которого необходимо поместить в ячейку.

*  В одной ячейке может быть только одно поле.
* Для корректного экспорта данных необходимо указать формат ячейки, соответствующий типу экспортируемого значения.
* Объявлять циклы `foreach` не требуется: для массивов строки на листе формируются автоматически.

    !!! Warning "Внимание!"

        * Если поле обращается к свойству, имеющему тип массива (например, `LIST<T>`), то это свойство не может быть `null` и `undefined` (то есть массив обязательно должен быть объявлен), _в противном случае экспорт не будет выполнен_.

        * Например, если `&=data.Contract` имеет тип `LIST<T>`, то у каждого объекта в массиве `data` должно быть объявлено свойство `Contract`.

*![Пример XSLX-файла шаблона экспорта для C#](export_template_file_c_syntax_example_xlsx.png)*

#### Синтаксис C# для DOCX-файлов {: .pageBreakBefore }

* Скрипт C# должен передавать данные в функцию:

    ``` csharp
    Api.TeamNetwork.ObjectAppExportService.ExecuteWordExportTemplate("exportTemplate.N", dataToExport)
    ```

    Здесь:

    * `exportTemplate.N` — ID шаблона экспорта;
    * `dataToExport` — объект класса `RESULT`, содержащий экспортируемые данные.

* В документ введите поля вида `<<[propertyName]>>`, где `propertyName` — имя свойства объекта `dataToExport`, значение которого необходимо поместить в текст.
* Чтобы экспортировать массив данных, используйте в строке таблицы или абзаце следующую конструкцию:

    ```
    <<foreach [row in dataArray]>><<[row.property0]>> <<[row.property1]>> ... <<[row.propertyN]>><</foreach>>
    ```

    или

    ```
    <<foreach [in dataArray]>><<[property0]>> <<[property1]>> ... <<[propertyN]>><</foreach>>
    ```

    Здесь:

    *  `foreach` — оператор цикла по массиву `dataArray`
    *  `row` — переменная-итератор цикла (_необязательная_);
    *  `dataArray` — имя массива, переданного в объекте `dataToExport`.
    *  `property0`...`propertyN` — имена свойств элементов массива `dataArray`, значения которых необходимо поместить в текст.

* Чтобы экспортировать изображение, введите поле вида `<<image [imageData]>>`, где `imageData` — имя массива типа `byte` с данными изображения, переданного в объекте `dataToExport`.

*![Пример DOCX-файла шаблона экспорта для C#](img/export_template_file_c_syntax_example_docx.png)*

## Использование шрифтов в шаблонах экспорта в формате PDF {: #export_template_file_configure_fonts .pageBreakBefore }

Если в [свойствах шаблона экспорта][export_templates] установлен флажок «**Экспортировать как PDF**», файлы PDF формируются с использованием шрифтов, установленных на сервере c экземпляром ПО **{{ productName }}** (далее «**Сервер**»).

При формировании файлов PDF из шаблонов экспорта сервер может подставлять произвольные шрифты с другим начертанием, что может привести к некорректному форматированию файлов PDF.

Это может быть связано с тем, что Сервере отсутствуют шрифты, которые используются в файле шаблона экспорта:

- На сервере с Windows в некоторых случаях могут отсутствовать стандартные шрифты Times New Roman и Arial;
- На сервере с Linux могут отсутствовать какие бы то ни было шрифты, либо могут использоваться шрифты, отличные от шрифтов Windows.

Набор шрифтов, доступных на сервере, известен администратору операционной системы.

### Решение для Word

Чтобы файлы PDF правильно форматировались при экспорте, в файлы DOCX шаблонов экспорта следует внедрять шрифты:

1. В меню «**Файл**» выберите пункт «**Параметры**».
2. В окне «**Параметры Word**» перейдите на вкладку «**Сохранение**».
3. В разделе «**Сохранение качества при совместном использовании документа**»:

    - установите флажок «**Внедрить шрифты в файл**»;
    - снимите флажок «**Не внедрять обычные системные шрифты**».

4. Нажмите кнопку «**OK**».
5. Сохраните файл DOCX и используйте его в качестве шаблона экспорта.

### Решение для Excel {: .pageBreakBefore }

Чтобы файлы PDF правильно форматировались при экспорте из шаблонов экспорта в формате XSLX используйте один из двух подходов:

- установить шрифты, используемые в файле Excel, на сервер;
- установить шрифты с сервера в Windows и использовать их в файле Excel.

#### Вариант 1. Установка шрифтов на сервер

1. Составьте список шрифтов, которые используются в файле Excel шаблона экспорта.
2. Выберите необходимые файлы шрифтов в папке `C:\Windows\Fonts` (требуется доступ администратора).
3. Создайте архив с файлами шрифтов, например, в своей папке `Downloads`.
4. Перенесите архив с шрифтами на сервер.
5. Установите шрифты на сервер.

#### Вариант 2. Использование шрифтов с сервера в Excel

1. Соберите все шрифты на сервере:

    - папка `C:\Windows\Fonts` — Windows
    - каталог `/usr/share/fonts` — Linux

2. Установите шрифты с сервера на компьютер, где вы редактируете файл Excel шаблона экспорта:

    - поместите шрифты в папку в папку `C:\Windows\Fonts`;

        **или**

    - откройте каждый файл шрифта и нажмите в окне просмотра шрифта кнопку «**Установить**».

3. Используйте в файле Excel шаблона экспорта только шрифты, перенесённые с сервера.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Пример настройки и использования шаблона экспорта авансового отчёта][export_template_file_example]_
- _[Настройка выгрузки нескольких коллекций и изображений][export_template_csharp_collection_download]_
- _[Настройка шаблона экспорта с использованием C#][export_template_csharp_configure]_
- _[Настройка шаблона экспорта][export_templates]_
- _[Настройка кнопки экспорта][export_template_button_configure]_

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
