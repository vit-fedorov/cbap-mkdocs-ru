---
title: Интерфейс на нескольких языках. Настройка приложения
kbId: 5064
tags:
    - мультиязычность
    - настройка приложения на разных языках
    - язык аккаунта
hide:
    - tags
---

# Интерфейс на нескольких языках. Настройка приложения {: #multilingual_app }

## Введение

**{{ productName }}** позволяет создать интерфейс приложения на различных языках. Можно настроить отображаемые названия форм, полей, кнопок и пунктов навигации на разных языках, а также дать пользователем возможность переключаться между доступными языками.

Здесь представлена инструкция по настройке шаблонов записи для отображения интерфейса на русском и английском языках, а также кнопки для смены языка интерфейса.

## Прикладная задача

Имеется приложение _«Управление автопарком»_.

Требуется настроить шаблон _«Заявки на автомобили»_, связанный с ним шаблон _«Тип автомобиля»_, форму _«Заявка на автомобиль»_ и раздел навигации _«Управление автопарком»_, которые будут поддерживать отображение на русском и английском языках.

Формы _«Заявка на автомобиль»_ и раздел навигации _«Управление автопарком»_ должны отображаться на языке, заданном в аккаунте текущего пользователя.

Также требуется настроить кнопку смены языка отображения интерфейса приложения и языка в аккаунте текущего пользователя.

!!! warning "Логика работы многоязычного интерфейса"

    - Для переключения языка отображения форм и навигации мы используем:
        - отдельные формы и разделы навигации на английском и русском языках;
        - правила для форм, скрывающие и показывающие формы в соответствии с языком пользователя;
        - специальные группы и роли для пользователей, использующих приложение на английском и русском языках;
        - шаблон аккаунта, служащий для смены языка в аккаунтах пользователей;
        - две кнопки, которые будут менять язык отображения приложения.
    - Формы и разделы навигации на английском языке будут скрыты для пользователей, у которых в аккаунте задан русский язык. И наоборот, для пользователей с английским языком будут отображаться английские формы и разделы навигации.
    - При входе пользователя приложение будет отображаться на языке, указанном в его аккаунте, и для него будет отображаться раздел навигации, назначенный роли с соответствующим языком.
    - Для пользователя будет отображаться одна из кнопок смены языка — на английский в русском интерфейсе и на русский — в английском.
    - При нажатии кнопки смены языка пользователь будет перемещён в группу с требуемым языком, при этом будет изменён язык в его аккаунте. Формы станут отображаться на заданном языке. В результате смены группы пользователю будет назначена новая роль с разделом навигации на требуемом языке.
    - Для отображения приложения на новом языке пользователь должен обновить страницу в веб-браузере.

## Настройка шаблона записи «Тип автомобиля» {: .pageBreakBefore }

1. Создайте шаблон записи _«Тип автомобиля»_.
2. Создайте атрибуты:

    | Название      | Системное имя | Тип данных |
    | ------------- | ------------- | ---------- |
    | _Название RU_ | `NameRU`      | **Текст**  |
    | _Название EN_ | `NameEN`      | **Текст**  |

3. Добавьте атрибут _«Отображаемое название»_:

    - **Тип данных: текст**
    - **Использовать как заголовок записей:** флажок установлен
    - **Вычислять автоматически:** флажок установлен
    - **Вычисляемое выражение: формула**

    ``` cs
    IF (USER()->language=='ru', VALUE($NameRU, $NameEN), VALUE($NameEN, $NameRU))
    ```

5. Поместите созданные атрибуты на форму шаблона _«Тип автомобиля»_.
6. Создайте записи со следующими значениями:

    | _Название RU_ | _Название EN_ |
    | ------------- | ------------- |
    | _легковой_    | _car_         |
    | _автобус_     | _bus_         |
    | _грузовой_    | _truck_       |

## Настройка шаблона записи «Заявки на автомобили» {: .pageBreakBefore }

!!! tip "Названия полей на разных языках"

    Для удобства настройки одинаковых форм и разделов навигации на разных языках задавайте унифицированные названия шаблонов и атрибутов на требуемых языках через `/`, например _«Номер заявки / Request Number»_.

    При настройке полей на формах и разделов навигации для каждого языка оставьте только соответствующие отображаемые названия.

    Например, для поля _«Номер заявки / Request Number»_ на английской форме в отображаемом названии удалите часть _«Номер заявки /»_ и оставьте текст _«Request Number»_, а на русской форме наоборот — _«Номер заявки»_.

1. Создайте шаблон записи _«Заявки на автомобили / Vehicle requests»_.
2. Создайте атрибуты _«Номер заявки / Request Number»_ и _«Количество пассажиров / Amount of passengers»_ типа «**Число**».
3. Создайте атрибут _«Тип автомобиля / Vehicle Type»_ типа «**Запись**», связанный с шаблоном _«Тип автомобиля»_.
4. Создайте форму _«Форма на русском»_ и поместите на неё атрибуты.
5. Отредактируйте отображаемые названия полей, оставив только русский текст.
6. Сохраните форму.
7. Создайте форму _«Форма на английском»_ и поместите на неё атрибуты.
8. Отредактируйте отображаемые названия полей, оставив только английский текст.
9. Сохраните форму.
10. Откройте для редактирования форму _«Заявки на автомобили / Vehicle requests — Основная форма»_
11. Поместите на основную форму _форму на русском_ и _форму на английском_.
12. Создайте **правило** для основной формы.
13. Добавьте в правило для формы следующее **действие**:

    - **Элемент формы:** _Форма на русском_
    - **Действие: изменить доступ**
    - **Новое значение: скрыть**
    - **Условие выполнения: формула**

    ``` cs
    EQUALS(USER()->language,"en")
    ```

    Это действие будет скрывать _форму на русском_ для пользователей, у которых в аккаунте задан английский язык.

14. Добавьте в правило для формы следующее **действие**:

    - **Элемент формы:** _Форма на английском_
    - **Действие: изменить доступ**
    - **Новое значение: скрыть**
    - **Условие выполнения: формула**

    ``` cs
    OR(EQUALS(USER()->language,"ru"),EMPTY(USER()->language))
    ```

    Это действие будет скрывать _форму на английском_ для пользователей, у которых в аккаунте задан русский язык или язык не задан.

15. Сохраните форму.

## Настройка групп, ролей и раздела навигации {: .pageBreakBefore }

1. Создайте группу _«Пользователи RU»_ и добавьте в неё аккаунты пользователей, которые будут использовать приложение на русском языке.
2. Создайте роль _«Пользователь RU»_ и добавьте в неё группу _«Пользователи RU»_.
3. Настройте права доступа для роли согласно логике работы приложения.
4. Создайте группу _«Пользователи EN»_ и добавьте в неё аккаунты, которые будут использовать приложение на английском языке.
5. Создайте роль _«Пользователь EN»_ и добавьте в неё группу _«Пользователи EN»_.
6. Настройте права доступа для роли.
7. Создайте раздел навигации _«Управление автопарком»_ и назначьте его роли _«Пользователь RU»_.
8. Добавьте в этот раздел навигации шаблон записи _«Заявки на автомобили / Vehicle requests»_ и смените название пункта на _«Заявки на автомобили»_.
9. Создайте раздел навигации _«Fleet management»_ и назначьте его роли _«Пользователь EN»_.
10. Добавьте в этот раздел навигации шаблон записи _«Заявки на автомобили / Vehicle requests»_ и смените название пункта на _«Vehicle requests»_.

## Настройка кнопки переключения языка {: .pageBreakBefore }

1. Создайте шаблон аккаунта _«Пользователи»_.
2. Перейдите на вкладку «**Кнопки**».
3. Создайте кнопку _«Switch to English»_ со следующими свойствами:

    - **Контекст операции: аккаунт**
    - **Операция: C#-скрипт**
    - **Результат выполнения: обновить данные**

4. На вкладке «**Скрипт**» введите C#-скрипт по следующему образцу:

    ``` cs
    using System; 
    using System.Collections.Generic;
    using System.Linq;
    using Comindware.Data.Entity;
    using Comindware.TeamNetwork.Api.Data.UserCommands;
    using Comindware.TeamNetwork.Api.Data;
    using Comindware.Data;
    class Script
    {
        public static UserCommandResult Main(UserCommandContext userCommandContext, Comindware.Entities entities)
        { 
            // Получаем ID аккаунта текущего пользователя.
            var id = userCommandContext.ObjectIds[0];
            // Исключаем аккаунт из группы «Пользователи RU» с ID group.1.
            Api.Base.AccountGroupService.ExcludeMembers( "group.1", new List<string>(){id});
            // Включаем аккаунт в группу «Пользователи EN» с ID group.2.
            Api.Base.AccountGroupService.IncludeMembers( "group.2", new List<string>(){id});
            var account =  Api.Base.AccountService.Get(id);
            // Задаём код языка en в аккаунте пользователя.
            account.Language = "en";
            Api.Base.AccountService.Edit(account);
            // Возвращаем объект с результатом нажатия кнопки
            var result = new UserCommandResult
            {
                Success = true,
                Commited = true,
                ResultType = UserCommandResultType.Notificate,
                Messages = new[]
                {
                    new UserCommandMessage
                    {
                        Severity = SeverityLevel.Normal,
                        // Выводим всплывающее уведомление о смене языка на английский.
                        Text = "Language changed to English."
                        }
                }
            };
            return result;
        }
    }
    ```

5. На вкладке «**Условия отображения**» добавьте формулу:

    ``` cs
    OR(EQUALS(USER()->language,"ru"),EMPTY(USER()->language))
    ```

    Кнопка _«Switch to English»_ будет отображаться для пользователей, у которых в аккаунте задан русский язык или язык не задан.

6. Сохраните кнопку.

7. Создайте кнопку _«Переключить на русский»_ со следующими свойствами:

    - **Контекст операции: аккаунт**
    - **Операция: C#-скрипт**
    - **Результат выполнения: обновить данные**

    {% include-markdown ".snippets/pdfPageBreakHard.md" %}

8. На вкладке «**Скрипт**» добавьте C#-скрипт по следующему образцу:

    ``` cs
    using System; 
    using System.Collections.Generic;
    using System.Linq;
    using Comindware.Data.Entity;
    using Comindware.TeamNetwork.Api.Data.UserCommands;
    using Comindware.TeamNetwork.Api.Data;
    using Comindware.Data;
    class Script
    {
        public static UserCommandResult Main(UserCommandContext userCommandContext, Comindware.Entities entities)
        { 
            // Получаем ID аккаунта текущего пользователя.
            var id = userCommandContext.ObjectIds[0];
            // Исключаем аккаунт из группы «Пользователи EN» с ID group.2.
            Api.Base.AccountGroupService.ExcludeMembers( "group.2", new List<string>(){id});
            // Включаем аккаунт в группу «Пользователи RU» с ID group.1.
            Api.Base.AccountGroupService.IncludeMembers( "group.1", new List<string>(){id});
            var account =  Api.Base.AccountService.Get(id);
            // Устанавливаем код языка ru в аккаунте пользователя.
            account.Language = "ru";
            Api.Base.AccountService.Edit(account);
            // Возвращаем объект с результатом нажатия кнопки
            var result = new UserCommandResult
            {
                Success = true,
                Commited = true,
                ResultType = UserCommandResultType.Notificate,
                Messages = new[]
                {
                    new UserCommandMessage
                    {
                        Severity = SeverityLevel.Normal,
                        // Выводим всплывающее уведомление о смене языка на русский.
                        Text = "Язык изменён на русский."
                        }
                }
            };
            return result;
        }
    }
    ```

    {% include-markdown ".snippets/pdfPageBreakHard.md" %}

9. На вкладке «**Условия отображения**» добавьте формулу:

    ``` cs
    EQUALS(USER()->language,"en") 
    ```

    Кнопка _«Переключить на русский»_ будет отображаться для пользователей, у которых в аккаунте задан английский язык.

10. Сохраните кнопку.
11. Поместите обе кнопки на форму шаблона _«Пользователи»_.
12. Привяжите к шаблону _«Пользователи»_ аккаунты, ранее добавленные в группы _«Пользователи RU»_ и _«Пользователи EN»_.

## Тестирование {: .pageBreakBefore }

1. Войдите в **{{ productName }}** используя аккаунт, у которого задан русский язык и который входит в группу _«Пользователи RU»_.
2. Приложение и раздел навигации должны отображаться на русском языке.
3. Создайте запись в шаблоне _«Заявки на автомобили / Vehicle requests»_.
4. Форма и данные атрибута _«Тип автомобиля / Vehicle Type»_ должны отобразиться на русском языке.
5. Перейдите к шаблону _«Пользователи»_ и нажмите кнопку «**Перейти к экземплярам**».
6. Откройте свой аккаунт в списке.
7. Нажмите кнопку _«Switch to English»_.
8. Вместо кнопки _«Switch to English»_ должна отобразиться кнопка _«Переключить на русский»_.
9. Приложение должно отобразиться на английском языке. Если смена языка не произошла, обновите страницу в браузере.
10. Перейдите к записи шаблона _«Заявки на автомобиль / Vehicle requests»_.
11. Форма и данные атрибута _«Тип автомобиля / Vehicle Type»_ должны отображаться на английском языке.

<div class="relatedTopics" markdown="block">

--8<-- "related_topics_heading.md"

- _[Список функций языка формул Comindware][formula_function_list]_
- _[Написание скриптов на языке C#][csharp_guide]_

</div>

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
