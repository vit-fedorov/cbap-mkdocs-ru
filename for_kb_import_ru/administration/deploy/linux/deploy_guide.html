<div class="md-body" data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr" kb-id="4622" kbtitle="Установка, запуск, инициализация и остановка ПО">
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<nav aria-label="Содержание" class="md-nav md-nav--secondary">
<div class="mce-toc">
<h2 class="toc-heading">
      Содержание
      </h2>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#введение">
<span class="md-ellipsis">
      Введение
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#порядок-развёртывания-по-comindware-platform">
<span class="md-ellipsis">
      Порядок развёртывания ПО Comindware Platform
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#установка-вспомогательного-по">
<span class="md-ellipsis">
      Установка вспомогательного ПО
    </span>
</a>
<nav aria-label="Установка вспомогательного ПО" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#видеоинструкция">
<span class="md-ellipsis">
      Видеоинструкция
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#порядок-установки-вспомогательного-по">
<span class="md-ellipsis">
      Порядок установки вспомогательного ПО
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#deploy_guide_linux_install_sw">
<span class="md-ellipsis">
      Установка ПО Comindware Platform
    </span>
</a>
<nav aria-label="Установка ПО Comindware Platform" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#видеоинструкция_1">
<span class="md-ellipsis">
      Видеоинструкция
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#порядок-установки-по-comindware-platform">
<span class="md-ellipsis">
      Порядок установки ПО Comindware Platform
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#создание-экземпляра-по">
<span class="md-ellipsis">
      Создание экземпляра ПО
    </span>
</a>
<nav aria-label="Создание экземпляра ПО" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#видеоинструкция_2">
<span class="md-ellipsis">
      Видеоинструкция
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#подготовка-к-созданию-экземпляра-по">
<span class="md-ellipsis">
      Подготовка к созданию экземпляра ПО
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#создание-единственного-экземпляра-по">
<span class="md-ellipsis">
      Создание единственного экземпляра ПО
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#создание-дополнительного-экземпляра-по">
<span class="md-ellipsis">
      Создание дополнительного экземпляра ПО
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#запуск-экземпляра-по">
<span class="md-ellipsis">
      Запуск экземпляра ПО
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#deploy_guide_linux_initialize">
<span class="md-ellipsis">
      Инициализация Comindware Platform
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#оптимизация-параметра-vmmax_map_count">
<span class="md-ellipsis">
      Оптимизация параметра vm.max_map_count
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#остановка-экземпляра-по">
<span class="md-ellipsis">
      Остановка экземпляра ПО
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#удаление-версии-и-экземпляра-по">
<span class="md-ellipsis">
      Удаление версии и экземпляра ПО
    </span>
</a>
<nav aria-label="Удаление версии и экземпляра ПО" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#видеоинструкция_3">
<span class="md-ellipsis">
      Видеоинструкция
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#удаление-экземпляра-по">
<span class="md-ellipsis">
      Удаление экземпляра ПО
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#deploy_guide_linux_delete_version">
<span class="md-ellipsis">
      Удаление версии ПО
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link mkdocs_imported_link" href="#связанные-статьи">
<span class="md-ellipsis">
      Связанные статьи
    </span>
</a>
</li>
</ul>
</div>
</nav>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h2 id="введение">Введение</h2>
<p>Для работы <strong>Comindware Platform</strong> требуются операционная система, сервер базы данных, веб-сервер, обратный прокси-сервер и сервер журналов.</p>
<p>Для быстрого развёртывания <strong>Comindware Platform</strong> в Linux компания <strong>Comindware</strong> предоставляет дистрибутив с установщиком, настраивающим необходимое программное обеспечение. См. <em><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4582">Comindware Platform 5.0. Перечень стороннего программного обеспечения для Linux</a></em>.</p>
<p>Здесь представлены инструкции по развёртыванию и инициализации <strong>Comindware Platform</strong> из дистрибутива в ОС Linux.</p>
<h2 id="порядок-развёртывания-по-comindware-platform">Порядок развёртывания ПО Comindware Platform</h2>
<ol class="colored_numbers_list">
<li>Установите и настройте необходимое вспомогательное ПО.</li>
<li>Установите ПО <strong>Comindware Platform</strong>.</li>
<li>Создайте экземпляр ПО.</li>
<li>Запустите экземпляр ПО.</li>
<li>Инициализируйте экземпляр ПО.</li>
</ol>
<h2 id="установка-вспомогательного-по">Установка вспомогательного ПО</h2>
<p>Прежде чем приступать к установке вспомогательного ПО, необходимого для работы <strong>Comindware Platform</strong>, ознакомьтесь с демонстрационным роликом и инструкциями, представленными ниже.</p>
<h3 id="видеоинструкция">Видеоинструкция</h3>
<video controls="controls" height="100%" width="100%">
<source src="https://kb.comindware.ru/platform/v5.0/administration/deploy/linux/img/deploy_guide_linux_auxiliary_software.mp4" type="video/mp4"/>
</video>
<h3 id="порядок-установки-вспомогательного-по">Порядок установки вспомогательного ПО</h3>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Скачайте и распакуйте дистрибутив с вспомогательным ПО <strong>Comindware Platform</strong>, полученный по ссылке от компании <strong>Comindware</strong> (<code>X.X</code>, <code>&lt;versionNumber&gt;</code> — номер версии ПО, <code>&lt;osname&gt;</code> — название операционной системы):</p>
<div class="highlight"><code><pre><span></span><code>tar<span class="w"> </span>-xf<span class="w"> </span>X.X-release-ru-&lt;versionNumber&gt;.prerequisites.&lt;osname&gt;.tar.gz</code> <br/></pre></code></div>
<div class="notice notice-tip">
<p class="admonition-title">Совет</p>
<p>После распаковки архив можно удалить для экономии места:</p>
<div class="highlight"><code><pre><span></span><code>rm<span class="w"> </span>-f<span class="w"> </span>X.X-release-ru-&lt;versionNumber&gt;.prerequisites.&lt;osname&gt;.tar.gz</code> <br/></pre></code></div>
</div>
</li>
<li>
<p>Перейдите в директорию со скриптами для развёртывания вспомогательного ПО:</p>
<div class="highlight"><code><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>&lt;prerequisitesDistPath&gt;/CMW_&lt;osname&gt;/scripts</code> <br/></pre></code></div>
<p>Здесь:  <code>&lt;prerequisitesDistPath&gt;/CMW_&lt;osname&gt;/</code> — путь к распакованному дистрибутиву со вспомогательным ПО.</p>
</li>
<li>
<p>Установите ПО из дистрибутива:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>prerequisites_install.sh<span class="w"> </span>-p<span class="w"> </span><span class="o">[</span>-k<span class="o">]</span><span class="w"> </span><span class="o">[</span>-e<span class="o">]</span></code> <br/></pre></code></div>
<p class="pageBreakBefore">Скрипт <code>prerequisites_install.sh</code> поддерживает следующие ключи:</p>
<ul>
<li><code>-p</code> — установить обязательное вспомогательное ПО.</li>
<li><code>-k</code> — установить ПО Kafka (необязательный ключ).</li>
<li><code>-e</code> — установить ПО OpenSearch (Elasticsearch) или OpenSearch (необязательный ключ).</li>
<li><code>-kh=&lt;hostname&gt;</code> или <code>--kafkaHost=&lt;hostname&gt;</code> — использовать указанный хост для подключения к ПО Kafka (необязательный ключ).</li>
<li><code>-kp=&lt;portNumber&gt;</code> или <code>--kafkaPort=&lt;portNumber&gt;</code> — использовать указанный порт для подключения к ПО Kafka (необязательный ключ).</li>
<li><code>-h</code> — вызов краткой справки по использованию скрипта (указывать только без остальных ключей).</li>
</ul>
<div class="notice notice-info">
<p class="admonition-title">Примечание</p>
<p>Скрипт <code>prerequisites_install.sh</code> устанавливает необходимые для <strong>Comindware Platform</strong> компоненты, включая Java, .NET, Mono, NGINX.</p>
</div>
<div class="notice notice-tip">
<p class="admonition-title">Вызов справки для скриптов</p>
<p>Для ознакомления с ключами и назначением любого скрипта используйте ключ <code>-h</code> без каких-либо других ключей, например:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>prerequisites_install.sh<span class="w"> </span>-h</code> <br/></pre></code></div>
</div>
<div class="notice notice-info">
<p class="admonition-title">Конфигурация сервера журналирования транзакций OpenSearch (Elasticsearch)</p>
<ul>
<li>В конфигурации сервера журналирования транзакций необходимо создать одного пользователя для <strong>Comindware Platform</strong>.</li>
<li>В конфигурации экземпляра ПО необходимо указать адрес сервера и уникальный префикс индексов OpenSearch (Elasticsearch). Индекс префикса служит для идентификации данных экземпляра ПО на сервере журналирования транзакций. Поэтому во избежание конфликтов данных для каждого экземпляра ПО следует указывать собственный префикс индекса.</li>
<li>При <a class="mkdocs_imported_link" href="#initialize_instance">инициализации экземпляра ПО</a> необходимо указать пользователя <strong>Comindware Platform</strong>, используемого сервером журналирования транзакций.</li>
<li>Экземпляр ПО будет взаимодействовать с сервером журналирования транзакций под указанным пользователем и создавать, наполнять и читать индексы с заданным префиксом.</li>
</ul>
</div>
</li>
<li>
<p>По окончании установки скрипт выведет информацию об установленных компонентах. Удостоверьтесь, что компоненты успешно установлены (имеют статус <code>OK</code>).</p>
<p>Пример результата выполнения скрипта с ключом <code>-p</code> без установки OpenSearch (Elasticsearch) и Kafka:</p>
<div class="highlight"><code><pre><span></span><code><span class="o">[</span>Done<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>CBAP<span class="w"> </span>Data<span class="w"> </span>Dir.</code> <br/><code>-----------------------------------------</code> <br/><code>Environment<span class="w"> </span>details</code> <br/><code>Status<span class="w">     </span><span class="p">|</span><span class="w"> </span>Software<span class="w">   </span><span class="p">|</span><span class="w"> </span>Version<span class="w">   </span></code> <br/><code>-----------------------------------------</code> <br/><code>OK<span class="w">         </span><span class="p">|</span><span class="w"> </span>mono<span class="w">       </span><span class="p">|</span><span class="w"> </span><span class="m">6</span>.12.0.200<span class="w">     </span></code> <br/><code>OK<span class="w">         </span><span class="p">|</span><span class="w"> </span>dotnet<span class="w">     </span><span class="p">|</span><span class="w"> </span><span class="m">6</span>.0.417<span class="w">        </span></code> <br/><code>OK<span class="w">         </span><span class="p">|</span><span class="w"> </span>java<span class="w">       </span><span class="p">|</span><span class="w"> </span><span class="m">17</span>.0.7<span class="w">            </span></code> <br/><code>OK<span class="w">     </span>NGINX<span class="w"> </span>installed.</code> <br/><code>OK<span class="w">     </span>NGINX<span class="w"> </span>started.</code> <br/><code>OK<span class="w">     </span>CBAP<span class="w"> </span>version<span class="w"> </span>folder<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>CBAP<span class="w"> </span>configs<span class="w"> </span>folder<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>CBAP<span class="w"> </span>data<span class="w"> </span>folder<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>CBAP<span class="w"> </span>logs<span class="w"> </span>folder<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>CBAP<span class="w"> </span>dotnet<span class="w"> </span>folder<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>Local<span class="w"> </span>elasticsearch<span class="w"> </span>server<span class="w"> </span>installed:<span class="w"> </span>No<span class="w"> </span></code> <br/><code>OK<span class="w">     </span>Local<span class="w"> </span>elasticsearch<span class="w"> </span>server<span class="w"> </span>started:<span class="w"> </span>No<span class="w"> </span></code> <br/><code>OK<span class="w">     </span>Local<span class="w"> </span>kafka<span class="w"> </span>server<span class="w"> </span>installed:<span class="w"> </span>No<span class="w"> </span></code> <br/><code>OK<span class="w">     </span>Local<span class="w"> </span>kafka<span class="w"> </span>server<span class="w"> </span>started:<span class="w"> </span>No<span class="w"> </span></code> <br/><code>OK<span class="w">     </span>Final<span class="w"> </span>status.</code> <br/></pre></code></div>
</li>
<li>
<p>Удостоверьтесь, что компоненты установлены:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>prerequisites_list.sh</code> <br/></pre></code></div>
</li>
</ol>
<h2 id="deploy_guide_linux_install_sw">Установка ПО Comindware Platform</h2>
<p>Прежде чем приступать к установке ПО <strong>Comindware Platform</strong>, ознакомьтесь с видеороликом и инструкциями, представленными ниже.</p>
<h3 id="видеоинструкция_1">Видеоинструкция</h3>
<video controls="controls" height="100%" width="100%">
<source src="https://kb.comindware.ru/platform/v5.0/administration/deploy/linux/img/deploy_guide_linux_software.mp4" type="video/mp4"/>
</video>
<h3 id="порядок-установки-по-comindware-platform">Порядок установки ПО Comindware Platform</h3>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Скачайте и распакуйте дистрибутив ПО <strong>Comindware Platform</strong>, полученный по ссылке от компании <strong>Comindware</strong>:</p>
<div class="highlight"><code><pre><span></span><code>tar<span class="w"> </span>-xf<span class="w"> </span>X.X-release-ru-&lt;versionNumber&gt;.&lt;osname&gt;.tar.gz</code> <br/></pre></code></div>
<div class="notice notice-tip">
<p class="admonition-title">Совет</p>
<p>После распаковки архив можно удалить для экономии места:</p>
<div class="highlight"><code><pre><span></span><code>rm<span class="w"> </span>-f<span class="w"> </span>X.X-release-ru-&lt;versionNumber&gt;.&lt;osname&gt;.tar.gz</code> <br/></pre></code></div>
</div>
</li>
<li>
<p id="install_sh">Перейдите в директорию со скриптами для развёртывания ПО:</p>
<div class="highlight"><code><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>&lt;distPath&gt;/CMW_&lt;osname&gt;_&lt;versionNumber&gt;/scripts</code> <br/></pre></code></div>
<p>Здесь:  <code>&lt;distPath&gt;/CMW_&lt;osname&gt;_&lt;versionNumber&gt;/</code> — путь к распакованному дистрибутиву со ПО <strong>Comindware Platform</strong>.</p>
</li>
<li>
<p>Установите ПО из дистрибутива:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>version_install.sh</code> <br/></pre></code></div>
</li>
<li>
<p>Если отобразится запрос на перезагрузку ОС, выполните перезагрузку:</p>
<div class="highlight"><code><pre><span></span><code>reboot</code> <br/></pre></code></div>
<p>После перезагрузки ОС перейдите в режим суперпользователя и заново запустите <a class="mkdocs_imported_link" href="#install_sh">установку ПО из дистрибутива (шаг 3)</a>.</p>
</li>
<li>
<p>После успешного завершения установки подождите 3–5 минут. Этого времени обычно достаточно для автоматического запуска и инициализации установленных служб (в зависимости от конфигурации машины).</p>
</li>
<li>
<p>Удостоверьтесь, что ПО установлено, просмотрев список установленных версий ПО:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>version_list.sh</code> <br/></pre></code></div>
</li>
</ol>
<h2 class="pageBreakBefore" id="создание-экземпляра-по">Создание экземпляра ПО</h2>
<p>Прежде чем приступать к установке экземпляра ПО <strong>Comindware Platform</strong>, ознакомьтесь с видеороликом и инструкциями, представленными ниже.</p>
<h3 id="видеоинструкция_2">Видеоинструкция</h3>
<video controls="controls" height="100%" width="100%">
<source src="https://kb.comindware.ru/platform/v5.0/administration/deploy/linux/img/deploy_guide_linux_instance.mp4" type="video/mp4"/>
</video>
<h3 id="подготовка-к-созданию-экземпляра-по">Подготовка к созданию экземпляра ПО</h3>
<p>Перед созданием экземпляра ПО проверьте конфигурацию Linux и при необходимости внесите в неё перечисленные ниже изменения.</p>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Откройте для редактирования файл <code>limits.conf</code>:</p>
<div class="highlight"><code><pre><span></span><code>nano<span class="w"> </span>/etc/security/limits.conf</code> <br/></pre></code></div>
</li>
<li>
<p>Установите следующие директивы:</p>
<ul>
<li><strong>Astra Linux</strong>, <strong>Ubuntu</strong>, <strong>Debian</strong> (DEB-based)</li>
</ul>
<div class="highlight"><code><pre><span></span><code><span class="err">www-data soft nproc 200000</span></code> <br/><code><span class="err">www-data hard nproc 200000</span></code> <br/><code><span class="err">www-data soft nofile 200000</span></code> <br/><code><span class="err">www-data hard nofile 200000</span></code> <br/></pre></code></div>
<ul>
<li><strong>РЕД ОС</strong>, <strong>Rocky</strong> (RPM-based)</li>
</ul>
<div class="highlight"><code><pre><span></span><code><span class="err">nginx soft nproc 200000</span></code> <br/><code><span class="err">nginx hard nproc 200000</span></code> <br/><code><span class="err">nginx soft nofile 200000</span></code> <br/><code><span class="err">nginx hard nofile 200000</span></code> <br/></pre></code></div>
<ul>
<li><strong>Альт Сервер</strong></li>
</ul>
<div class="highlight"><code><pre><span></span><code><span class="err">_nginx soft nproc 200000</span></code> <br/><code><span class="err">_nginx hard nproc 200000</span></code> <br/><code><span class="err">_nginx soft nofile 200000</span></code> <br/><code><span class="err">_nginx hard nofile 200000</span></code> <br/></pre></code></div>
</li>
<li>
<p>Откройте файл <code>common-session</code> для редактирования:</p>
<div class="highlight"><code><pre><span></span><code>nano<span class="w"> </span>/etc/pam.d/common-session</code> <br/></pre></code></div>
</li>
<li>
<p>Установите следующую директиву:</p>
<div class="highlight"><code><pre><span></span><code><span class="err">session required pam_limits.so</span></code> <br/></pre></code></div>
</li>
<li>
<p>Откройте файл <code>sysctl.conf</code> для редактирования:</p>
<div class="highlight"><code><pre><span></span><code>nano<span class="w"> </span>/etc/sysctl.conf</code> <br/></pre></code></div>
</li>
<li>
<p>Установите следующие директивы:</p>
<div class="highlight"><code><pre><span></span><code><span class="n">fs</span><span class="p">.</span><span class="n">file</span><span class="o">-</span><span class="n">max</span><span class="o">=</span><span class="mi">2097152</span></code> <br/><code><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="o">=</span><span class="mi">262144</span></code> <br/><code><span class="n">fs</span><span class="p">.</span><span class="n">inotify</span><span class="p">.</span><span class="n">max_user_instances</span><span class="o">=</span><span class="mi">524288</span></code> <br/></pre></code></div>
<div class="notice notice-tip">
<p class="admonition-title">Оптимальное значение vm.max_map_count</p>
<p>Значение <code>vm.max_map_count=262144</code> приведено для примера.</p>
<p>Определите оптимальное значение <code>vm.max_map_count</code> согласно инструкциям в параграфе «<a class="mkdocs_imported_link" href="#оптимизация-параметра-vmmax_map_count">Настройка параметра vm.max_map_count</a>».</p>
</div>
</li>
<li>
<p>Откройте файл <code>user.conf</code> для редактирования:</p>
<div class="highlight"><code><pre><span></span><code>nano<span class="w"> </span>/etc/systemd/user.conf</code> <br/></pre></code></div>
</li>
<li>
<p>Установите следующую директиву:</p>
<div class="highlight"><code><pre><span></span><code><span class="n">DefaultLimitNOFILE</span><span class="o">=</span><span class="mi">200000</span></code> <br/></pre></code></div>
</li>
<li>
<p>Откройте файл <code>system.conf</code> для редактирования:</p>
<div class="highlight"><code><pre><span></span><code>nano<span class="w"> </span>/etc/systemd/system.conf</code> <br/></pre></code></div>
</li>
<li>
<p>Установите следующую директиву:</p>
<div class="highlight"><code><pre><span></span><code><span class="n">DefaultLimitNOFILE</span><span class="o">=</span><span class="mi">200000</span></code> <br/></pre></code></div>
</li>
<li>
<p>После внесения изменений перезапустите демоны:</p>
<div class="highlight"><code><pre><span></span><code>sysctl<span class="w"> </span>-p</code> <br/><code>systemctl<span class="w"> </span>daemon-reexec</code> <br/></pre></code></div>
</li>
</ol>
<h3 class="pageBreakBefore" id="создание-единственного-экземпляра-по">Создание единственного экземпляра ПО</h3>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Перейдите в директорию со скриптами для развёртывания ПО <strong>Comindware Platform</strong>:</p>
<div class="highlight"><code><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>&lt;distPath&gt;/CMW_&lt;osname&gt;_&lt;versionNumber&gt;/scripts</code> <br/></pre></code></div>
<p>Здесь:  <code>&lt;distPath&gt;/CMW_&lt;osname&gt;_&lt;versionNumber&gt;/</code> — путь к распакованному дистрибутиву ПО.</p>
</li>
<li>
<p>Разверните экземпляр ПО:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>instance_create.sh<span class="w"> </span>-n<span class="o">=</span>&lt;instanceName&gt;<span class="w"> </span>-v<span class="o">=</span>&lt;versionNumber&gt;<span class="w"> </span><span class="o">[</span>-p<span class="o">=</span>&lt;portNumber&gt;<span class="o">]</span></code> <br/></pre></code></div>
<p>Скрипт <code>instance_create.sh</code> поддерживает следующие ключи:</p>
<ul>
<li><code>-n=&lt;instanceName&gt;</code> — имя экземпляра ПО (<strong>обязательный</strong> ключ).</li>
<li><code>-v=&lt;versionNumber&gt;</code> — номер версии ПО вида <code>X.X.XXXXX.X</code> (например: 5.0.00000.0, <strong>обязательный</strong> ключ). Версия должна быть установлена, см. <em>«<a class="mkdocs_imported_link" href="#deploy_guide_linux_install_sw">Установка Comindware Platform</a>»</em>.</li>
<li><code>-p=&lt;portNumber&gt;</code> — порт для экземпляра ПО, по умолчанию: 80 (необязательный ключ).</li>
<li><code>-fqdn=&lt;hostName&gt;</code> или <code>--instance-fqdn=&lt;hostName&gt;</code> — имя хоста для экземпляра ПО (необязательный ключ). По умолчанию: localhost.</li>
<li><code>-el=&lt;hostName&gt;</code> или <code>--elasticsearch-url=&lt;hostName&gt;</code> — использовать указанный URL или IP-адрес для подключения к серверу OpenSearch (Elasticsearch).</li>
<li><code>-kf=&lt;hostName&gt;</code> или <code>--kafka-url=&lt;hostName&gt;</code> — использовать указанный URL или IP-адрес для подключения к серверу Apache Ignite.</li>
<li><code>-h</code> — вызов краткой справки по использованию скрипта (указывать только без остальных ключей).</li>
</ul>
</li>
<li>
<p>По окончании установки скрипт выведет информацию об установленных компонентах. Удостоверьтесь, что компоненты успешно установлены (имеют статус <code>OK</code>).</p>
<p>Пример результата выполнения скрипта:</p>
<div class="highlight"><code><pre><span></span><code>OK<span class="w">     </span>Instance<span class="w"> </span>folder<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>Instance<span class="w"> </span>Web<span class="w"> </span>config<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>Instance<span class="w"> </span>Ignite<span class="w"> </span>config<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>Instance<span class="w"> </span>binaries<span class="w"> </span>linked.</code> <br/><code>OK<span class="w">     </span>Instance<span class="w"> </span>config<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>Data<span class="w"> </span>folder<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>Database<span class="w"> </span>folder<span class="w"> </span>created:<span class="w"> </span>No<span class="w"> </span></code> <br/><code>OK<span class="w">     </span>Streams<span class="w"> </span>folder<span class="w"> </span>created:<span class="w"> </span>No<span class="w"> </span></code> <br/><code>OK<span class="w">     </span>Logs<span class="w"> </span>folder<span class="w"> </span>created:<span class="w"> </span>Yes</code> <br/><code>OK<span class="w">     </span>Used<span class="w"> </span>version:<span class="w"> </span><span class="m">5</span>.0.0000.0</code> <br/><code>OK<span class="w">     </span>Logs<span class="w"> </span>configured.</code> <br/><code>OK<span class="w">     </span>Sites<span class="w"> </span>created.</code> <br/><code>OK<span class="w">     </span>Sites<span class="w"> </span>enabled.</code> <br/><code>OK<span class="w">     </span>API<span class="w"> </span>Gateway<span class="w"> </span>configured.</code> <br/><code>OK<span class="w">     </span>Link<span class="w"> </span>to<span class="w"> </span>binaries<span class="w"> </span>is<span class="w"> </span>valid.</code> <br/><code>OK<span class="w">     </span>Instance<span class="w"> </span>service<span class="w"> </span>started.</code> <br/><code>OK<span class="w">     </span>Instance<span class="w"> </span>API<span class="w"> </span>gateway<span class="w"> </span>service<span class="w"> </span>started.</code> <br/><code>OK<span class="w">     </span>Instance<span class="w"> </span>adapter<span class="w"> </span>host<span class="w"> </span>service<span class="w"> </span>started.</code> <br/><code>OK<span class="w">     </span>NGINX<span class="w"> </span>started.</code> <br/><code>OK<span class="w">     </span>Final<span class="w"> </span>status.</code> <br/><code><span class="o">[</span>Done<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>CBAP<span class="w"> </span>instance.</code> <br/></pre></code></div>
</li>
<li>
<p>Удостоверьтесь, что была создана директория с файлами конфигурации экземпляра ПО.</p>
<div class="highlight"><code><pre><span></span><code>ls<span class="w"> </span>-lhF<span class="w"> </span>/var/www/&lt;instanceName&gt;/</code> <br/></pre></code></div>
</li>
<li>
<p>По выводу команды <code>ls</code> удостоверьтесь, что в путях указана корректная версия ПО, например <code>5.0.0000.0</code>:</p>
<div class="highlight"><code><pre><span></span><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">36</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>bin<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/bin/</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">41</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>compiled<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/compiled/</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">37</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>data<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/data/</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">44</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>favicon.ico<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/favicon.ico</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">44</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>Global.asax<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/Global.asax</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">39</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>mobile<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/mobile/</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">46</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>redirect.aspx<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/redirect.aspx</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">42</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>resources<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/resources/</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">43</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>robots.txt<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/robots.txt</code> <br/><code>lrwxrwxrwx.<span class="w"> </span><span class="m">1</span><span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w">   </span><span class="m">45</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">17</span>:54<span class="w"> </span>unauthorized<span class="w"> </span>-&gt;<span class="w"> </span>/var/www/.cmw_version/5.0.0000.0/unauthorized/</code> <br/></pre></code></div>
</li>
</ol>
<h3 class="pageBreakBefore" id="создание-дополнительного-экземпляра-по">Создание дополнительного экземпляра ПО</h3>
<p>На одном сервере можно развернуть несколько экземпляров ПО <strong>Comindware Platform</strong>. Для создания второго и последующих экземпляров ПО выполните указанные ниже действия.</p>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Просмотрите список имеющихся экземпляров ПО <strong>Comindware Platform</strong>:</p>
<div class="highlight"><code><pre><span></span><code>cat<span class="w"> </span>/usr/share/comindware/configs/instance/*<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">'(configPath:)'</span></code> <br/></pre></code></div>
</li>
<li>
<p>Просмотрите список используемых портов:</p>
<div class="highlight"><code><pre><span></span><code>ss<span class="w"> </span>-tunlp</code> <br/></pre></code></div>
<p>Также можно узнать, используется ли определённый порт (<code>&lt;portNumber&gt;</code>):</p>
<div class="highlight"><code><pre><span></span><code>ss<span class="w"> </span>-tunlp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:&lt;portNumber&gt;</code> <br/></pre></code></div>
</li>
<li>
<p>Просмотрите список установленных версий ПО:</p>
<div class="highlight"><code><pre><span></span><code>ls<span class="w"> </span>/var/www/.cmw_version/</code> <br/></pre></code></div>
</li>
<li>
<p>Создайте новый экземпляр ПО согласно приведённым выше <a class="mkdocs_imported_link" href="#создание-экземпляра-по">инструкциям</a>, указав для него <strong>уникальные имя и порт</strong>.</p>
</li>
<li>
<p>Откройте для редактирования три службы <strong>каждого</strong> из установленных экземпляров ПО (<code>&lt;instanceName&gt;</code>):</p>
<div class="highlight"><code><pre><span></span><code>nano<span class="w"> </span>/usr/lib/systemd/system/comindware&lt;instanceName&gt;.service</code> <br/><code>nano<span class="w"> </span>/usr/lib/systemd/system/apigateway&lt;instanceName&gt;.service</code> <br/><code>nano<span class="w"> </span>/usr/lib/systemd/system/adapterhost&lt;instanceName&gt;.service</code> <br/></pre></code></div>
</li>
<li>
<p>Если используются локальные службы Kafka и OpenSearch (Elasticsearch), откройте их для редактирования:</p>
<div class="highlight"><code><pre><span></span><code>nano<span class="w"> </span>/usr/lib/systemd/system/kafka.service</code> <br/><code>nano<span class="w"> </span>/usr/lib/systemd/system/elasticsearch.service</code> <br/></pre></code></div>
</li>
<li>
<p>В каждом файле службы установите следующие директивы:</p>
<div class="highlight"><code><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">Макс</span><span class="p">.</span><span class="w"> </span><span class="n">количество</span><span class="w"> </span><span class="n">открытых</span><span class="w"> </span><span class="n">файлов</span></code> <br/><code><span class="n">LimitNOFILE</span><span class="o">=</span><span class="mi">200000</span></code> <br/><code><span class="err">#</span><span class="w"> </span><span class="n">Макс</span><span class="p">.</span><span class="w"> </span><span class="n">количество</span><span class="w"> </span><span class="n">процессов</span></code> <br/><code><span class="n">LimitNPROC</span><span class="o">=</span><span class="mi">8192</span></code> <br/></pre></code></div>
</li>
</ol>
<h2 id="запуск-экземпляра-по">Запуск экземпляра ПО</h2>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Удостоверьтесь, что основные службы установлены, запущены и имеют статус <code>Active (running)</code>:</p>
<div class="highlight"><code><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>comindware&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>apigateway&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>adapterhost&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>kafka</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>nginx</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>elasticsearch</code> <br/></pre></code></div>
</li>
<li>
<p>Если какая-либо служба не работает, запустите её:</p>
<div class="highlight"><code><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>comindware&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>start<span class="w"> </span>apigateway&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>start<span class="w"> </span>adapterhost&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>start<span class="w"> </span>kafka</code> <br/><code>systemctl<span class="w"> </span>start<span class="w"> </span>nginx</code> <br/><code>systemctl<span class="w"> </span>start<span class="w"> </span>elasticsearch</code> <br/></pre></code></div>
</li>
<li>
<p>Выполните инициализацию ПО.</p>
</li>
</ol>
<p><a class="mkdocs_imported_link" href="" id="initialize_instance"></a></p>
<h2 class="pageBreakBefore" id="deploy_guide_linux_initialize">Инициализация Comindware Platform</h2>
<ol class="colored_numbers_list">
<li>
<p>Запустите веб-браузер и в адресной строке введите URL-адрес, на котором был развёрнут экземпляр ПО:</p>
<div class="highlight"><code><pre><span></span><code>http://&lt;instanceHost&gt;:&lt;portNumber&gt;</code> <br/></pre></code></div>
</li>
<li>
<p>Дождитесь запуска и отображения веб-сайта <strong>Comindware Platform</strong>, что может занять примерно 5 минут.</p>
</li>
<li>
<p>Откроется страница создания аккаунта администратора <strong>Comindware Platform</strong>.</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Страница создания аккаунта администратора" src="/platform/v5.0/administration/deploy/linux/img/deploy_guide_admin_account_create.png"/><figcaption class="caption">Страница создания аккаунта администратора</figcaption></figure></p>
</li>
<li>
<p>Введите учётные данные аккаунта администратора и нажмите кнопку «<strong>Создать аккаунт</strong>».</p>
<div class="notice notice-warning">
<p class="admonition-title">Внимание!</p>
<ul>
<li>В экземпляре ПО всегда должен оставаться хотя бы один аккаунт администратора. Он может потребоваться для восстановления системы.</li>
<li>Аккаунт администратора, созданный при инициализации экземпляра ПО, не следует удалять, даже если впоследствии аккаунты будут синхронизироваться с Active Directory.</li>
</ul>
</div>
</li>
<li>
<p>При необходимости откроется страница активации ПО. Выполните <strong>онлайн-</strong> или <strong>ручную активацию</strong> либо нажмите кнопку «<strong>Пропустить</strong>» для первоначального ознакомления с ПО без активации.</p>
</li>
<li>
<p>При необходимости откроется страница настройки подключения к службе OpenSearch (Elasticsearch).</p>
<ul>
<li>В поле «<strong>URI</strong>» введите адрес сервера OpenSearch (Elasticsearch), например: <code>http://localhost:9200</code>.</li>
<li>При необходимости введите <strong>имя пользователя</strong> и <strong>пароль</strong> OpenSearch (Elasticsearch).</li>
<li>Установите уникальный <strong>префикс индекса</strong>, например <code>mycompanyprefix</code>.</li>
<li>Экземпляр ПО будет взаимодействовать с OpenSearch (Elasticsearch) под указанным пользователем и создавать, наполнять и читать индексы с заданным префиксом.</li>
<li>Нажмите кнопку «<strong>Далее</strong>».</li>
</ul>
</li>
<li>
<p>При необходимости откроется страница инициализации данных в OpenSearch (Elasticsearch).</p>
<p><figure class="screenshot_with_caption" markdown=""><img alt="Страница инициализации данных в OpenSearch (Elasticsearch)" src="/platform/v5.0/administration/deploy/linux/img/deploy_guide_elasticsearch_initialize.png"/><figcaption class="caption">Страница инициализации данных в OpenSearch (Elasticsearch)</figcaption></figure></p>
</li>
<li>
<p>Нажмите кнопку «<strong>Обновить</strong>».</p>
</li>
<li>Дождитесь открытия начальной страницы <strong>Comindware Platform</strong>.</li>
<li>На этом этапе развертывание экземпляра <strong>Comindware Platform</strong> завершено и можно приступать к созданию и использованию приложений.</li>
</ol>
<h2 id="оптимизация-параметра-vmmax_map_count">Оптимизация параметра vm.max_map_count</h2>
<p><code>vm.max_map_count</code> — это параметр конфигурации ядра Linx, задающий максимальное количество областей памяти, которые процессу разрешено выделять в своём виртуальном адресном пространстве.</p>
<p>Типовое для <strong>Comindware Platform</strong> значение параметра <code>vm.max_map_count</code> равно <code>262144</code>.</p>
<p>Чтобы определить оптимальное для вашей конфигурации значение <code>vm.max_map_count</code>, выполните указанные ниже инструкции.</p>
<p>Например, оптимизировать <code>vm.max_map_count</code> может потребоваться, если после запуска экземпляра ПО команда <code>journalctl</code> выдаёт ошибку следующего вида:</p>
<div class="highlight"><code><pre><span></span><code><span class="n">mmap</span><span class="p">(</span><span class="n">PROT_NONE</span><span class="p">)</span><span class="w"> </span><span class="n">failed</span></code> <br/></pre></code></div>
<ol class="colored_numbers_list">
<li>
<p>Определите текущее значение <code>vm.max_map_count</code>:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>sysctl<span class="w"> </span>vm.max_map_count</code> <br/></pre></code></div>
</li>
<li>
<p>Определите выделенный объём оперативной памяти:</p>
<div class="highlight"><code><pre><span></span><code>free</code> <br/></pre></code></div>
<p>Обратите внимание на общий объём оперативной памяти.</p>
</li>
<li>
<p>Определите размер страницы в оперативной памяти:</p>
<div class="highlight"><code><pre><span></span><code><span class="nb">declare</span><span class="w"> </span>-i<span class="w"> </span><span class="nv">NEW_max_map_count</span><span class="o">=</span><span class="k">$(</span>vmstat<span class="w"> </span>-s<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s1">'total memory'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">' {print $1}'</span><span class="k">)</span>*1024/<span class="k">$(</span>getconf<span class="w"> </span>PAGE_SIZE<span class="k">)</span></code> <br/><code><span class="nb">echo</span><span class="w"> </span><span class="nv">$NEW_max_map_count</span></code> <br/></pre></code></div>
</li>
<li>
<p>Полученное значение <code>NEW_max_map_count</code> временно присвойте параметру <code>vm.max_map_count</code> и проверьте работу экземпляра ПО:</p>
<ul>
<li>Временное изменение значения (например, для тестирования):</li>
</ul>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>vm.max_map_count<span class="o">=</span><span class="nv">$NEW_max_map_count</span></code> <br/></pre></code></div>
</li>
<li>
<p>Удостоверившись в работоспособности экземпляра ПО, задайте постоянное значение <code>vm.max_map_count</code>:</p>
<ul>
<li>
<p>Откройте для редактирования файл <code>/etc/sysctl.conf</code>:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/sysctl.conf</code> <br/></pre></code></div>
</li>
<li>
<p>Установите значение <code>vm.max_map_count</code>:</p>
<div class="highlight"><code><pre><span></span><code><span class="n">vm</span><span class="p">.</span><span class="n">max_map_count</span><span class="o">=&lt;</span><span class="n">NEW_max_map_count</span><span class="o">&gt;</span></code> <br/></pre></code></div>
<p><code>&lt;NEW_max_map_count&gt;</code> замените на полученное на шаге 3 цифровое значение.</p>
</li>
<li>
<p>Примените изменения:</p>
<div class="highlight"><code><pre><span></span><code>sysctl<span class="w"> </span>-p</code> <br/></pre></code></div>
</li>
</ul>
</li>
</ol>
<h2 class="pageBreakBefore" id="остановка-экземпляра-по">Остановка экземпляра ПО</h2>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Перед тем как выполнять любые действия с файлами ПО и базы данных, остановите службы, поддерживающие работу ПО:</p>
<div class="highlight"><code><pre><span></span><code>systemctl<span class="w"> </span>stop<span class="w"> </span>comindware&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>stop<span class="w"> </span>apigateway&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>stop<span class="w"> </span>adapterhost&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>stop<span class="w"> </span>kafka</code> <br/><code>systemctl<span class="w"> </span>stop<span class="w"> </span>nginx</code> <br/><code>systemctl<span class="w"> </span>stop<span class="w"> </span>elasticsearch</code> <br/></pre></code></div>
</li>
<li>
<p>Удостоверьтесь, что службы остановлены:</p>
<div class="highlight"><code><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>comindware&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>apigateway&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>adapterhost&lt;instanceName&gt;</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>kafka</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>nginx</code> <br/><code>systemctl<span class="w"> </span>status<span class="w"> </span>elasticsearch</code> <br/></pre></code></div>
</li>
</ol>
<h2 id="удаление-версии-и-экземпляра-по">Удаление версии и экземпляра ПО</h2>
<p>Прежде чем приступать к удалению версии и экземпляра ПО <strong>Comindware Platform</strong>, ознакомьтесь с видеороликом и инструкциями, представленными ниже.</p>
<h3 id="видеоинструкция_3">Видеоинструкция</h3>
<video controls="controls" height="100%" width="100%">
<source src="https://kb.comindware.ru/platform/v5.0/administration/deploy/linux/img/deploy_guide_linux_delete_version_instance.mp4" type="video/mp4"/>
</video>
<h3 class="pageBreakBefore" id="удаление-экземпляра-по">Удаление экземпляра ПО</h3>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Остановите экземпляр ПО согласно <a class="mkdocs_imported_link" href="#остановка-экземпляра-по">инструкции</a>.</p>
</li>
<li>
<p>Перейдите в директорию со скриптами для развёртывания ПО <strong>Comindware Platform</strong>:</p>
<div class="highlight"><code><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>&lt;distPath&gt;/CMW_&lt;osname&gt;_&lt;versionNumber&gt;/scripts</code> <br/></pre></code></div>
</li>
<li>
<p>Запустите удаление экземпляра ПО:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>instance_delete.sh<span class="w"> </span>-n<span class="o">=</span>&lt;instanceName&gt;</code> <br/></pre></code></div>
<p>Скрипт <code>delete.sh</code> поддерживает следующие ключи:</p>
<ul>
<li><code>-n=&lt;instanceName&gt;</code> — удалить экземпляр ПО с указанным именем (<strong>обязательный</strong> ключ).</li>
<li><code>--delete-data=true</code> — безвозвратно удалить все файлы базы данных экземпляра ПО (необязательный ключ).</li>
<li><code>-h</code> — вызов краткой справки по использованию скрипта (указывать только без остальных ключей).</li>
</ul>
</li>
<li>
<p>Удостоверьтесь, что экземпляр ПО был успешно удалён, просмотрев список установленных экземпляров ПО:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>instance_list.sh</code> <br/></pre></code></div>
</li>
</ol>
<h3 class="pageBreakBefore" id="deploy_guide_linux_delete_version">Удаление версии ПО</h3>
<ol class="colored_numbers_list">
<li>
<p>Перейдите в режим суперпользователя:</p>
<div class="highlight"><code><pre><span></span><code>sudo<span class="w"> </span>-s</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>su<span class="w"> </span>-</code> <br/></pre></code></div>
</li>
<li>
<p>Просмотрите список экземпляров ПО с указанием версий:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>instance_list.sh</code> <br/></pre></code></div>
</li>
<li>
<p>Удалите все экземпляры с версией ПО, которую требуется удалить, или обновите их до другой версии. Удалить версию ПО, которая используется в каких-либо экземплярах, не удастся. См. <em>«<a class="mkdocs_imported_link" href="#удаление-экземпляра-по">Удаление экземпляра ПО</a>»</em>.</p>
</li>
<li>
<p>Перейдите в директорию со скриптами для развёртывания ПО <strong>Comindware Platform</strong>:</p>
<div class="highlight"><code><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>&lt;distPath&gt;/CMW_&lt;osname&gt;_&lt;versionNumber&gt;/scripts</code> <br/></pre></code></div>
</li>
<li>
<p>Просмотрите список установленных версий ПО:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>version_list.sh</code> <br/></pre></code></div>
</li>
<li>
<p>Удалите версию ПО:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>version_delete.sh<span class="w"> </span>-v<span class="o">=</span>&lt;versionNumber&gt;</code> <br/></pre></code></div>
<p>Здесь: <code>-v=&lt;versionNumber&gt;</code> — укажите номер версии ПО вида <code>X.X.XXXX.X</code> (например: <code>5.0.0000.0</code>).</p>
</li>
<li>
<p>Проверьте, что версия ПО была удалена успешно:</p>
<div class="highlight"><code><pre><span></span><code>sh<span class="w"> </span>version_list.sh</code> <br/></pre></code></div>
<p>или</p>
<div class="highlight"><code><pre><span></span><code>ls<span class="w"> </span>/var/www/.cmw_version</code> <br/></pre></code></div>
</li>
</ol>
<div class="relatedTopics">
<h2 id="связанные-статьи">Связанные статьи</h2>
<ul>
<li><em><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=4620">Пути и содержимое директорий экземпляра ПО</a></em></li>
</ul>
</div>
</article>
</div>
</div>
<a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#">
<i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i>
            К началу
          </a>
</main>
</div>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></div>