<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="comindware" dir="ltr"> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <nav aria-label="Содержание" class="md-nav md-nav--secondary"> <div class="mce-toc"> <h2 class="toc-heading"> Содержание </h2> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#ввод-заготовки-конструкции-from-where-select"> <span class="md-ellipsis"> Ввод заготовки конструкции from where select </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#синтаксис-запроса-from-where-select"> <span class="md-ellipsis"> Синтаксис запроса from where select </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#ввод-запроса-из-атрибута-текущего-шаблона"> <span class="md-ellipsis"> Ввод запроса из атрибута текущего шаблона </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#ввод-запроса-из-шаблона-текущего-приложения"> <span class="md-ellipsis"> Ввод запроса из шаблона текущего приложения </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#ввод-системного-имени-атрибута-после-переменной-селектора"> <span class="md-ellipsis"> Ввод системного имени атрибута после переменной-селектора </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link mkdocs_imported_link" href="#практический-пример"> <span class="md-ellipsis"> Практический пример </span> </a> </li> </ul> </div> </nav> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset">  <p>Запрос <code class="highlight"><span class="k">from</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">select</span></code> возвращает список значений из указанного источника данных, соответствующих заданному условию.</p> <h2 id="ввод-заготовки-конструкции-from-where-select">Ввод заготовки конструкции from where select</h2> <p>С помощью предиктивного ввода можно вставить заготовку запроса <code class="highlight"><span class="k">from</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">select</span></code>.</p> <ol class="colored_numbers_list"> <li>Нажмите клавиши <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span>.</li> <li>Отобразится список источников данных для запроса — атрибутов типа «<strong>Запись</strong>» в текущем шаблоне и шаблонов в текущем приложении. <figure class="screenshot_with_caption" markdown=""><img alt="Список источников данных для запроса from where select" src="https://kb.comindware.ru/assets/formula_editor_from_where_select_autocomplete_data_source.png"/><figcaption class="caption">Список источников данных для запроса from where select</figcaption></figure></li> <li>Дважды нажмите системное имя атрибута или шаблона в списке, чтобы вставить в формулу заготовку конструкции <code class="highlight"><span class="k">from</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">select</span></code> для него: <figure class="screenshot_with_caption" markdown=""><img alt="Заготовка конструкции from where select" src="https://kb.comindware.ru/assets/formula_editor_from_where_select_autocomplete_entered_source_attribute.png"/><figcaption class="caption">Заготовка конструкции from where select</figcaption></figure></li> <li>Замените строку <code>Ваше условие</code> после оператора <code class="highlight"><span class="k">where</span></code> на условие выборки записей из источника данных.</li> </ol> <div class="notice notice-info"> <p class="admonition-title">Примечание</p> <ul> <li>В качестве источника данных для запроса <code class="highlight"><span class="k">from</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">select</span></code> рекомендуется использовать атрибут типа «<strong>Запись</strong>», содержащий ID записей, из которых требуется произвести выборку.</li> <li>Запрос по записям, связанным с атрибутом, выполняется быстрее, чем запрос по всем записям из шаблона.</li> <li>В качестве источника данных можно использовать атрибуты типа «<strong>Запись</strong>», у которых установлен флажок «<strong>Хранить несколько значений</strong>».</li> <li>Атрибуты, подходящие для запроса, отображаются в подсказке в начале списка с префиксом <code>$</code> и суффиксом <code>(запрос)</code>: <code>$AttributeName (запрос)</code>.</li> </ul> </div> <h2 id="синтаксис-запроса-from-where-select">Синтаксис запроса from where select</h2> <ul> <li><code class="highlight"><span class="k">from</span><span class="w"> </span><span class="n">a</span></code> — объявление локальной переменной-селектора <code>a</code>, в которую будут помещены записи из источника данных.</li> <li><code class="highlight"><span class="k">in</span></code> — объявление источника данных:<ul> <li><code class="highlight"><span class="n">db</span><span class="o">-&gt;</span><span class="n">TemplateName</span></code> — шаблон записи с системным именем <code>TemplateName</code>;</li> <li><code class="highlight"><span class="n">$RecordAttributeName</span></code> — атрибут типа «<strong>Запись</strong>» с системным именем <code>RecordAttributeName</code>, хранящий несколько значений;</li> <li><code class="highlight"><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">select</span><span class="p">)</span></code> — вложенный запрос. Вложенный запрос необходимо заключить в скобки и использовать в нём уникальную переменную-селектор: <div class="highlight"><code><pre><span></span><code><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">$DataSource2</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Condition2</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Attribute2</span><span class="p">)</span><span class="w"> </span></code><br/>
<code><span class="k">where</span><span class="w"> </span><span class="n">Condition1</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Attribute1</span></code><br/>
</pre></code></div></li> </ul> </li> <li><code class="highlight"><span class="k">where</span><span class="w"> </span><span class="k">Condition</span></code> — выбор записей, для которых выражение <code>Condition</code> возвращает <code>true</code>.</li> <li><code class="highlight"><span class="n">orderby</span><span class="w"> </span><span class="n">SortAttribute</span><span class="w"> </span><span class="n">ascending</span></code> — сортировка записей по значению атрибута <code>SortAttribute</code>. Порядок сортировки указывается оператором <code>ascending</code> — по возрастанию (порядок по умолчанию, указывать необязательно) или <code>descending</code> — по убыванию.</li> <li><code class="highlight"><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">ReturnAttribute</span></code> — выборка значений атрибута <code>ReturnAttribute</code> записей из источника данных. Оператор <code>select</code> может содержать выражение.</li> </ul> <div class="highlight"><span class="filename">Пример: запрос записей районов Москвы с сортировкой по убыванию названия района</span><code><pre><span></span><code><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">$Cities</span><span class="w"> </span></code><br/>
<code><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">CityName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Москва"</span><span class="w"> </span></code><br/>
<code><span class="n">orderby</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Districts</span><span class="o">-&gt;</span><span class="n">DistrictName</span><span class="w"> </span><span class="n">descending</span><span class="w"> </span></code><br/>
<code><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Districts</span></code><br/>
</pre></code></div> <div class="highlight"><span class="filename">Пример: запрос названий и авторов книг, у которых указан автор, с сортировкой по возрастанию имени автора и выводом в формате «Название: название книги. Автор: имя автора»</span><code><pre><span></span><code><span class="k">from</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">$Books</span><span class="w"> </span></code><br/>
<code><span class="k">where</span><span class="w"> </span><span class="k">NOT</span><span class="p">(</span><span class="k">EMPTY</span><span class="p">(</span><span class="n">book</span><span class="o">-&gt;</span><span class="n">Author</span><span class="p">))</span><span class="w"> </span></code><br/>
<code><span class="n">orderby</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">boook</span><span class="o">-&gt;</span><span class="n">Author</span><span class="o">-&gt;</span><span class="k">Name</span><span class="w"> </span></code><br/>
<code><span class="k">select</span><span class="w"> </span><span class="nf">CONCAT</span><span class="p">(</span><span class="k">LIST</span><span class="p">(</span><span class="s1">'Название: '</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="o">-&gt;</span><span class="k">Name</span><span class="p">,</span><span class="w"> </span><span class="s1">'. Автор: '</span><span class="p">,</span><span class="w"> </span><span class="n">book</span><span class="o">-&gt;</span><span class="n">Author</span><span class="o">-&gt;</span><span class="k">Name</span><span class="p">))</span></code><br/>
</pre></code></div> <div class="notice notice-warning"> <p class="admonition-title">Внимание! Зарезервированные слова</p> <p>Следующие слова нельзя использовать в запросе в качестве локальной переменной, так как они зарезервированы как системные:</p> <ul> <li><code>and</code>, <code>ascending</code>, <code>between</code>, <code>by</code>, <code>db</code>, <code>descending</code>, <code>equals</code>, <code>from</code>, <code>group</code>, <code>in</code>, <code>into</code>, <code>item</code>, <code>join</code>, <code>let</code>, <code>on</code>, <code>orderby</code>, <code>select</code>, <code>source</code>, <code>where</code></li> <li>слова, начинающиеся с подчеркивания (<code>_</code>)</li> <li>имена функций и литералы</li> </ul> </div> <h2 id="ввод-запроса-из-атрибута-текущего-шаблона">Ввод запроса из атрибута текущего шаблона</h2> <ol class="colored_numbers_list"> <li>Введите строку: <div class="highlight"><code><pre><span></span><code><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span></code><br/>
</pre></code></div></li> <li>После ввода оператора <code>in</code> отобразится список доступных источников данных. Этот список также можно вызвать, нажав клавиши <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span> в позиции после оператора <code>in</code>. <figure class="screenshot_with_caption" markdown=""><img alt="Список источников данных" src="https://kb.comindware.ru/assets/formula_editor_application_templates_autocomplete_attribute_source.png"/><figcaption class="caption">Список источников данных</figcaption></figure></li> <li>Дважды нажмите системное имя атрибута типа «<strong>Запись</strong>», отображающегося в списке с префиксом <code>$</code> и <strong><em>без суффикса</em></strong> <code>(запрос)</code>, чтобы вставить его в формулу.</li> <li>Введите условие выборки записей и атрибут для выборки с помощью операторов <code>where</code> и <code>select</code>.</li> </ol> <div class="highlight"><span class="filename">Пример: формула, возвращающая список записей в шаблоне, связанном с атрибутом Costs, в которых значение атрибута TotalAmount больше значения атрибута PlannedCosts в текущей записи</span><code><pre><span></span><code><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">$Costs</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">TotalAmount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">$PlannedCosts</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">id</span></code><br/>
</pre></code></div> <h2 id="ввод-запроса-из-шаблона-текущего-приложения">Ввод запроса из шаблона текущего приложения</h2> <ol class="colored_numbers_list"> <li>Введите строку: <div class="highlight"><code><pre><span></span><code><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">db</span><span class="o">-&gt;</span><span class="w"> </span></code><br/>
</pre></code></div></li> <li>После ввода символов <code>db-&gt;</code> отобразится список шаблонов текущего приложения. Этот список также можно вызвать, нажав клавиши <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span> в позиции после <code>db-&gt;</code>. <figure class="screenshot_with_caption" markdown=""><img alt="Список шаблонов в текущем приложении" src="https://kb.comindware.ru/assets/formula_editor_application_templates_autocomplete.png"/><figcaption class="caption">Список шаблонов в текущем приложении</figcaption></figure></li> <li>Дважды нажмите системное имя шаблона, чтобы вставить его в формулу.</li> <li>Введите условие выборки записей и атрибут для выборки с помощью операторов <code>where</code> и <code>select</code>.</li> </ol> <div class="highlight"><span class="filename">Пример: формула, возвращающая количество записей в шаблоне Cars, с таким же значением атрибута Make, как в текущей записи</span><code><pre><span></span><code><span class="nf">COUNT</span><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">db</span><span class="o">-&gt;</span><span class="n">Cars</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Make</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">$Make</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span></code><br/>
</pre></code></div> <h2 id="ввод-системного-имени-атрибута-после-переменной-селектора">Ввод системного имени атрибута после переменной-селектора</h2> <p>Здесь используется приведённый ниже <a class="mkdocs_imported_link" href="#app-configuration">пример конфигурации приложения</a>.</p> <ol class="colored_numbers_list"> <li>Введите строку: <div class="highlight"><code><pre><span></span><code><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">$RequestedCars</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span></code><br/>
</pre></code></div></li> <li>После ввода символов <code>a-&gt;</code> отобразится список атрибутов шаблона, связанного с атрибутом <code>RequestedCars</code>, на который ссылается локальная переменная-селектор <code>a</code>. Этот список также можно вызвать, нажав клавиши <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span> в позиции после <code>a-&gt;</code>. <figure class="screenshot_with_caption" markdown=""><img alt="Список атрибутов, вызванный посредством переменной-селектора" src="https://kb.comindware.ru/assets/formula_editor_linked_record_attributes_selector_autocomplete.png"/><figcaption class="caption">Список атрибутов, вызванный посредством переменной-селектора</figcaption></figure></li> <li>Дважды нажмите системное имя атрибута <code>_creator</code>, чтобы вставить его в формулу. <code>_creator</code> — это <strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2242">системный атрибут</a></strong>, в котором хранится ID аккаунта, создавшего запись.</li> <li>Введите строку: <div class="highlight"><code><pre><span></span><code><span class="o">==</span><span class="w"> </span><span class="k">USER</span><span class="p">()</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">id</span></code><br/>
</pre></code></div></li> </ol> <div class="highlight"><span class="filename">Пример: формула, возвращающая количество записей в шаблоне, связанном с атрибутом RequestedCars, созданных под текущим аккаунтом</span><code><pre><span></span><code><span class="nf">COUNT</span><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">$RequestedCars</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">_creator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">USER</span><span class="p">()</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span></code><br/>
<code></code><br/>
<code><span class="c1">## Ввод системного имени атрибута из цепочки связанных шаблонов</span></code><br/>
<code></code><br/>
<code><span class="n">Здесь</span><span class="w"> </span><span class="n">используется</span><span class="w"> </span><span class="n">приведённый</span><span class="w"> </span><span class="n">ниже</span><span class="w"> </span><span class="err">[</span><span class="n">пример</span><span class="w"> </span><span class="n">конфигурации</span><span class="w"> </span><span class="n">приложения</span><span class="err">]</span><span class="p">(</span><span class="c1">#app-configuration).</span></code><br/>
<code></code><br/>
<code><span class="mf">1.</span><span class="w"> </span><span class="n">Введите</span><span class="w"> </span><span class="n">строку</span><span class="o">:</span></code><br/>
<code><span class="w">      </span><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">mysql</span></code><br/>
<code><span class="n n-Quoted">      from a in $$RequestedCars where b-&gt;_creator-&gt;</span></code><br/>
<code><span class="n n-Quoted">      </span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span></code><br/>
<code><span class="mf">2.</span><span class="w"> </span><span class="n">После</span><span class="w"> </span><span class="n">ввода</span><span class="w"> </span><span class="n">символов</span><span class="w"> </span><span class="n n-Quoted">`_creator-&gt;`</span><span class="w"> </span><span class="n">отобразится</span><span class="w"> </span><span class="n">список</span><span class="w"> </span><span class="n">атрибутов</span><span class="w"> </span><span class="n">системного</span><span class="w"> </span><span class="o">**</span><span class="err">[</span><span class="n">шаблона</span><span class="w"> </span><span class="n">аккаунта</span><span class="err">][</span><span class="n">attribute_account</span><span class="err">]</span><span class="o">**</span><span class="p">,</span><span class="w"> </span><span class="n">с</span><span class="w"> </span><span class="n">которым</span><span class="w"> </span><span class="n">связан</span><span class="w"> </span><span class="n">системный</span><span class="w"> </span><span class="n">атрибут</span><span class="w"> </span><span class="n n-Quoted">`_creator`</span><span class="p">.</span><span class="w"> </span><span class="n">Этот</span><span class="w"> </span><span class="n">список</span><span class="w"> </span><span class="n">также</span><span class="w"> </span><span class="n">можно</span><span class="w"> </span><span class="n">вызвать</span><span class="p">,</span><span class="w"> </span><span class="n">нажав</span><span class="w"> </span><span class="n">клавиши</span><span class="w"> </span><span class="o">++</span><span class="n">ctrl</span><span class="o">+</span><span class="n">space</span><span class="o">++</span><span class="w"> </span><span class="n">в</span><span class="w"> </span><span class="n">позиции</span><span class="w"> </span><span class="n">после</span><span class="w"> </span><span class="n">оператора</span><span class="w"> </span><span class="n n-Quoted">`-&gt;`</span><span class="p">.</span></code><br/>
<code><span class="o">&lt;</span><span class="n">figure</span><span class="w"> </span><span class="n">markdown</span><span class="o">&gt;!</span><span class="err">[</span><span class="n">Список</span><span class="w"> </span><span class="n">атрибутов</span><span class="p">,</span><span class="w"> </span><span class="n">вызванный</span><span class="w"> </span><span class="n">по</span><span class="w"> </span><span class="n">цепочке</span><span class="w"> </span><span class="n">связанных</span><span class="w"> </span><span class="n">шаблонов</span><span class="err">]</span><span class="p">(</span><span class="n">img</span><span class="o">/</span><span class="n">formula_editor_linked_record_attributes_selector_nested_autocomplete</span><span class="p">.</span><span class="n">png</span><span class="p">)</span><span class="o">&lt;</span><span class="n">figcaption</span><span class="o">&gt;</span><span class="n">Список</span><span class="w"> </span><span class="n">атрибутов</span><span class="p">,</span><span class="w"> </span><span class="n">вызванный</span><span class="w"> </span><span class="n">по</span><span class="w"> </span><span class="n">цепочке</span><span class="w"> </span><span class="n">связанных</span><span class="w"> </span><span class="n">шаблонов</span><span class="o">&lt;/</span><span class="n">figcaption</span><span class="o">&gt;&lt;/</span><span class="n">figure</span><span class="o">&gt;</span></code><br/>
<code><span class="mf">3.</span><span class="w"> </span><span class="n">Дважды</span><span class="w"> </span><span class="n">нажмите</span><span class="w"> </span><span class="n">системное</span><span class="w"> </span><span class="n">имя</span><span class="w"> </span><span class="n">атрибута</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">чтобы</span><span class="w"> </span><span class="n">вставить</span><span class="w"> </span><span class="n">его</span><span class="w"> </span><span class="n">в</span><span class="w"> </span><span class="n">формулу</span><span class="p">.</span></code><br/>
<code><span class="mf">4.</span><span class="w"> </span><span class="n">Введите</span><span class="w"> </span><span class="n">строку</span><span class="o">:</span></code><br/>
<code><span class="w">      </span><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">mysql</span></code><br/>
<code><span class="n n-Quoted">      == "admin" select a-&gt;id</span></code><br/>
<code><span class="n n-Quoted">      </span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">`</span></code><br/>
<code></code><br/>
<code><span class="n n-Quoted">`</span><span class="n n-Quoted n-Quoted-Escape">``</span><span class="n n-Quoted">mysql title="Пример: формула, возвращающая список записей в шаблоне, связанном с атрибутом $RequestedCars, созданных под аккаунтом admin"</span></code><br/>
<code><span class="n n-Quoted">from a in $RequestedCars where a-&gt;_creator-&gt;username == "admin" select a-&gt;id</span></code><br/>
</pre></code></div> <h2 id="практический-пример">Практический пример</h2> <div class="notice notice-tip"> <p class="admonition-title">Подсчёт количества автомобилей марки «Лада» в заявке</p> <p><strong id="app-configuration">Конфигурация приложения</strong></p> <ul> <li>Шаблон записи <em>«Заявка на автомобили»</em><ul> <li>Атрибут <em>«Запрошенные автомобили»</em><ul> <li><strong>Системное имя</strong>: <em>RequestedCars</em></li> <li><strong>Тип данных</strong>: <strong>запись</strong></li> <li><strong>Связанный шаблон</strong>: <em>Автомобили</em></li> <li><strong>Хранить несколько значений</strong>: флажок установлен</li> </ul> </li> <li>Запись: заявка на несколько автомобилей разных марок</li> </ul> </li> <li>Шаблон записи <em>«Автомобили»</em><ul> <li>Атрибут <em>«Марка»</em><ul> <li><strong>Системное имя</strong>: <em>Make</em></li> <li><strong>Тип данных</strong>: <strong>текст</strong></li> <li><strong>Использовать как заголовок записей</strong>: флажок установлен</li> </ul> </li> <li>Записи: <code>УАЗ</code>, <code>Москвич</code>, <code>Лада</code></li> </ul> </li> </ul> <p><strong>Составление формулы</strong></p> <ol class="colored_numbers_list"> <li>Введите функцию <code class="highlight"><span class="nf">COUNT</span><span class="p">()</span></code>. См. «<strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2465">Ввод имени функции и просмотр подсказки по функции</a></strong>».</li> <li>В позиции аргумента функции нажмите клавиши <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span>.</li> <li>Отобразится список источников данных. <figure class="screenshot_with_caption" markdown=""><img alt="Список источников данных для запроса" src="https://kb.comindware.ru/assets/formula_editor_from_where_select_autocomplete.png"/><figcaption class="caption">Список источников данных для запроса</figcaption></figure></li> <li>Дважды нажмите в списке пункт <em>$RequestedCars (запрос)</em>, чтобы вставить в формулу заготовку конструкции <code class="highlight"><span class="k">from</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">select</span></code> для него: <figure class="screenshot_with_caption" markdown=""><img alt="Заготовка запроса" src="https://kb.comindware.ru/assets/formula_editor_from_where_select_autocomplete_entered.png"/><figcaption class="caption">Заготовка запроса</figcaption></figure></li> <li>Выделите строку <code>Ваше условие</code> после оператора <code class="highlight"><span class="k">where</span></code>, чтобы заменить её на условие выборки записей из шаблона <em>«Автомобили»</em>.</li> <li>Введите строку <code class="highlight"><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span></code>.</li> <li>В отобразившемся списке атрибутов шаблона <em>«Автомобили»</em> дважды нажмите системное имя атрибута <em>Make</em>, чтобы вставить его в формулу. См. «<strong>Ввод системного имени атрибута после переменной-селектора</strong>» <figure class="screenshot_with_caption" markdown=""><img alt="Список атрибутов шаблона _«Автомобили»_" src="https://kb.comindware.ru/assets/formula_editor_from_where_select_autocomplete_condition_record_attribute_list.png"/><figcaption class="caption">Список атрибутов шаблона <em>«Автомобили»</em></figcaption></figure></li> <li>Введите оператор <code>==</code> и нажмите клавиши <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-space">Пробел</kbd></span>.</li> <li>Отобразится список записей шаблона <em>«Автомобили»</em> в виде марок автомобилей. См. «<strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2471">Ввод заголовка записи связанного шаблона</a></strong>». <figure class="screenshot_with_caption" markdown=""><img alt="Список записей в шаблоне _«Автомобили»_" src="https://kb.comindware.ru/assets/formula_editor_from_where_select_autocomplete_condition_record_heading_list.png"/><figcaption class="caption">Список записей в шаблоне <em>«Автомобили»</em></figcaption></figure></li> <li>Дважды нажмите пункт <em>«Лада»</em>, чтобы вставить в формулу строковый литерал <code class="highlight"><span class="s2">"Лада"</span></code>.</li> </ol> <div class="highlight"><span class="filename">Формула, возвращающая количество записей, связанных с атрибутом RequestedCars, у которых атрибут Make имеет значение «Лада»</span><code><pre><span></span><code><span class="nf">COUNT</span><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">$RequestedCars</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Make</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Лада"</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span></code><br/>
</pre></code></div> <p><strong>Синтаксис формулы</strong></p> <ul> <li><code>COUNT()</code> — возвращает количество элементов в списке, переданном в качестве аргумента.</li> <li><code class="highlight"><span class="k">from</span><span class="w"> </span><span class="n">a</span></code> — объявление локальной переменной <code>a</code>.</li> <li><code class="highlight"><span class="k">in</span><span class="w"> </span><span class="n">$RequestedCars</span></code> — объявление атрибута <code>RequestedCars</code> в качестве источника данных.</li> <li><code class="highlight"><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Make</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Лада"</span></code> — выборка в переменную <code>a</code> записей, связанных с атрибутом <code>RequestedCars</code>, у которых атрибут <code>Make</code> имеет значение `"Лада".</li> <li><code class="highlight"><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">id</span></code> — выборка значений атрибута <code>id</code> полученных записей и передача списка этих значений в функцию <code>COUNT()</code>.</li> </ul> </div> <p><strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2463">Редактор выражений</a></strong></p> <p><strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/category.php?id=409" target="_blank">Примеры использования формул. База знаний Comindware</a></strong></p> <p><strong><a class="mkdocs_imported_link" href="https://kb.comindware.ru/article.php?id=2465">Ввод имени функции и просмотр подсказки по функции</a></strong></p> </article> </div> </div> <a class="md-top md-icon mkdocs_imported_link" data-md-component="top" href="#"> <i class="fa-light fa-arrow-up">&zwnj;<!--icon--></i> К началу </a> </main> </div> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>