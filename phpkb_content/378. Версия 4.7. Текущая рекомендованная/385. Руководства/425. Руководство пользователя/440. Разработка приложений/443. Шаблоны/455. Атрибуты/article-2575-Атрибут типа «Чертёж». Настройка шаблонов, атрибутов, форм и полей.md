---
title: Атрибут типа «Чертёж». Настройка шаблонов, атрибутов, форм и полей
kbId: 2575
---

# Атрибут типа «Чертёж». Настройка шаблонов, атрибутов, форм и полей

## Введение

На форме можно разместить чертёж, на котором будут отображаться данные из шаблонов записей с привязкой к объектам на чертеже.

Для использования чертежа в **{{ productName }}** потребуется подготовить файл DWG, создать несколько шаблонов и атрибутов определённых типов, поместить поле атрибута типа «**Чертёж**» на форму и привязать его к шаблонам записей и атрибутам. Конечный пользователь, в свою очередь, должен импортировать файл чертежа в формате DWG и привязать конкретные слои полигонов и маркеров на чертеже к шаблонам и атрибутам, заданным при настройке поля.

См. также *«[Чертёж. Подготовка и импорт файла DWG][drawing_attribute_file_import]»*и *«[Чертёж. Настройка поля на форме][form_dynamic_elements]»*.

## Прикладная задача

Имеется план этажа с полигонами помещений и рабочих мест. Требуется настроить отображение на форме плана этажа с обозначением помещений и рабочих мест. Необходимо обеспечить возможность оформления и просмотра заявок на обслуживание помещений и рабочих мест на плане. Заявки должны быть представлены на плане в виде цветных маркеров. Цвета помещений и заявок должны соответствовать их статусу, а цвета рабочих мест — их состоянию.

Настроим приложение для работы с планом этажа:

- настроим шаблоны, формы и атрибуты для хранения данных помещений, рабочих мест и заявок;
- создадим и заполним записи помещений и рабочих мест в соответствии с чертежом;
- импортируем файл чертежа в приложение;
- на полученном плане создадим несколько заявок.

### Исходные данные

Имеется подготовленный чертёж в формате DWG с четырьмя слоями. Для корректного импорта чертёж необходимо подготовить в соответствии с требованиями, приведёнными в статье *«[Чертёж. Подготовка и импорт файла DWG][drawing_attribute_file_import]».*

Свойства исходного чертежа:

- *Помещения* — полигоны помещений:
    - *Диспетчерская*
    - *Переговорная*
    - *Кабинет руководителя*
    - *Отдел продаж*
- *ID помещений* — текстовые блоки с идентификаторами полигонов помещений:
    - *Диспетчерская*
    - *Переговорная*
    - *Кабинет руководителя*
    - *Отдел продаж*
- *Рабочие места*— полигоны рабочих мест:
    - *Диспетчер 1*
    - *Диспетчер 2*
    - *Диспетчер 3*
    - *Стол для переговоров*
    - *Рабочее место руководителя 1*
    - *Специалист по продажам 1*
    - *Специалист по продажам 2*
    - *Специалист по продажам 3*
- *ID рабочих мест*  — текстовые блоки с идентификаторами полигонов рабочих мест:
    - *Диспетчер 1*
    - *Диспетчер 2*
    - *Диспетчер 3*
    - *Стол для переговоров*
    - *Рабочее место руководителя 1*
    - *Специалист по продажам 1*
    - *Специалист по продажам 2*
    - *Специалист по продажам 3*

## Настройка шаблонов и атрибутов

Для настройки и использования чертежа на форме создайте перечисленные ниже шаблоны записей и атрибуты.

Шаблоны и атрибуты необходимо будет привязать к объектам в файле DWG во время настройки поля атрибута типа «**Чертёж**» и при импорте файла DWG конечным пользователем.

1. Создайте три шаблона записей: *Этажи, Помещения, Рабочие места, Заявки*.
2. Настройте в шаблонах атрибуты, как указано в следующей таблице.

| **Атрибуты шаблона «*Этажи»*** | | |
| --- | --- | --- |
| **Тип данных** | **Название** | **Свойства** |
| *Текст* | *Наименование* | По умолчанию |
| *Чертёж* | *План* | По умолчанию |
| **Атрибуты шаблона «*Помещения»*** | | |
| **Тип данных** | **Название** | **Свойства** |
| *Текст* | *ID помещения* | Установлены флажки:- **Использовать как заголовок записей** - **Контролировать уникальность значений** |
| *Запись* | *Этаж* | - **Связанный шаблон**: *Этажи* - **Хранить несколько значений**: флажок снят - **Взаимная связь с атрибутом:**     - **С новым**          - **Название**: *Помещения*         - **Хранить несколько значений**: флажок установлен |
| *Список значений* | *Статус* | **Список значений:**- *Эксплуатируется* - *Не эксплуатируется* |
| *Список значений* | *Вид* | **Список значений:**- *Складское* - *Санитарное* - *Общее* - *Техническое* - *Офисное* - *Административное* |
| **Атрибуты шаблона «*Рабочие места»*** | | |
| **Тип данных** | **Название** | **Свойства** |
| *Текст* | *ID рабочего места* | Установлены флажки:- **Использовать как заголовок записей** - **Контролировать уникальность значений** |
| *Текст* | *Наименование* | По умолчанию |
| *Список значений* | *Статус* | **Список значений:**- *Свободно* - *Занято* |
| *Список значений* | *Состояние* | **Список значений:**- *Хорошее* - *Плохое* |
| *Запись (Связать с Шаблон записи Помещения)* | *Помещение* | - **Связанный шаблон:** *Помещения* - **Хранить несколько значений:** флажок снят - **Взаимная связь с атрибутом:**     - **С новым:**          - *Название:* Рабочие места         - **Хранить несколько значений:** флажок установлен |
| *Запись (Связать с Шаблон записи Этажи)* | *Этаж* | - **Связанный шаблон:** *Этажи* - **Хранить несколько значений:** флажок снят - **Взаимная связь с атрибутом:**     - **С новым:**          - *Название:* Рабочие места         - **Хранить несколько значений:** флажок установлен |
| **Атрибуты шаблона «*Заявки»*** | | |
| **Тип данных** | **Название** | **Свойства** |
| *Запись* | *Этаж* | - **Связанный шаблон:** *Этажи* - **Хранить несколько значений:** флажок снят - **Взаимная связь с атрибутом:**     - **С новым:**          - *Название:* *Заявки*         - **Хранить несколько значений:** флажок установлен |
| *Запись* | *Помещение* | - **Связанный шаблон:** *Помещения* - **Хранить несколько значений:** флажок снят - **Взаимная связь с атрибутом:**     - **С новым:**          - *Название:* *Заявки*         - **Хранить несколько значений:** флажок установлен |
| *Запись* | *Рабочее место* | - **Связанный шаблон:** *Рабочие места* - **Хранить несколько значений:** флажок снят - **Взаимная связь с атрибутом:**     - **С новым:**          - *Название:* *Заявки*         - **Хранить несколько значений:** флажок установлен |
| *Список значений* | *Статус* | **Список значений:**- *Открыта* - *Отменена* - *Выполняется* - *Выполнена* - *Ожидает проверки* - *Проверена* |

## Настройка форм и полей

1. Вынесите созданные атрибуты на основные формы шаблонов.
2. В шаблоне записи «Этажи» откройте основную форму и выберите поле атрибута «**План**».
3. Выберите блок «**Связи**» на поле чертежа.

_![Настройка связей между слоями чертежа и шаблонами записи в приложении](https://kb.comindware.ru/assets/img_65d34dfa17eed.png)_
4. Настройте два уровня связей между слоями чертежа и шаблонами записей с помощью панели «**Свойства связей**»:

    - *Уровень 1*
    
    
        - **Шаблон записи:** *Помещения*. В этом шаблоне будут храниться записи, связанные с полигонами слоя *«Помещения»* на чертеже.
        - **Атрибут:** *ID помещения.* По этому ключевому атрибуту полигоны со слоя *«Помещения»* на чертеже будут привязаны к записям в шаблоне *«Помещения»* путем сопоставления   наименований полигонов со слоя *«ID помещений»* со значениями атрибута.
        - **Форма на чертеже:** *Помещения — Основная форма.*Эта форма будет отображаться в информационной панели для полигона, выбранного на чертеже.
        - **Форма для перехода:** *Помещения — Основная форма.* Эта форма будет отображаться при нажатии кнопки *«Перейти к записи»* в информационной панели для полигона, выбранного на чертеже.
    - *Уровень 2*
    
    
        - **Шаблон записи:** *Рабочие места.* В этом шаблоне будут храниться записи, связанные с полигонами слоя *«Рабочих мест»* на чертеже. Настройте его аналогично *Уровню 1.*
        - **Атрибут:** *ID рабочего места*
        - **Форма на чертеже:** *Рабочие места — Основная форма*
        - **Форма на чертеже:** *Рабочие места — Основная форма*
5. Выберите блок «**Маркеры**» на поле чертежа.

_![Настройка привязки маркеров на плане к записям в приложении и слоям чертежа](https://kb.comindware.ru/assets/img_65d34dccb80a0.png)_
6. Настройте привязку записей из шаблона *«Заявки»* к маркерам на плане с помощью панели «**Свойства маркеров**»:

    - **Шаблон записи:** *Заявки.* Записи этого   шаблона, будут отображаться как маркеры на плане.
    - **Форма для перехода:***Заявки — Основная форма.* Эта форма будет отображаться в информационной панели для маркера, выбранного на чертеже.
    - **Форма на** **чертеже:** *Заявки — Основная форма.* Эта форма будет отображаться при нажатии кнопки «**Перейти к записи**» в информационной панели на чертеже.
    - **Таблица:** *Все записи.* Эта таблица будет отображаться на вкладке «**Заявки**» слева от плана. Если для таблицы назначено [представление карточек][cards], то оно будет отображаться вместо таблицы.
    - **Привязка к слоям** — укажите для каждого уровня связи (слоя на чертеже) атрибут типа «**Запись**» из шаблона *«Заявки»*, ссылающийся на шаблон записи, заданный в **связях**. Маркеры будут привязаны к соответствующим слоям:
        - Слой *«Помещения»:* атрибут «*Помещение»*
        - Слой *«Рабочие места»: атрибут «**Рабочее место»*
7. Выберите блок «**Метаданные**» на поле чертежа.

_![Выбор атрибутов, задающих цвета полигонов на плане](https://kb.comindware.ru/assets/img_65d34d8f4cfb9.png)_
8. На панели «**Свойства метаданных**» оставьте установленными все флажки. Каждый флажок представляет атрибут типа «**Список значений**», задающий цвета полигонов, связанных с записями помещений и рабочих мест. Кроме того, с помощью вкладки «**Цвета**» слева от плана конечный пользователь сможет отфильтровать полигоны по значениям выбранных атрибутов.

    - Слой *«Помещения»:* установите флажок *«**Статус»*и *«*  *Вид»*
    - Слой *«**Рабочие места**»:* установите флажки *«**Статус»* и *«**Состояние»*
9. Создайте в шаблоне *«Этажи»* одну запись с *наименованием «Этаж 1»*.
10. Создайте и заполните записи в шаблонах *«Помещения»* и *«Рабочие места».* 

    - В каждой записи введите ID помещения или рабочего места, соответствующий текстовому идентификатору полигона в подготовленном DWG-файле.
    - Шаблон *«Помещения»* 
        - Создайте записи со следующими значениями атрибута *«ID помещения»*:
            - *Диспетчерская*
            - *Переговорная*
            - *Кабинет руководителя*
            - *Отдел продаж*
        - Для всех записей укажите *Этаж 1*.
        - Поля *«Статус»* и *«Вид»* заполните произвольными значениями.
    - Шаблон *«Рабочие места»* 
        - *С*оздайте записи со следующими значениями атрибута *«ID рабочего места»*:   
        
            - *Диспетчер 1*
            - *Диспетчер 2*
            - *Диспетчер 3*
            - *Стол для переговоров*
            - *Рабочее место руководителя 1*
            - *Специалист по продажам 1*
            - *Специалист по продажам 2*
            - *Специалист по продажам 3*
        - Для всех записей укажите *Этаж 1*.
        - Для каждого рабочего места, укажите соответствующее помещение.
        - Поля *«Статус»* и *«Состояние»* заполните произвольными значениями.
11. Создайте несколько записей в шаблоне *«Заявки»*, указав для них *этаж 1*, произвольное помещение, соответствующее помещению рабочее место и произвольный статус.
12. В поле *«План»* на форме записи *«Этаж 1»* нажмите кнопку «**Загрузка файла**».
13. С помощью мастера *«***Настройка плана***»* загрузите DWG-файл и привяжите слои полигонов и слои наименований на чертеже к шаблонам записи:

| Слой полигонов | Слой наименований | Шаблон записи | Атрибут |
| --- | --- | --- | --- |
| Помещения | ID помещений | Помещения | ID помещения |
| Рабочие места | ID рабочих мест | Рабочие места | ID рабочего места |

_![Привязка слоёв чертежа к шаблонам записей в приложении](https://kb.comindware.ru/assets/img_65d340950f4f2.png)_
14. Отобразится план *этажа 1*.
15. Поэкспериментируйте с планом: 
    - выбирайте полигоны и маркеры на плане;
    - просматривайте сведения об объектах и заявках в панели справа от чертежа;
    - выбирайте, скрывайте и отображайте слои, объекты и маркеры с помощью панели слева от чертежа.
    
    ![](https://kb.comindware.ru/assets/img_65d33fc96d221.png)
    
    
    
    
    Использование плана на форме

--8<-- "related_topics_heading.md"

**[Чертёж. Подготовка и импорт файла DWG][drawing_attribute_file_import]**

**[Чертёж. Настройка поля на форме][form_dynamic_elements]**



{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
