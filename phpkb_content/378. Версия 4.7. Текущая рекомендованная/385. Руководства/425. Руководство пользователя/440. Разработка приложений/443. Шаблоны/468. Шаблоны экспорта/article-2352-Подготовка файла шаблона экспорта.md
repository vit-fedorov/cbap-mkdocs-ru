---
title: Подготовка файла шаблона экспорта
kbId: 2352
---

# Подготовка файла шаблона экспорта

### Определения

- **Файл шаблона экспорта** представляет собой макет для выгрузки данных записи с требуемым визуальным оформлением.
- Файл шаблона можно сформировать в формате `DOCX` или `XLSX`.
- В файл шаблона экспорта необходимо вставить поля согласно определённому [синтаксису](#синтаксис-полей-шаблона-экспорта). Эти поля будут заменены на экспортируемые данные.

## Создание файла шаблона экспорта

1. Создайте документ Excel (`XLSX`) или Word (`DOCX`).
2. Введите в документ требуемые сведения.
3. Отформатируйте документ обычным образом.
4. Введите [поля](#mcetoc_1h1p7o4cm2) в те места документа, куда требуется экспортировать данные записи.
5. Должен получиться документ следующего вида (см. [пример](https://kb.comindware.ru/article.php?id=2353)):

[![Пример простейшего файла шаблона экспорта](https://kb.comindware.ru/assets/export_template_file_example.png)](https://kb.comindware.ru/assets/export_template_file_example.png)
Пример простейшего файла шаблона экспорта

## Синтаксис полей шаблона экспорта

В файле шаблона экспорта используются поля-заполнители. При экспорте данных записи поля заменяются значениями атрибутов, а остальной текст остаётся без изменений.

Синтаксис полей зависит от того, используется ли для экспорта данных [скрипт C#](#mcetoc_1h1p7o4cm4).

### Синтаксис для экспорта с использованием формул

- В документ введите поля вида `{AttributeSystemName}` ( *без пробелов* в фигурных скобках), где `AttributeSystemName` — системное имя атрибута, значение которого необходимо экспортировать в файл. Значение атрибута будет экспортировано в формате отображения, заданном в свойствах атрибута.
- `{RecordAttribute.LinkedTemplateAttribute}` — чтобы экспортировать значение атрибута связанного шаблона, укажите его системное имя через точку *без пробела* после системного имени атрибута типа «**Запись**».
- `{#LinkedTemplateAttribute}` — чтобы экспортировать значение атрибута типа «**Запись**» в виде гиперссылки на запись связанного шаблона, укажите системное атрибута с префиксом `#`. Гиперссылка будет содержать идентификатор или заголовок записи (если в шаблоне указан [атрибут-заголовок](https://kb.comindware.ru/article.php?id=2255)).
- `{foreach:RecordAttribute} {#LinkedAttribute1} {LinkedAttribute2} {end:RecordAttribute}` — для экспорта данных из нескольких записей связанного шаблона используйте операторы `foreach` и `end` в строке таблицы:

    - Строка таблицы с операторами `foreach` и `end` будет преобразована в несколько строк с данными записей связанного шаблона.
    - В первом столбце строки введите в фигурных скобках оператор `foreach` и через двоеточие *без пробела* системное имя атрибута типа «**Запись**».
    - В последнем столбце строки введите в фигурных скобках оператор `end` и через двоеточие *без пробела* системное имя атрибута типа «**Запись**»;
    - Между операторами `foreach` и `end` введите системные имена атрибутов связанного шаблона в фигурных скобках.
- **`{AttributeSystemName} полужирный текст`***`{AttributeSystemName2} курсив`* — между полями можно располагать произвольный текст. Текст и поля можно форматировать (курсивом, полужирным шрифтом и т. п.). Экспортируемые данные будут отформатированы соответствующим образом.
- `{ImageAttributeSystemName}` — если в поле указано системное имя атрибута типа «[**Изображение**][attribute_image]», поле будет заменено на изображение, хранящееся в атрибуте.
- `{QRCodeAttributeSystemName:200:100}` — если в поле указано системное имя атрибута типа «[**Штрихкод**][attribute_barcode]», поле будет заменено на изображение штрихкода, сформированного по значению атрибута. Для штрихкода можно указать ширину и высоту через двоеточие после системного имени атрибута. Если указать только ширину, то штрихкод будет квадратным. Если не указывать ширину и высоту, то будет использоваться стандартный размер штрихкода.

[![Пример синтаксиса полей шаблона экспорта](https://kb.comindware.ru/assets/export_template_file_advanced_syntax_example.png)](https://kb.comindware.ru/assets/export_template_file_advanced_syntax_example.png)
Пример синтаксиса полей шаблона экспорта

### Синтаксис для экспорта с использованием C#

Экспортировать данные посредством шаблона экспорта можно с помощью скрипта C#. Это позволяет более гибко настроить параметры экспорта, например с дополнительной фильтрацией, заменой информации, форматированным выводом [атрибутов типа «**Запись**»][attribute_record].

Скрипт C# для шаблона экспорта следует ввести на вкладке «**Скрипт**» [кнопки экспорта](https://kb.comindware.ru/article.php?id=2348), которая автоматически создаётся для каждого шаблона экспорта.

Примеры скриптов C# для экспорта данных см. в статьях *«[Настройка шаблона экспорта с использованием C#](https://kb.comindware.ru/article.php?id=1942)»*, и *«[Настройка выгрузки нескольких коллекций и изображений](https://kb.comindware.ru/article.php?id=1944)».*

При экспорте данных с помощью С# синтаксис полей шаблона экспорта различается в зависимости от формата файла шаблона экспорта:

#### Синтаксис для XLSX-файлов

- Скрипт C# должен передавать данные в функцию:

```
Api.TeamNetwork.ObjectAppExportService.ExecuteExcelExportTemplate("exportTemplate.N", dataToExport) 
```

Здесь:

    - `exportTemplate.N` — ID шаблона экспорта;
    - `dataToExport` — массив объектов с экспортируемыми данными.
- В ячейки введите поля вида `&=data.propertyName`.

    - Здесь `data` — массив экспортируемых данных, переданный скриптом C#.
    - `propertyName` — имя свойства элемента массива `data`, значение которого необходимо поместить в ячейку.
- В одной ячейке может быть только одно поле.
- Для корректного экспорта данных необходимо указать формат ячейки, соответствующий типу экспортируемого значения.
- Объявлять циклы `foreach` не требуется: для массивов строки на листе формируются автоматически.

**Внимание!**

    - Если поле обращается к свойству, имеющему тип массива (например, `LIST<T>`), то это свойство не может быть `null` и `undefined` (то есть массив обязательно должен быть объявлен), *в противном случае экспорт не будет выполнен*.
    - Например, если `&=data.Contract` имеет тип `LIST<T>`, то у каждого объекта в массиве `data` должно быть объявлено свойство `Contract`.

 

[![Пример XSLX-файла шаблона экспорта для C#](https://kb.comindware.ru/assets/export_template_file_c_syntax_example_xlsx.png)](https://kb.comindware.ru/assets/export_template_file_c_syntax_example_xlsx.png)
Пример XSLX-файла шаблона экспорта для C#

#### Синтаксис для DOCX-файлов

- Скрипт C# должен передавать данные в функцию:

```
Api.TeamNetwork.ObjectAppExportService.ExecuteWordExportTemplate("exportTemplate.N", dataToExport) 
```

Здесь:

    - `exportTemplate.N` — ID шаблона экспорта;
    - `dataToExport` — объект класса `RESULT`, содержащий экспортируемые данные.
- В документ введите поля вида `<<[propertyName]>>`, где `propertyName` — имя свойства объекта `dataToExport`, значение которого необходимо поместить в текст.
- Чтобы экспортировать массив данных, используйте в строке таблицы или абзаце следующую конструкцию:

```
<<foreach [row in dataArray]>><<[row.property0]>> <<[row.property1]>> ... <<[row.propertyN]>><</foreach>> 
```


или

```
<<foreach [in dataArray]>><<[property0]>> <<[property1]>> ... <<[propertyN]>><</foreach>> 
```


Здесь:
    - `foreach` — оператор цикла по массиву `dataArray`
    - `row` — переменная-итератор цикла (*необязательная*);
    - `dataArray` — имя массива, переданного в объекте `dataToExport`.
    - `property0`...`propertyN` — имена свойств элементов массива `dataArray`, значения которых необходимо поместить в текст.
- Чтобы экспортировать изображение, введите поле вида `<<image [imageData]>>`, где `imageData` — имя массива типа `byte` с данными изображения, переданного в объекте `dataToExport`.

[![Пример DOCX-файла шаблона экспорта для C#](https://kb.comindware.ru/assets/export_template_file_c_syntax_example_docx.png)](https://kb.comindware.ru/assets/export_template_file_c_syntax_example_docx.png)
Пример DOCX-файла шаблона экспорта для C#

## Использование шрифтов в шаблонах экспорта в формате PDF

Если в [свойствах шаблона экспорта][export_templates].

При формировании файлов PDF из шаблонов экспорта Сервер может подставлять произвольные шрифты с другим начертанием, что может привести к некорректному форматированию файлов PDF.

Это может быть связано с тем, что Сервере отсутствуют шрифты, которые используются в файле шаблона экспорта:

- На Сервере с Windows в некоторых случаях могут отсутствовать стандартные шрифты Times New Roman и Arial;
- На Сервере с Linux могут отсутствовать какие бы то ни было шрифты, либо могут использоваться шрифты, отличные от шрифтов Windows.

Набор шрифтов, доступных на Сервере, известен администратору операционной системы.

### Решение для Word

Чтобы файлы PDF правильно форматировались при экспорте, в файлы DOCX шаблонов экспорта следует внедрять шрифты:

1. В меню «**Файл**» выберите пункт «**Параметры**».
2. В окне «**Параметры Word**» перейдите на вкладку «**Сохранение**».
3. В разделе «**Сохранение качества при совместном использовании документа**»:
    - установите флажок «**Внедрить шрифты в файл**»;
    - снимите флажок «**Не внедрять обычные системные шрифты**».
4. Нажмите кнопку «**OK**».
5. Сохраните файл DOCX и используйте его в качестве шаблона экспорта.

### Решение для Excel

Чтобы файлы PDF правильно форматировались при экспорте из шаблонов экспорта в формате XSLX используйте один из двух подходов:

- установить шрифты, используемые в файле Excel, на сервер CBAP;
- установить шрифты с сервера CBAP в Windows и использовать их в файле Excel.

#### Вариант 1

1. Составьте список шрифтов, которые используются в файле Excel шаблона экспорта.
2. Выберите необходимые файлы шрифтов в папке `C:\Windows\Fonts` (требуется доступ администратора).
3. Создайте архив с файлами шрифтов, например, в своей папке `Downloads`.
4. Перенесите архив с шрифтами на сервер с экземпляром ПО CBAP.
5. Установите шрифты на сервер с экземпляром ПО CBAP.

#### Вариант 2

1. Соберите все шрифты на сервере CBAP:  

    - папка `C:\Windows\Fonts` — Windows
    - каталог `/usr/share/fonts` — Linux
2. Установите шрифты с сервера CBAP на компьютер, где вы редактируете файл Excel шаблона экспорта:
    - поместите шрифты в папку в папку `C:\Windows\Fonts`;  
    **или**
    - откройте каждый файл шрифта и нажмите в окне просмотра шрифта кнопку «**Установить**».
3. Используйте в файле Excel шаблона экспорта только шрифты, перенесённые с сервера CBAP.

## Связанные статьи

**[Пример настройки и использования шаблона экспорта авансового отчёта](https://kb.comindware.ru/article.php?id=2353)**

**[Настройка выгрузки нескольких коллекций и изображений](https://kb.comindware.ru/article.php?id=1944)**

**[Настройка шаблона экспорта с использованием C#](https://kb.comindware.ru/article.php?id=1942)**

**[Настройка шаблона экспорта][export_templates]**

**[Настройка кнопки экспорта](https://kb.comindware.ru/article.php?id=2348)**



 
{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
