<h1>Универсальный процесс согласования. Настройка шаблонов, процессов и сценария</h1><p>Зачастую в бизнес-процессах так или иначе присутствует блок согласования. Например, заявку на закупку нужно сперва согласовать, а затем направить на оценку и закупку; договор перед подписанием также проходит через процесс согласования. В основном, это один и тот же процесс, который можно переиспользовать. В данной статье будет предоставлен пример настройки универсального процесса согласования.</p>
<p><strong>1.</strong> Создайте шаблон записи «История согласований» со следующими атрибутами:</p>
<ul>
<li>Решение — атрибут с типом данных «Запись», связанный с шаблоном, где хранятся варианты решений для согласования;</li>
<li>Комментарий к решению — атрибут с типом данных «Текст»;</li>
<li>Ответ на запрос — атрибут с типом данных «Текст»;</li>
<li>Дата и время начала — атрибут с типом данных «Дата и время»;</li>
<li>Дата и время завершения — атрибут с типом данных «Дата и время»;</li>
<li>id объекта согласования — атрибут с типом данных «Текст»;</li>
<li>Название объекта согласования — атрибут с типом данных «Текст»;</li>
<li>Объект согласования — атрибут с типом данных «Текст» и форматом отображения «HTML-текст», вычисляемый по выражению: <strong><em>FORMAT("&lt;a href='/#Resolver/{0}' target='_blank'&gt;{1}&lt;/a&gt;", LIST($idobektasoglasovaniya,$Nazvanieobektasoglasovaniya))</em></strong>;</li>
<li>Инициатор — атрибут с типом данных «Аккаунт»;</li>
<li>Согласующий — атрибут с типом данных «Аккаунт»;</li>
<li>Статус — атрибут с типом данных «Запись», связанный с шаблоном, где хранятся статусы согласования;</li>
<li>Повторное согласование — атрибут с типом данных «Запись», связанный с шаблоном «История согласования», с взаимной связью по новому атрибуту «Изначальное согласование»;</li>
<li>История согласования — атрибут с типом данных «Запись», связанный с шаблоном «История согласования», несколько значений, вычисляемый по выражению: <em><strong>from a in db-&gt;Istoriyasoglasovanij where (a-&gt;idobektsoglasovaniya == $idobektsoglasovaniya) select a-&gt;id</strong></em>;</li>
<li>+ атрибуты с типом данных «Запись», связанные с шаблонами, где хранятся ваши мастер-данные (заявки, договоры, и т.д.), с взаимной связью по новому атрибуту «История согласования» (несколько значений).</li>
</ul>
<p><strong>2.</strong> В созданном шаблоне записи настройте формы для отображения по умолчанию, форму для задачи согласующему и форму для задачи инициатору.</p>
<p><strong>3.</strong> Настройте диаграмму процесса по образцу:</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Пример диаграммы процесса согласования" class="img-responsive" height="480" src="https://kb.comindware.ru/assets/2023-02-13_14h44_52.png" width="1227"/></p>
<p class="caption" style="font-size: 15px !important;">Пример диаграммы процесса согласования</p>
</div>
<p><strong>4. </strong>Добавьте сценарии на входе и выходе у первой задачи и настройте их.</p>
<p><strong>4.1.</strong> В сценарии на входе добавьте действие «Изменить значения атрибутов» и настройте его:</p>
<ul>
<li>Статус — воспользуйтесь функцией OBJECT, чтобы найти необходимый статус;</li>
<li>Дата и время начала — воспользуйтесь функцией NOW.</li>
</ul>
<p><strong>4.2. </strong>В сценарии на выходе добавьте действие «Изменить значения атрибутов» и настройте его:</p>
<ul>
<li>Статус — воспользуйтесь функцией OBJECT, чтобы найти необходимый статус;</li>
<li>Дата и время завершения — воспользуйтесь функцией NOW.</li>
</ul>
<p><strong>5. </strong>Таким же образом настройте изменение статуса строки истории согласования на других элементах процесса.</p>
<p><strong>6. </strong>Добавьте сценарии на входе в элемент вызова процесса и настройте его.</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Сценарий на входе" class="img-responsive" height="657" src="https://kb.comindware.ru/assets/2023-02-20_10h32_27.png" width="706"/></p>
<p class="caption" style="font-size: 15px !important;">Сценарий на входе</p>
</div>
<p><strong>6.1.</strong> Добавьте действие «Создать запись» и настройте его.</p>
<ul>
<li>В поле «Целевой шаблон записи» укажите шаблон записи, созданный в п.1;</li>
<li>В поле «Ссылка на новую запись» укажите ссылку на целевой шаблон записи в текущем («Повторное согласование»);</li>
<li>В поле «Операция со значениями» укажите «Добавить».</li>
</ul>
<p><strong>6.2.</strong> Добавьте действие «Изменить значения атрибутов» и настройте его. Настройте передачу данных из контекста изначального согласования в контекст новой строки истории согласования. В целом, нужно заполнить следующие поля:</p>
<ul>
<li>Согласующий — в это поле передайте значение из такого же атрибута из изначального согласования;</li>
<li>Инициатор — в это поле передайте значение из такого же атрибута из изначального согласования;</li>
<li>id объекта согласования — в это поле передайте значение из такого же атрибута из изначального согласования;</li>
<li>Название объекта согласования — в это поле передайте значение из такого же атрибута из изначального согласования;</li>
<li>Заявка — в это поле передайте значение из такого же атрибута из изначального согласования.</li>
</ul>
<div class="blue_note">Если согласующих несколько, то первым шагом добавьте действие «Цикл по объектам», в котороv укажите атрибут или выражение для поиска согласующих, задайте переменную, а в действии «Изменить значения атрибутов», замените поле «Согласующий» на созданную переменную (обращение к переменной начинается с <em><strong>$$</strong></em>).</div>
<p><strong>7. </strong>Настройте вызов процесса повторного согласования.</p>
<ul>
<li>В поле «Записи для запуска процесса» укажите атрибут «Повторное согласование»;</li>
<li>В поле «Шаблон вызываемого процесса» укажите процесс согласования, созданный в п. 3 (тот же процесс).</li>
</ul>
<p><strong>8. </strong>Настройте логику назначения задач, вынесите на задачи соответствующие формы из связанного шаблона записи, созданные в п. 2, и опубликуйте процесс.</p>
<p><strong>9.</strong> Перейдите в шаблон записи, где хранятся мастер-данные, например, заявки на закупку. На все необходимые формы вынесите атрибут «История согласования» и настройте отображение таблицы.</p>
<p><strong>10.</strong> Перейдите на диаграмму процесса, связанного с заявками на закупку. Добавьте вызов процесса.</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Диаграмма основного процесса" class="img-responsive" height="403" src="https://kb.comindware.ru/assets/2023-02-20_10h08_49.png" width="1060"/></p>
<p class="caption" style="font-size: 15px !important;">Диаграмма основного процесса</p>
</div>
<p><strong>11.</strong> Добавьте сценарий на входе в элемент вызова процесса и настройте его.</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Сценарий на входе" class="img-responsive" height="552" src="https://kb.comindware.ru/assets/2023-02-13_14h51_23.png" width="590"/></p>
<p class="caption" style="font-size: 15px !important;">Сценарий на входе</p>
</div>
<p><strong>11.1.</strong> Добавьте действие «Создать запись» и настройте его.</p>
<ul>
<li>В поле «Целевой шаблон записи» укажите шаблон записи, созданный в п.1;</li>
<li>В поле «Ссылка на новую запись» укажите ссылку на целевой шаблон записи в текущем («История согласования»);</li>
<li>В поле «Операция со значениями» укажите «Добавить».</li>
</ul>
<p><strong>11.2.</strong> Добавьте действие «Изменить значения атрибутов» и настройте его. Настройте передачу данных из контекста заявок в контекст строки истории согласования. В целом, нужно заполнить следующие поля:</p>
<ul>
<li>Согласующий — в это поле передайте значение из необходимого атрибута из заявки;</li>
<li>Инициатор — в это поле передайте значение из необходимого атрибута из заявки;</li>
<li>id объекта согласования — в это поле запишите id заявки с помощью функции FORMAT;</li>
<li>Название объекта согласования — в это поле передайте название заявки.</li>
</ul>
<p><strong>12.</strong> Настройте вызов процесса согласования.</p>
<ul>
<li>В поле «Записи для запуска процесса» укажите атрибут «История согласования»;</li>
<li>В поле «Шаблон вызываемого процесса» укажите процесс согласования, созданный в п. 3;</li>
<li>В поле «Выполнение экземпляров процесса» укажите параллельное или последовательное выполнение;</li>
<li>В поле «Условие запуска процесса» пропишите условие по типу: <em><strong>EMPTY($Status)</strong></em>, чтобы согласования запускались только по новым строкам истории согласования.</li>
</ul>
<p><strong>13.</strong> Настройте логику последующей развилки. Например, если в истории согласования нет ни одного отрицательного решения, значит заявка согласована. Можно также настроить отдельный атрибут и передавать в него значение при завершении каждого согласования.</p>
<p><strong>14.</strong> Опубликуйте процесс и протестируйте.</p>
<div class="blue_note">П. 9-14 можно повторить для всех мастер данных, где необходимо согласование.</div><h1>Универсальный процесс согласования. Настройка шаблонов, процессов и сценария</h1><p>Зачастую в бизнес-процессах так или иначе присутствует блок согласования. Например, заявку на закупку нужно сперва согласовать, а затем направить на оценку и закупку; договор перед подписанием также проходит через процесс согласования. В основном, это один и тот же процесс, который можно переиспользовать. В данной статье будет предоставлен пример настройки универсального процесса согласования.</p>
<p><strong>1.</strong> Создайте шаблон записи «История согласований» со следующими атрибутами:</p>
<ul>
<li>Решение — атрибут с типом данных «Запись», связанный с шаблоном, где хранятся варианты решений для согласования;</li>
<li>Комментарий к решению — атрибут с типом данных «Текст»;</li>
<li>Ответ на запрос — атрибут с типом данных «Текст»;</li>
<li>Дата и время начала — атрибут с типом данных «Дата и время»;</li>
<li>Дата и время завершения — атрибут с типом данных «Дата и время»;</li>
<li>id объекта согласования — атрибут с типом данных «Текст»;</li>
<li>Название объекта согласования — атрибут с типом данных «Текст»;</li>
<li>Объект согласования — атрибут с типом данных «Текст» и форматом отображения «HTML-текст», вычисляемый по выражению: <strong><em>FORMAT("&lt;a href='/#Resolver/{0}' target='_blank'&gt;{1}&lt;/a&gt;", LIST($idobektasoglasovaniya,$Nazvanieobektasoglasovaniya))</em></strong>;</li>
<li>Инициатор — атрибут с типом данных «Аккаунт»;</li>
<li>Согласующий — атрибут с типом данных «Аккаунт»;</li>
<li>Статус — атрибут с типом данных «Запись», связанный с шаблоном, где хранятся статусы согласования;</li>
<li>Повторное согласование — атрибут с типом данных «Запись», связанный с шаблоном «История согласования», с взаимной связью по новому атрибуту «Изначальное согласование»;</li>
<li>История согласования — атрибут с типом данных «Запись», связанный с шаблоном «История согласования», несколько значений, вычисляемый по выражению: <em><strong>from a in db-&gt;Istoriyasoglasovanij where (a-&gt;idobektsoglasovaniya == $idobektsoglasovaniya) select a-&gt;id</strong></em>;</li>
<li>+ атрибуты с типом данных «Запись», связанные с шаблонами, где хранятся ваши мастер-данные (заявки, договоры, и т.д.), с взаимной связью по новому атрибуту «История согласования» (несколько значений).</li>
</ul>
<p><strong>2.</strong> В созданном шаблоне записи настройте формы для отображения по умолчанию, форму для задачи согласующему и форму для задачи инициатору.</p>
<p><strong>3.</strong> Настройте диаграмму процесса по образцу:</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Пример диаграммы процесса согласования" class="img-responsive" height="480" src="https://kb.comindware.ru/assets/2023-02-13_14h44_52.png" width="1227"/></p>
<p class="caption" style="font-size: 15px !important;">Пример диаграммы процесса согласования</p>
</div>
<p><strong>4. </strong>Добавьте сценарии на входе и выходе у первой задачи и настройте их.</p>
<p><strong>4.1.</strong> В сценарии на входе добавьте действие «Изменить значения атрибутов» и настройте его:</p>
<ul>
<li>Статус — воспользуйтесь функцией OBJECT, чтобы найти необходимый статус;</li>
<li>Дата и время начала — воспользуйтесь функцией NOW.</li>
</ul>
<p><strong>4.2. </strong>В сценарии на выходе добавьте действие «Изменить значения атрибутов» и настройте его:</p>
<ul>
<li>Статус — воспользуйтесь функцией OBJECT, чтобы найти необходимый статус;</li>
<li>Дата и время завершения — воспользуйтесь функцией NOW.</li>
</ul>
<p><strong>5. </strong>Таким же образом настройте изменение статуса строки истории согласования на других элементах процесса.</p>
<p><strong>6. </strong>Добавьте сценарии на входе в элемент вызова процесса и настройте его.</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Сценарий на входе" class="img-responsive" height="657" src="https://kb.comindware.ru/assets/2023-02-20_10h32_27.png" width="706"/></p>
<p class="caption" style="font-size: 15px !important;">Сценарий на входе</p>
</div>
<p><strong>6.1.</strong> Добавьте действие «Создать запись» и настройте его.</p>
<ul>
<li>В поле «Целевой шаблон записи» укажите шаблон записи, созданный в п.1;</li>
<li>В поле «Ссылка на новую запись» укажите ссылку на целевой шаблон записи в текущем («Повторное согласование»);</li>
<li>В поле «Операция со значениями» укажите «Добавить».</li>
</ul>
<p><strong>6.2.</strong> Добавьте действие «Изменить значения атрибутов» и настройте его. Настройте передачу данных из контекста изначального согласования в контекст новой строки истории согласования. В целом, нужно заполнить следующие поля:</p>
<ul>
<li>Согласующий — в это поле передайте значение из такого же атрибута из изначального согласования;</li>
<li>Инициатор — в это поле передайте значение из такого же атрибута из изначального согласования;</li>
<li>id объекта согласования — в это поле передайте значение из такого же атрибута из изначального согласования;</li>
<li>Название объекта согласования — в это поле передайте значение из такого же атрибута из изначального согласования;</li>
<li>Заявка — в это поле передайте значение из такого же атрибута из изначального согласования.</li>
</ul>
<div class="blue_note">Если согласующих несколько, то первым шагом добавьте действие «Цикл по объектам», в котороv укажите атрибут или выражение для поиска согласующих, задайте переменную, а в действии «Изменить значения атрибутов», замените поле «Согласующий» на созданную переменную (обращение к переменной начинается с <em><strong>$$</strong></em>).</div>
<p><strong>7. </strong>Настройте вызов процесса повторного согласования.</p>
<ul>
<li>В поле «Записи для запуска процесса» укажите атрибут «Повторное согласование»;</li>
<li>В поле «Шаблон вызываемого процесса» укажите процесс согласования, созданный в п. 3 (тот же процесс).</li>
</ul>
<p><strong>8. </strong>Настройте логику назначения задач, вынесите на задачи соответствующие формы из связанного шаблона записи, созданные в п. 2, и опубликуйте процесс.</p>
<p><strong>9.</strong> Перейдите в шаблон записи, где хранятся мастер-данные, например, заявки на закупку. На все необходимые формы вынесите атрибут «История согласования» и настройте отображение таблицы.</p>
<p><strong>10.</strong> Перейдите на диаграмму процесса, связанного с заявками на закупку. Добавьте вызов процесса.</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Диаграмма основного процесса" class="img-responsive" height="403" src="https://kb.comindware.ru/assets/2023-02-20_10h08_49.png" width="1060"/></p>
<p class="caption" style="font-size: 15px !important;">Диаграмма основного процесса</p>
</div>
<p><strong>11.</strong> Добавьте сценарий на входе в элемент вызова процесса и настройте его.</p>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Сценарий на входе" class="img-responsive" height="552" src="https://kb.comindware.ru/assets/2023-02-13_14h51_23.png" width="590"/></p>
<p class="caption" style="font-size: 15px !important;">Сценарий на входе</p>
</div>
<p><strong>11.1.</strong> Добавьте действие «Создать запись» и настройте его.</p>
<ul>
<li>В поле «Целевой шаблон записи» укажите шаблон записи, созданный в п.1;</li>
<li>В поле «Ссылка на новую запись» укажите ссылку на целевой шаблон записи в текущем («История согласования»);</li>
<li>В поле «Операция со значениями» укажите «Добавить».</li>
</ul>
<p><strong>11.2.</strong> Добавьте действие «Изменить значения атрибутов» и настройте его. Настройте передачу данных из контекста заявок в контекст строки истории согласования. В целом, нужно заполнить следующие поля:</p>
<ul>
<li>Согласующий — в это поле передайте значение из необходимого атрибута из заявки;</li>
<li>Инициатор — в это поле передайте значение из необходимого атрибута из заявки;</li>
<li>id объекта согласования — в это поле запишите id заявки с помощью функции FORMAT;</li>
<li>Название объекта согласования — в это поле передайте название заявки.</li>
</ul>
<p><strong>12.</strong> Настройте вызов процесса согласования.</p>
<ul>
<li>В поле «Записи для запуска процесса» укажите атрибут «История согласования»;</li>
<li>В поле «Шаблон вызываемого процесса» укажите процесс согласования, созданный в п. 3;</li>
<li>В поле «Выполнение экземпляров процесса» укажите параллельное или последовательное выполнение;</li>
<li>В поле «Условие запуска процесса» пропишите условие по типу: <em><strong>EMPTY($Status)</strong></em>, чтобы согласования запускались только по новым строкам истории согласования.</li>
</ul>
<p><strong>13.</strong> Настройте логику последующей развилки. Например, если в истории согласования нет ни одного отрицательного решения, значит заявка согласована. Можно также настроить отдельный атрибут и передавать в него значение при завершении каждого согласования.</p>
<p><strong>14.</strong> Опубликуйте процесс и протестируйте.</p>
<div class="blue_note">П. 9-14 можно повторить для всех мастер данных, где необходимо согласование.</div>