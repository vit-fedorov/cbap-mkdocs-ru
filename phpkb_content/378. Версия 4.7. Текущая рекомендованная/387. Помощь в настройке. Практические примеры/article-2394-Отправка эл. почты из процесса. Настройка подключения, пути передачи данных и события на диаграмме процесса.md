---
title: Отправка эл. почты из процесса. Настройка подключения, пути передачи данных и события на диаграмме процесса
kbId: 2394
---

# Отправка эл. почты из процесса. Настройка подключения, пути передачи данных и события на диаграмме процесса

## Введение

На диаграмме процесса можно использовать [промежуточные][send_message_intermediate_event] и [конечные][send_message_end_event] события для отправки электронных писем с данными бизнес-процесса.

Такие письма могут содержать произвольные бизнес-данные, в отличие от системных уведомлений о пользовательских задачах.

Здесь представлены инструкции по настройке подключения, пути передачи данных и события на диаграмме для отправки эл. писем из процесса.

Подробный пример настройки приложения для обмена данными посредством эл. почты см. в статье *«[Пример: согласование заявлений по эл. почте. Настройка подключений, путей передачи данных и диаграммы процесса][process_email_configure]»*.

## Порядок настройки отправки эл. писем

1. [Настройте подключение](#настройка-подключения-типа-отправка-эл-почты-из-процесса) типа «**Отправка эл. почты из процесса**».
2. Для отправки писем из события на диаграмме процесса:

    - [Настройте путь передачи данных](#настройка-пути-передачи-данных-типа-отправка-эл-почты-из-процесса) типа «**Отправка эл. почты из процесса**».
    - [Настройте событие-отправку сообщения](#настройка-события-отправки-сообщения) на диаграмме процесса.
3. Для отправки писем с уведомлениями о пользовательских задачах:

    - В свойствах подключения «**Отправка эл. почты из процесса**» установите флажок «**Использовать по умолчанию**».
    - [Настройте путь передачи данных][task_notifications] типа «**Уведомления о задачах**».

## Настройка подключения типа «Отправка эл. почты из процесса»

Подключения типа «**Отправка эл. почты из процесса**» используются в **[промежуточных событиях-отправки сообщений][send_message_intermediate_event]**, **[конечных событиях-отправки сообщений][send_message_end_event]**.

1. На странице **[«Администрирование» — «Подключения»][administration]** создайте или откройте подключение типа «**Отправка эл. почты из процесса**».
2. Настройте свойства подключения:

    - **Отключить** — установите этот флажок, чтобы временно деактивировать подключение.
    - **Использовать по умолчанию** — установите этот флажок, чтобы использовать подключение для отправки [**уведомлений о пользовательских задачах**][task_notifications].
    - **Название** — введите наименование подключения.
    - **Протокол** — выберите протокол и параметры соединения с почтовым сервером:
    
    
        - **SMTP**
        
        
            - **Порт** — введите номер порта.
            - **Защита данных** — выберите протокол шифрования, который поддерживает почтовый сервер:
            
            
                - **Нет** — не использовать шифрование;
                - **SSL**;
                - **TLS**.
        - **Microsoft Exchange**
        
        
            - **Домен** — укажите домен для доступа к серверу Exchange.
            - **Версия** — выберите версию сервера Exchange.
    - **Адрес почтового сервера** — введите адрес почтового сервера.
    
    
    
    Примечание
    
    
    
        - Для **SMTP не** указывайте протокол (`SMTP`, `HTTPS`, `HTTP`).
        - Для **Exchange укажите** протокол (`HTTPS`, `HTTP`).
    - **Имя пользователя** — укажите учётную запись для подключения к почтовому серверу.
    - **Пароль** — введите пароль для подключения к почтовому серверу.
    - **Адрес отправителя** — введите адрес, от которого будут отправляться письма.
    - **Имя отправителя** — введите имя, от которого будут отправляться письма.
    
    
    
    Примечание
    
    
    Если **адрес** или **имя отправителя** не совпадает с адресом и именем, указанным в учётной записи, используемой для подключения к почтовому серверу, сервер должен поддерживать замену данных отправителя. В противном случае, почта не будет отправляться.
    - **Подтверждать адрес эл. почты** — установите этот флажок, чтобы почтовый сервер проверял существование адресов получателей эл. писем перед их отправкой. Сервер должен поддерживать эту функцию, в противном случае подключение не будет работать, если установлен данный флажок.
3. При необходимости проверьте соединение с сервером.

    - В разделе «**Тестовое соединение**» в поле «**Получатели**» введите адреса эл. почты через запятую.
    - Нажмите кнопку «**Отправить тестовое сообщение**».
    - Удостоверьтесь, что получателям пришло тестовое сообщение от настроенного отправителя.
4. Сохраните подключение.

_![Свойства подключения для отправки эл. почты](https://kb.comindware.ru/assets/outgoing_email_configure_connection.png)_

## Настройка пути передачи данных типа «Отправка эл. почты из процесса»

Пути передачи данных типа «**Отправка эл. почты из процесса**» используются в [промежуточных событиях-отправки сообщений][send_message_intermediate_event] и [конечных событиях-отправки сообщений][send_message_end_event].

Путь передачи данных для отправки эл. почты служит для преобразования и передачи данных из **{{ productName }}** в эл. письмо.

1. Откройте страницу «**Администрирование**»  — «**Архитектура**» или страницу «**Администрирование**» приложения.
2. Выберите пункт «[**Пути передачи данных**][communication_routes]» *‌*.
3. Откройте двойным нажатием в списке или создайте путь передачи данных типа «**Отправка эл. почты из процесса**».
4. Настройте свойства пути передачи данных.
5. Сохраните путь передачи данных.

### Основные свойства

На вкладке «**Основные свойства**» настройте параметры использования пути передачи данных.

- **Отключить** — установите этот флажок, чтобы временно деактивировать путь передачи данных.
- **Название** — введите наименование пути передачи данных.
- **Подключение** — выберите подключение для отправки почты.
- **Имя сообщения** — введите *уникальный* идентификатор сообщения, проходящего по данному пути передачи данных.
- **Приложение** — выберите приложение, в котором будет использоваться данный путь передачи данных.

_![Настройка основных свойств пути передачи данных для отправки эл. почты из процесса](https://kb.comindware.ru/assets/outgoing_email_configure.png)_

### Атрибуты сообщения

На вкладке «**Атрибуты сообщения**» настройте атрибуты, которые будут использоваться для передачи данных из процесса в эл. письмо. Эти атрибуты необходимо указать на вкладке «**[Свойства сообщения](#свойства-сообщения)**» пути передачи данных, а также необходимо присвоить им значения на вкладке «**Данные сообщения**» в свойствах [события-отправки сообщения](#настройка-события-отправки-сообщения).

- Нажмите кнопку «**Создать**», чтобы добавить атрибут.
- Введите наглядное **название** атрибута.
- Введите **системное имя** атрибута, оно будет использоваться в шаблоне эл. письма на вкладке «**Свойства сообщения**».
- Укажите **тип данных** атрибута в соответствии с данными, которые в него будут передаваться из процесса.
- Чтобы удалить атрибут, установите рядом с ним флажок и нажмите кнопку «**Удалить**».

_![Атрибуты сообщения — путь передачи данных для отправки эл. почты из процесса](https://kb.comindware.ru/assets/outgoing_email_configure_message_attributes.png)_

Атрибуты сообщения — путь передачи данных для отправки эл. почты из процесса

### Свойства сообщения

На вкладке «**Свойства сообщения**» настройте шаблон эл. письма с использованием атрибутов с вкладки «**Атрибуты сообщения**».

- **Список атрибутов, которые можно использовать при написании эл. письма**, содержит атрибуты с вкладки «**[Атрибуты сообщения](#атрибуты-сообщения)**».

Совет

    - Чтобы поместить значение атрибута сообщения в эл. письмо, введите его системное имя в фигурных скобках `{ }` в соответствующее поле письма.
    - В текстовые поля письма (адреса и имена отправителей и получателей, тема, текст сообщения, место встречи) можно вводить произвольный текст и несколько **атрибутов сообщений**.
    - Например, в поле «**Тема**» можно ввести строку:
    
    
    
    
    ```
    Уведомление «{Title}» от {Date} 
    ```
    
    
    Здесь: `{Title}` — атрибут сообщения, содержащий название уведомления, а `{Date}` — дата формирования уведомления.
- **Электронное письмо** содержит шаблон, в полях которого можно ввести статические значения и системные имена **атрибутов сообщения**. В шаблоне эл. письма предусмотрены перечисленные ниже поля.

    - **Адрес отправителя** — в этом поле можно указать адрес эл. почты отправителя, отличный от адреса отправителя, указанного в [свойствах подключения](#настройка-подключения-типа-отправка-эл-почты-из-процесса). Если оставить это поле пустым, то будет использоваться адрес отправителя, указанный в свойствах подключения.
    - **Имя отправителя** — в этом поле можно указать имя отправителя, отличный от адреса отправителя, указанного в [свойствах подключения](#настройка-подключения-типа-отправка-эл-почты-из-процесса).
    
    
    
    Примечание
    
    
    Если **адрес** или **имя отправителя** не совпадает с адресом и именем, указанным в учётной записи, используемой на [почтовом сервере для отправки почты](#настройка-подключения-типа-отправка-эл-почты-из-процесса), сервер должен поддерживать замену данных отправителя. В противном случае, почта не будет отправляться.
    - **Кому** — нажмите кнопку «**Создать**», чтобы добавить получателя письма.
    
    
        - **Для пользователя** — выберите **атрибут сообщения** типа «**Аккаунт**» или аккаунт получателя письма. Если заполнено поле «**Для пользователя**», **адрес получателя** и **имя получателя** заполняются автоматически.
        - **Адрес получателя** — введите адрес электронной почты или укажите **атрибут сообщения** типа «**Текст**», содержащий адрес эл. почты.
        - **Имя получателя** — введите имя получателя или укажите **атрибут сообщения** типа «**Текст**», содержащий имя получателя.
        - **Адрес для отправки копии**, **Адрес для отправки скрытой копии** — введите через точку с запятой адреса эл. почты получателей или укажите **атрибуты сообщения** типа «**Текст**», содержащие адреса эл. почты.
        - **Имя для отправки копии**, **Имя для отправки скрытой копии** — введите через точку с запятой имена получателей или укажите **атрибуты сообщения** типа «**Текст**», содержащие имена получателей.
        - **Тема** — введите тему письма или укажите **атрибут сообщения** типа «**Текст**», содержащий тему письма.
        - **Формат сообщения** — выберите формат тела эл. письма:
        
        
            - **Простой** — текст без форматирования (`Content-Type: text/plain`);
            - **Размеченный** — текст с HTML-разметкой (`Content-Type: text/html`);
            - **Простой и размеченный** — в тело письма будут включены и простой, и размеченный текст (`Content-Type: multipart/alternative`).
        - **Сообщение** — введите текст письма или укажите **атрибут сообщения** типа «**Текст**», содержащий текст письма.
        - **Прикрепленные файлы** — выберите **атрибут сообщения** типа «**Документ**», содержащий вложения в эл. письмо.
        - **Отправлять встречу** — установите этот флажок, чтобы отправлять вместе с эл. письмом встречу Outlook.
            - **Начало встречи** — выберите **атрибут сообщения** типа «**Дата и время**», содержащий дату и время начала встречи.
            - **Окончание встречи** — выберите **атрибут сообщения** типа «**Дата и время**», содержащий дату и время окончания встречи.
            - **Место встречи** — введите текст или укажите **атрибут сообщения** типа «**Текст**», содержащий название или, например, адрес места встречи.

_![Свойства сообщения — путь передачи данных для отправки эл. почты из процесса](https://kb.comindware.ru/assets/outgoing_email_configure_message_properties.png)_

## Настройка события-отправки сообщения

1. Поместите на диаграмму процесса [промежуточное][send_message_intermediate_event] или [конечное][send_message_end_event] событие-отправку сообщения.

_![События отправки сообщения на диаграмме процесса](https://kb.comindware.ru/assets/outgoing_email_configure_send_message_event.png)_
2. В [меню элемента][call_element_menu] события нажмите кнопку «**Свойства**» *‌*.
3. На вкладке «**Основные**» настройте [общие свойства элемента][process_diagram_element_common_properties].
4. На вкладке «**Дополнительные**» выберите путь передачи данных.

    - В разделе «**Место назначения**» выберите пункт «**Внешний сокет**».
    - С помощью раскрывающегося списка «**Использовать путь передачи данных**» выберите или создайте **[путь передачи данных](#настройка-пути-передачи-данных-типа-отправка-эл-почты-из-процесса)** типа «**Отправка эл. почты из процесса**»._![Выбор пути передачи данных для события-отправки сообщения](https://kb.comindware.ru/assets/outgoing_email_configure_send_message_event_advanced_properties.png)_
5. На вкладке «**Данные сообщения**» сопоставьте **[атрибуты сообщения](#атрибуты-сообщения)** с атрибутами **[шаблона записи][record_templates]**, связанного с шаблоном процесса, к которому относится диаграмма.

    - В столбце «**Значение**» укажите атрибут такого же типа, как **атрибут сообщения**, либо формулу, возвращающую значение соответствующего типа.
    - Значения указанных атрибутов **шаблона записи** будут присвоены **атрибутам сообщения** и переданы в [эл. письмо](#свойства-сообщения)._![Сопоставление атрибутов сообщения из пути передачи данных с данными процесса](https://kb.comindware.ru/assets/outgoing_email_configure_send_message_event_message_data.png)_
6. Опубликуйте процесс.

## Связанные статьи

**[Подключения. Типы, создание, настройка, удаление][connections]**

**[Пути передачи данных. Типы, создание, настройка, удаление][communication_routes]**

**[Диаграмма процесса][call_element_menu]**

**[Промежуточное событие-отправка сообщения][send_message_intermediate_event]**

**[Конечное событие-отправка сообщения][send_message_end_event]**

**[Общие уведомления. Настройка пути передачи данных, диаграммы процесса и глобальной конфигурации][common_notifications]**

**[Уведомления о задачах. Настройка пути передачи данных][task_notifications]**

**[Пример: согласование заявлений по эл. почте. Настройка подключений, путей передачи данных и диаграммы процесса][process_email_configure]**

**[Получение эл. почты с помощью сценариев через IMAP и Exchange. Настройка подключения, пути передачи данных и сценария][scenario_receive_email]** 

**[Отправка эл. почты из сценариев через SMTP и Exchange. Настройка подключения, пути передачи данных и сценария][scenario_send_email]**

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
