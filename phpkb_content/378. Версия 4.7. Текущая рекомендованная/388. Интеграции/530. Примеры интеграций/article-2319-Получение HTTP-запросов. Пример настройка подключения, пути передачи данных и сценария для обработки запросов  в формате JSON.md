---
title: Получение HTTP-запросов. Пример: настройка подключения, пути передачи данных и сценария для обработки запросов  в формате JSON
kbId: 2319
---

# Получение HTTP-запросов. Пример: настройка подключения, пути передачи данных и сценария для обработки запросов в формате JSON

## Введение

**{{ productName }}** может получать HTTP-запросы с помощью встроенного HTTP-адаптера.

В этой статье на примере сценария приема заказов мы разберем настройку получения и обработки HTTP-запроса в формате JSON.

Настройка для обработки XML и простого текста будет аналогичной.

## Исходные данные

Пример JSON-данных из запроса, поступающего в систему из внешней системы:

```
{   
    "ListZakazov": [   
        {   
            "Zakaz": {   
            "Client": "Петров",   
            "nomer": 54,   
            "tovar":"Яблоко"   
            }   
        },   
        {   
            "Zakaz": {   
            "Client": "Иванов",   
            "nomer": 60,   
            "tovar":"Банан"   
            }   
        },   
        {   
            "Zakaz": {   
            "Client": "Сидоров",   
            "nomer": 61,   
            "tovar":"Груша"   
            }   
        }   
    ]   
}
```

 
В приложении имеется шаблон записи «*Заказы*», с атрибутами:

- *Номер* — тип данных: **Число**
- *Клиент* — тип данных: **Текст**
- *Товар* — тип данных: **Текст**

Примечание

В данной статье не рассматривается поиск схожих данных и проверка на их наличие.

## Настройка подключения

**1.** Перейдите в раздел «**Администрирование**» — «**Инфраструктура**» — «**Подключения**». Нажмите кнопку «**Создать**» и выберите пункт «**Подключения REST и OData**» — «**Получение HTTP-запросов**».

_![Создание подключения](https://kb.comindware.ru/assets/json1.jpg)_

**2.** Настройте свойства нового подключения:

- **Системное имя** (на латинице) нового подключения;
- **Описание** — отображаемое название нового подключения;
- **Путь URI** — путь, на который будут поступать HTTP-запросы;
- **Формат данных** — **JSON**. Также поддерживаются **XML** и **простой текст**, но в этой статье рассматривается обработка данных в формате JSON.

**3.** Сохраните подключение.

## Настройка пути передачи данных

**1.** Перейдите в раздел **Администрирование — Инфраструктура — Пути передачи данных**. Нажмите кнопку «**Создать**» и выберите пункт  «**Подключения REST и OData**» — «**Получение HTTP-запросов**».

_![Создание пути передачи данных](https://kb.comindware.ru/assets/json2.png)_

**2.** В окне создания нового пути передачи данных укажите:

- **Подключение** — выберите ранее созданное [подключение](#mcetoc_1hiir1gg14).
- **Системное имя** (на латинице) нового пути передачи данных;
- **Описание** — наглядное наименование нового пути передачи данных.

**3.** Перейдите на вкладку «**Атрибуты сообщения**».

**Запрос** — здесь указывается данные JSON сопоставляются с атрибутами **Comindware Business Application Plaform**.

На данном этапе следует посмотреть структуру JSON-данных, поступающих в запросе, и разобрать их на атрибуты с указанием типов данных:

- *ListZakazov* — атрибут, который содержит в себе данные по всем заказам. **Тип** — **объект**;
- *Zakaz* — атрибут, который тоже в себе содержит данные по одному заказу. **Тип** — **объект**;
- *nomer* — атрибут, содержащий значение номера заказа. **Тип** — **число**;
- *Client* — атрибут, содержащий значение клиента заказа. **Тип** — **строка**;
- *tovar* — атрибут, содержащий значение товара заказа. **Тип** — **строка**.

**4.** Воссоздайте структуру входных данных JSON в таблице «**Запрос**» с помощью кнопки «**Добавить**».

Примечание

Чтобы создать в таблице дочерний атрибут, установите флажок у родительского атрибута и нажмите кнопку «**Добавить**».

_![Настройка запроса](https://kb.comindware.ru/assets/json3.jpg)_

**5.** При необходимости настройте **ответ** — здесь можно составить макет JSON, который будет ответом на запрос, и ответ с ошибкой — здесь можно составить макет JSON, который будет ответом на запрос, в котором произошла ошибка.

**6.** Перейдите на вкладку «**Интеграция**».

**7. Укажите ат****рибуты для десериализации данных**. В стандартном варианте следует указать `$` в обоих столбцах. Для поиска определенного атрибута используйте JSONPath. 

**8.** При необходимости укажите **атр****ибут для заголовков**, в котором будут содержаться все атрибуты заголовков запроса, **а****трибут для параметров запроса**, в котором будут содержаться все параметры запроса, и **а****трибут для тела запроса**, в котором будет содержаться всё тело запроса.

**9.** В поле «**Базовый путь для приема HTTP-запросов**» указан адрес, на который внешняя система должна отправлять запросы в **{{ productName }}**.

**10.** Сохраните путь передачи данных.

_![Настройка интеграции](https://kb.comindware.ru/assets/json4.png)_

## Настройка сценария для обработки полученного JSON запроса.

**1.** Перейдите на страницу «**Администрирование**» приложения. Откройте страницу «**Сценарии**». Нажмите кнопку «**Создать**». Введите название, системное имя сценария и нажмите кнопку «**Сохранить**».

_![Создание сценария](https://kb.comindware.ru/assets/json5.jpg)_

**2.** У начального события измените тип на «**Получение сообщения**» и настройте его. 

- Выберите шаблон записи, куда будут поступать основные данные;
- Выберите ранее созданные подключение и путь передачи данных;
- Задайте имя переменной (любое на латинице).

_![Настройка события](https://kb.comindware.ru/assets/json6.jpg)_

**3.** Добавьте действие «**Цикл по объектам**» и настройте его.

- Задайте имя переменной (в данном примере указана переменная `local`), в ней будет храниться объект итерации;
- Напишите выражение на языке N3, по которому система выберет нужные объекты для итерации.

```
@prefix session: <http://comindware.com/ontology/session#>.   
@prefix var: <http://comindware.com/ontology/session/variable#>.   
{   
    session:context var:request ?req. #request — переменная из первого блока, в которой находится разобранный JSON   
    ?req var:ListZakazov ?value. #ListZakazov - переменная, в которой находится массив объектов   
}
```

 

_![Настройка действия «Цикл по объектам»](https://kb.comindware.ru/assets/json7.jpg)_

**4.** Внутрь действия «**Цикл по объектам**» добавьте действие «**Создать запись**» и укажите   шаблон записи «Заказы». 

**5.** Внутрь действия «**Создать запись**» добавьте действие «**Изменить значения атрибутов**» и настройте его.

- Добавьте три атрибута (*Клиент, Товар* и *Номер*);
- Операцию со значениями у всех атрибутов укажите «**Заменить**»;
- Значением будет формула `$$local->Zakaz->Client` (для клиента), для остальных атрибутов будет такая же формула, только в конце в место `Client` будет название соответствующего атрибута JSON.

Переменная `$$local` — хранит значение текущего объекта итерации. Пример:

```
{   
  "Zakaz": {   
             "Client": "Петров",    
             "nomer": 54,    
             "tovar": "Яблоко"   
            }   
},
```

 
 
Переменная `$$local->Zakaz` будет содержать массив данных по заказу из текущего объекта итерации. Пример:

```
{   
  "Client": "Петров",   
  "nomer": 54,    
  "tovar": "Яблоко"   
}
```

 
Переменная `$$local->Zakaz->Tovar` будет данные информации о товаре по заказу из текущего объекта итерации. Пример:

```
"Яблоко"
```

_![Настройка действия «Изменить значения атрибутов»](https://kb.comindware.ru/assets/json8.jpg)_

**6.**Получившийся сценарий должен выглядеть следующим образом:

_![Сценарий обработки заказа](https://kb.comindware.ru/assets/json10.jpg)_

## Тестирование

**1.** Отправьте запрос из внешней системы в **{{ productName }}** на адрес, указанный в поле «**Базовый путь для приема HTTP-запросов**» в [свойствах пути передачи данных](#RequestURI).

**2.** Проверьте обработку запроса: должны быть созданы записи в шаблоне «*Заказы*», соответствующие полученному запросу, как показано на иллюстрации:

_![Полученные заказы](https://kb.comindware.ru/assets/json9.jpg)_

--8<-- "related_topics_heading.md"

**`![](https://kb.comindware.ru/images/marker.png)Настройка действий сценария {Article-ID:2149}`**



{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
