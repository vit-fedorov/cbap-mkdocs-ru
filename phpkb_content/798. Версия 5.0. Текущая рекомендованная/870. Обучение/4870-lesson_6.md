---
title: Урок 6. Усовершенствованный процесс
kbId: 4870
---

# Урок 6. Усовершенствованный процесс

## Введение

В ходе этого урока вы усовершенствуете процесс заказа автомобиля, используя созданные на предыдущем уроке шаблоны записей (реестры) (*Типы автомобилей, Автомобили, Затраты, Типы затрат*), — добавите возможность выбора типа машины из справочника во время оформления заявки и настроите учёт машин в гараже и отслеживание расходов.

**Предусловия:** пройден *[урок 5 «Структуры данных»][lesson_5]*.

**Расчётная продолжительность:** 100 мин.

Примечание

В данном уроке представлен продукт **{{ productName }}** версии 5.0, внешний вид страниц и меню в других версиях продукта может отличаться.

## Настройка выбора типа автомобиля при оформлении заявки

Добавим возможность выбора типа автомобиля для *Заказчика* при создании заявки. Для этого настроим основную форму заявки.

1. Перейдите к шаблону *«Заявки на автомобили»*.
2. Выберите вкладку «**Формы**».
3. Откройте конструктор формы *«Заявки на автомобили — Основная форма»*.
4. Перетащите на макет формы атрибут *«Тип автомобиля»*.
5. Сохраните форму.

_![Добавление атрибута «Тип автомобиля» на форму заявки на автомобиль](/platform/v5.0/tutorial/img/lesson_6_request_form_vehicle_type_add.png)_

## Настройка выбора автомобиля при выполнении рейса

Настроим форму для задачи *«Принять заявку»*, чтобы *Диспетчер гаража* мог выбрать машину для выполнения рейса.

1. Перейдите к диаграмме процесса *«Заказ автотранспорта»*.
2. Нажмите кнопку «**Редактировать**».
3. Выберите задачу *«Принять заявку»*.
4. В меню элемента нажмите кнопку «**Форма**» *‌*.

   ![Переход к настройке формы задачи «Принять заявку» на диаграмме процесса](/platform/v5.0/tutorial/img/lesson_6_process_accept_task_form.png)

   Переход к настройке формы задачи «Принять заявку» на диаграмме процесса
5. Разверните элемент *«Заявки на автомобиль»* на панели элементов.
6. Перетащите атрибут *«Автомобиль»* в область *«Принятие заявки»*.
7. Укажите для поля *«Автомобиль»* **режим доступа** «**Требовать ввод**».
8. Сохраните форму.

   ![Добавление атрибута «Автомобиль» на форму задачи «Принять заявку»](/platform/v5.0/tutorial/img/lesson_6_accept_task_form_vehicle_add.png)

   Добавление атрибута «Автомобиль» на форму задачи «Принять заявку»

## Настройка учёта затрат во время выполнения рейса

Бизнес-логика

Когда *Водитель* получит задачу *«Выполнить рейс»*, он должен увидеть номерной знак забронированного автомобиля.

Мы также дадим *Водителю* возможность добавить новый автомобиль в список и отслеживать затраты на поездку.

Для этого добавим раскрывающийся список *«Автомобиль»* и таблицу *«Затраты»* на форму задачи *«Выполнить рейс»*.

1. На диаграмме процесса выберите задачу *«Выполнить рейс»* и с помощью меню элемента перейдите к ее форме.
2. Разверните элемент *«Заявки на автомобиль»*.
3. Перетащите атрибуты *«Автомобиль»* и *«Затраты»* на область *«Выполнить рейс»*.
4. В панели свойств для поля *«Затраты»* выберите **представление** «**Таблица**».

   ![Добавление на форму задачи «Выполнить рейс» раскрывающегося списка «Автомобиль» и таблицы «Затраты»](/platform/v5.0/tutorial/img/lesson_6_driver_task_form_costs_car_add.png)

   Добавление на форму задачи «Выполнить рейс» раскрывающегося списка «Автомобиль» и таблицы «Затраты»
5. Разверните элемент *«Затраты»* на панели элементов.
6. Перетащите атрибуты *«Тип затрат»* и *«Сумма»* в таблицу *«Затраты»* на форме.
7. Выберите **область кнопок** таблицы *«Затраты»* и перетащите на нее из панели элементов кнопки «**Создать**», «**Редактировать**» и «**Перейти**». Это позволит пользователю создавать, редактировать и просматривать записи о затратах в таблице *«Затраты»* на форме.

   ![Добавление в таблицу на форме задачи «Выполнить рейс» атрибутов записи «Затраты»](/platform/v5.0/tutorial/img/lesson_6_driver_task_form_cost_type_add.png)

   Добавление в таблицу на форме задачи «Выполнить рейс» атрибутов записи «Затраты»

## Настройка атрибута «Итоговая сумма затрат»

Добавим в шаблон *«Заявки на автомобили»* атрибут, хранящий итоговую сумму затрат на рейс.

1. Нажмите кнопку «**Добавить атрибут**» у атрибута *«Заявки на автомобили»* в панели элементов.
2. Настройте **новый атрибут**:

   - **Название:** *Итоговая сумма затрат*
   - **Тип данных: число**
   - **Количество знаков после запятой: 2**

   ![Настройка атрибута «Итоговая сумма затрат» в шаблоне «Заявки на автомобили»](/platform/v5.0/tutorial/img/lesson_6_total_cost_attribute_configure.png)

   Настройка атрибута «Итоговая сумма затрат» в шаблоне «Заявки на автомобили»
3. Перетащите атрибут *«Итоговая сумма затрат»* в область *«Выполнить рейс»* под таблицу *«Затраты»*.
4. Сохраните форму задачи *«Выполнить рейс»*.
5. Вернитесь к диаграмме процесса, нажав кнопку «**Назад**» в браузере.
6. Опубликуйте диаграмму процесса.

Версии экземпляров процессов

Изменения на диаграмме процесса вступают в силу только после ее публикации.

При публикации создаётся новая версия диаграммы:

- Экземпляры процесса, запущенные по старой версии диаграммы, будут выполняться до конца по этой версии.
- Новые экземпляры процесса будут выполняться по новой версии диаграммы.

## Тестирование выбора автомобиля и учёта затрат

1. Перейдите на вкладку «**Свойства**» шаблона процесса *«Заказ автотранспорта»*.
2. Нажмите кнопку «**Перейти к экземплярам**».
3. В списке экземпляров процесса запустите новый процесс, нажав кнопку «**Создать**».
4. Заполните поля заявки и укажите тип автомобиля.
5. Нажмите кнопку «**Создать**».
6. Перейдите на страницу «**Мои задачи**» с помощью панели навигации слева.
7. Откройте задачу *«Заказ автотранспорта — Рассмотреть заявку»*
8. Установите флажок *«Заявка одобрена»*.
9. Завершите задачу.
10. Вернитесь на страницу «**Мои задачи**».
11. Откройте задачу *«Заказ автотранспорта — Принять заявку»*.
12. В поле *«Автомобиль»* выберите автомобиль из раскрывающегося списка.
13. Укажите в поле *«Принято» — «Да»* и завершите задачу.
14. Вернитесь на страницу «**Мои задачи**».
15. Откройте задачу *«Выполнить рейс»*.
16. Нажмите кнопку «**Создать**» в таблице *«Затраты»*.
17. Укажите сумму и тип затрат в таблице.
18. Нажмите кнопку «**Сохранить**».
19. Добавьте еще несколько записей в таблицу затрат.
20. Завершите задачу.

## Настройка добавления мастер-данных на лету

Реализуем для *Водителя* возможность ввода данных нового автомобиля перед выполнением рейса.

1. Вернитесь к диаграмме процесса *«Заказ автотранспорта»*.
2. Нажмите кнопку «**Редактировать**».
3. Перейдите к форме задачи *«Выполнить рейс»*.
4. Выберите поле *«Автомобиль»* на форме и в его свойствах установите флажок «**Создание записей**».
5. Укажите **форму** для создания записей: *«Автомобиль — Основная форма».*

   ![Настройка атрибута «Автомобиль» для создания записей на лету](/platform/v5.0/tutorial/img/lesson_6_driver_task_form_select_vehicle.png)

   Настройка атрибута «Автомобиль» для создания записей на лету
6. Сохраните форму задачи.
7. Опубликуйте диаграмму процесса.

Примечание

Установив флажок «**Создание записей**» в свойствах раскрывающегося списка, мы даём пользователю возможность создавать записи с помощью формы связанного шаблона.

Когда этот флажок установлен для поля *«Автомобиль»*, *Водитель* сможет добавить новый автомобиль «на лету».

## Тестирование добавления нового автомобиля перед выполнением рейса

1. Запустите процесс и пройдите его до задачи *«Выполнить рейс»*.
2. В форме задачи *«Выполнить рейс»* нажмите кнопку «**Создать**» в поле *«Автомобиль».*

   ![Создание автомобиля с помощью раскрывающегося списка на форме](/platform/v5.0/tutorial/img/lesson_6_vehicle_select.png)

   Создание автомобиля с помощью раскрывающегося списка на форме
3. Заполните поля отобразившейся формы и сохраните её.
4. Завершите задачу.

## Результаты

В ходе этого урока вы настроили для *Диспетчера гаража* форму задач и возможность выбора типа автомобиля, реализовали для *Водителя* возможность добавления нового автомобиля перед выполнением рейса и протестировали усовершенствованный процесс.

В [следующем уроке][lesson_7] вы настроите автоматическое вычисление номера, статуса и итоговой суммы затрат по заявке, а также фильтрацию при выборе типа автомобиля.

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
