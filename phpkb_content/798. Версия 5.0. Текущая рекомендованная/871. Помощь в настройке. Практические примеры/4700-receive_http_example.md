---
title: Получение HTTP-запросов. Пример: настройка подключения, пути передачи данных и сценария для обработки запросов  в формате JSON
kbId: 4700
---

# Получение HTTP-запросов. Пример: настройка подключения, пути передачи данных и сценария для обработки запросов в формате JSON

## Введение

**{{ productName }}** может получать HTTP-запросы с помощью встроенного HTTP-адаптера.

Здесь на примере сценария приема заказов мы разберем настройку получения и обработки HTTP-запроса в формате JSON.

Настройка для обработки XML и простого текста будет аналогичной.

## Исходные данные

Пример JSON-данных из запроса, поступающего в систему из внешней системы:

```
{
    "ListZakazov": [
        {
            "Zakaz": {
            "Client": "Петров",
            "Nomer": 54,
            "Tovar":"Яблоко"
            }
        },
        {
            "Zakaz": {
            "Client": "Иванов",
            "Nomer": 60,
            "Tovar":"Банан"
            }
        },
        {
            "Zakaz": {
            "Client": "Сидоров",
            "Nomer": 61,
            "Tovar":"Груша"
            }
        }
    ]
}
```

В приложении имеется шаблон записи *«Заказы»*, с атрибутами:

- *Номер* — тип данных: **Число**
- *Клиент* — тип данных: **Текст**
- *Товар* — тип данных: **Текст**

Примечание

Здесь не рассматривается поиск схожих данных и проверка на их наличие.

## Настройка подключения

1. Перейдите в раздел «**Администрирование**» — «**Инфраструктура**» — «**Подключения**». Нажмите кнопку «**Создать**» и выберите пункт «**Подключения REST и OData**» — «**Получение HTTP-запросов**».

_![Создание подключения](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json1.jpg)_
2. Настройте свойства нового подключения:

    - **Системное имя** (на латинице) нового подключения;
    - **Описание** — отображаемое название нового подключения;
    - **Путь URI** — путь, на который будут поступать HTTP-запросы;
    - **Формат данных** — **JSON**. Также поддерживаются **XML** и **простой текст**, но здесь рассматривается обработка данных в формате JSON.
3. Сохраните подключение.

## Настройка пути передачи данных

1. Перейдите в раздел **Администрирование — Инфраструктура — Пути передачи данных**. Нажмите кнопку «**Создать**» и выберите пункт «**Подключения REST и OData**» — «**Получение HTTP-запросов**».

_![Создание пути передачи данных](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json2.png)_
2. В окне создания нового пути передачи данных укажите:

    - **Подключение** — выберите ранее созданное [подключение](#настройка-подключения).
    - **Системное имя** (на латинице) нового пути передачи данных;
    - **Описание** — наглядное наименование нового пути передачи данных.
3. Перейдите на вкладку «**Атрибуты сообщения**».

**Запрос** — здесь указывается данные JSON сопоставляются с атрибутами **{{ productName }}**.

На данном этапе следует посмотреть структуру JSON-данных, поступающих в запросе, и разобрать их на атрибуты с указанием типов данных:

    - *ListZakazov* — атрибут, который содержит в себе данные по всем заказам. **Тип** — **объект**;
    - *Zakaz* — атрибут, который тоже в себе содержит данные по одному заказу. **Тип** — **объект**;
    - *Nomer* — атрибут, содержащий значение номера заказа. **Тип** — **число**;
    - *Client* — атрибут, содержащий значение клиента заказа. **Тип** — **строка**;
    - *Tovar* — атрибут, содержащий значение товара заказа. **Тип** — **строка**.
4. Воссоздайте структуру входных данных JSON в таблице «**Запрос**» с помощью кнопки «**Добавить**».

Примечание

Чтобы создать в таблице дочерний атрибут, установите флажок у родительского атрибута и нажмите кнопку «**Добавить**».

_![Настройка запроса](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json3.jpg)_
5. При необходимости настройте **ответ** — здесь можно составить макет JSON, который будет ответом на запрос, и ответ с ошибкой — здесь можно составить макет JSON, который будет ответом на запрос, в котором произошла ошибка.
6. Перейдите на вкладку «**Интеграция**».
7. Укажите **атрибуты для десериализации данных**. В стандартном варианте следует указать `$` в обоих столбцах. Для поиска определенного атрибута используйте JSONPath.
8. При необходимости укажите **атрибут для заголовков**, в котором будут содержаться все атрибуты заголовков запроса, **атрибут для параметров запроса**, в котором будут содержаться все параметры запроса, и **атрибут для тела запроса**, в котором будет содержаться всё тело запроса.
9. В поле «**Базовый путь для приема HTTP-запросов**» указан адрес, на который внешняя система должна отправлять запросы в **{{ productName }}**.
10. Сохраните путь передачи данных.

_![Настройка интеграции](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json4.png)_

## Настройка сценария для обработки полученного JSON-запроса

1. Перейдите на страницу «**Администрирование**» приложения. Откройте страницу «**Сценарии**». Нажмите кнопку «**Создать**». Введите название, системное имя сценария и нажмите кнопку «**Сохранить**».

_![Создание сценария](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json5.jpg)_
2. У начального события измените тип на «**Получение сообщения**» и настройте его.

    - Выберите шаблон записи, куда будут поступать основные данные;
    - Выберите ранее созданные подключение и путь передачи данных;
    - Задайте имя переменной (любое на латинице)._![Настройка события](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json6.jpg)_
3. Добавьте действие «**Повторять по количеству объектов**» и настройте его. - Задайте имя переменной (в данном примере указана переменная `local`), в ней будет храниться объект итерации; - Напишите выражение на языке N3, по которому система выберет нужные объекты для итерации.

```
@prefix session: <http://comindware.com/ontology/session#>.
@prefix var: <http://comindware.com/ontology/session/variable#>.
{
    session:context var:request ?req. #request — переменная из первого блока, в которой находится разобранный JSON
    ?req var:ListZakazov ?value. #ListZakazov - переменная, в которой находится массив объектов
}
```

_![Настройка действия «Повторять по количеству объектов»](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json7.jpg)_
4. Внутрь действия «**Повторять по количеству объектов**» добавьте действие «**Создать запись**» и укажите шаблон записи «Заказы».
5. Внутрь действия «**Создать запись**» добавьте действие «**Изменить значения атрибутов**».
6. В действии «**Изменить значения атрибутов**» на вкладке «**Дополнительно**» установите флажок «**Сбрасывать кэш значений**».
7. На вкладке «**Основные**» настройте следующие атрибуты::

| Атрибут | Операция со значениями | Значение |
| --- | --- | --- |
| *Клиент* | **Заменить** | **Формула:** `$$local—Zakaz—Client` |
| *Номер* | **Заменить** | **Формула:** `$$local—Zakaz—Nomer` |
| *Товар* | **Заменить** | **Формула:** `$$local—Zakaz—Tovar` |

Переменная `$$local` — хранит значение текущего объекта итерации. Пример:

```
{
"Zakaz": {
            "Client": "Петров",
            "Nomer": 54,
            "Tovar": "Яблоко"
            }
},
```

Переменная `$$local—Zakaz` содержит массив данных по заказу из текущего объекта итерации. Пример:

```
{
"Client": "Петров",
"Nomer": 54,
"Tovar": "Яблоко"
}
```

Переменная `$$local—Zakaz—Tovar` содержит данные о товаре по заказу из текущего объекта итерации. Пример:

```
"Яблоко"
```

_![Настройка действия «Изменить значения атрибутов»](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json8.jpg)_
8. Получившийся сценарий должен выглядеть следующим образом:

_![Сценарий обработки заказа](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json10.png)_

## Тестирование

1. Отправьте запрос из внешней системы в **{{ productName }}** на адрес, указанный в поле «**Базовый путь для приема HTTP-запросов**» в [свойствах пути передачи данных](#настройка-пути-передачи-данных).
2. Проверьте обработку запроса: должны быть созданы записи в шаблоне «*Заказы*», соответствующие полученному запросу, как показано на иллюстрации:

_![Полученные заказы](/platform/v5.0/administration/connections_communication_routes/rest_odata_connections/img/json9.jpg)_

--8<-- "related_topics_heading.md"

- *[Настройка действий сценария][scenarios]*


{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
