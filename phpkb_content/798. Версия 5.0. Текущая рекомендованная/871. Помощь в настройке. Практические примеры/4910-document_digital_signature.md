---
title: Документы с электронной подписью. Настройка сертификатов, приложения и использование
kbId: 4910
---

# Документы с электронной подписью. Настройка сертификатов, приложения и использование

## Введение

В этой статье представлены инструкции по настройке браузера конечного пользователя и приложения для подписания документов электронной подписью (ЭП) и по подписанию документов.

Для работы с ЭП необходимо:

- [настроить ПК конечного пользователя](#mcetoc_1hpgc8b6v1) — установить ПО КриптоПро CSPT, расширение КриптоПро для браузера и сертификаты для цифровых подписей;
- [настроить приложение](#mcetoc_1hpgbm68v0) в {{ productName }} для использования ЭП.

В статье представлен пример настройки приложения таким образом, чтобы текущий пользователь мог подписывать документы с помощью ЭП.

## Настройка ПК конечного пользователя

1. Установите расширение для браузера CryptoPro Extension for CAdES (КриптоПро ЭЦП Browser plug-in):
   <https://www.cryptopro.ru/products/cades/plugin>
2. Установите ПО КриптоПро CSPT:
   <https://cryptopro.ru/products/csp?csp=download>
3. Получите и установите сертификат с расширением `.cer`, используя параметры по умолчанию:

   ![Установка сертификата в формате .cer](https://kb.comindware.ru/assets/img_63330916d0ee5.png)

   Установка сертификата в формате .cer
4. Получите и установите закрытый сертификат с расширением `.pfx`, используя параметры по умолчанию:

   ![Установка закрытого сертификата в формате .pfx](https://kb.comindware.ru/assets/img_63341c8bd0462.png)

   Установка закрытого сертификата в формате .pfx

## Настройка приложения

1. В шаблоне записи для хранения подписанных документов (например, «*Документы*») создайте атрибут «*Подписанные договоры*» типа «**Документ**» с форматом отображения «**Документ с цифровой подписью**».

   ![Создание атрибута типа «Документ» с цифровой подписью](https://kb.comindware.ru/assets/img_63330abedcb02.png)

   Создание атрибута типа «Документ» с цифровой подписью
2. Поместите атрибут «*Подписанные договоры*» на форму, которая будет служить для загрузки и подписания документов ЭП.
3. В разделе «**Роли**» приложения откройте свойства роли, которая будет давать доступ на подписание документа.
4. На вкладке «**Разрешения**» перетащите атрибут «*Подписанные договоры*» в список ресурсов и установите для него флажок «**Использование кнопок**».

   ![Настройка роли для использования документов с ЭП](https://kb.comindware.ru/assets/img_63330e18f1d29.png)

   Настройка роли для использования документов с ЭП
5. В шаблоне «*Договоры*» создайте кнопку «*Добавить подписанта*»:
   - в поле «**Контекст операции**» выберите пункт «**Запись**»;
   - в поле «**Операция**» выберите пункт «**Пользовательское событие**»;
   - в поле «**Результат выполнения**» выберите пункт «**Обновить данные**».

     ![Создание кнопки «Добавить подписанта»](https://kb.comindware.ru/assets/img_63342330ef3e3.png)

     Создание кнопки «Добавить подписанта»
6. Поместите кнопку «*Добавить подписанта*» на ту же форму, на которую поместили атрибут «*Подписанные договоры*».

   ![Кнопка «Добавить подписанта» и атрибут «Подписанные договоры» на форме](https://kb.comindware.ru/assets/img_6334242d7e090.png)

   Кнопка «Добавить подписанта» и атрибут «Подписанные договоры» на форме
7. В разделе приложения «**Сценарии**» создайте сценарий «*Добавить подписанта*».

   Логика работы сценария

   Сценарий для кнопки подписания документа требуется для того, чтобы назначить подписантом документа текущего пользователя.

   Список разрешённых подписантов хранится в атрибуте *«Подписанты»* системного шаблона документа.

   Файл, прикреплённый к атрибуту типа «**Документ**» представляет собой запись в шаблоне документа.

   Соответственно, для подписания документа в данном примере сценарий записывать в атрибут *«Подписанты»* текущего документа идентификатор аккаунта текущего пользователя (вычисляемый с помощью функции `USER()`).
8. Настройте свойства начального события сценария «**Нажать кнопку**»:
   - в поле «**Контекстный шаблон выберите**» выберите шаблон «*Документы*»;
   - в поле «**Кнопка**» выберите созданную на [шаге 9](#step9) кнопку «*Добавить подписанта*».

     ![Настройка свойств события «Нажатие кнопки» в сценарии](https://kb.comindware.ru/assets/img_633424ef7f1a5.png)

     Настройка свойств события «Нажатие кнопки» в сценарии
9. Добавьте в сценарий действие «**Сменить контекст**».
10. В свойствах блока «**Сменить контекст**» в поле «**Целевой шаблон**» выберите пункт «**Шаблон документа**» и атрибут «*Подписанные договоры*».

    ![Настройка свойств события «Сменить контекст» в сценарии](https://kb.comindware.ru/assets/img_6334252026f9c.png)

    Настройка свойств события «Сменить контекст» в сценарии
11. Добавьте внутрь действия «**Сменить контекст**» действие «**Изменить значения атрибутов**».
12. Настройте свойства блока «**Изменить значения атрибутов**»:
    - нажмите кнопку «**Создать**»;
    - в столбце «**Атрибут**» выберите атрибут «**Подписанты**»;
    - в столбце «**Операция со значениями**» выберите пункт «**Заменить**»;
    - в столбце «**Значение**» выберите пункт «**Формула**» и введите формулу: `USER()`

      ![Настройка свойств события «Изменить значения атрибутов» в сценарии](https://kb.comindware.ru/assets/img_633424a369e98.png)

      Настройка свойств события «Изменить значения атрибутов» в сценарии
13. Должен получиться показанный ниже сценарий:

    ![Сценарий для подписания документа ЭП по нажатию кнопки](https://kb.comindware.ru/assets/img_63342583e522c.png)

    Сценарий для подписания документа ЭП по нажатию кнопки
14. На этом настройка приложения для использования документов с ЭП завершена.

## Подписание документа

1. Создайте новую запись в шаблоне «*Документы*».
2. Добавьте документ для подписания, нажав кнопку «**Добавить документ**».

   ![Добавление документа для подписания](https://kb.comindware.ru/assets/img_63342801ce457.png)

   Добавление документа для подписания
3. Нажмите кнопку «*Поставить подписанта*».
4. Сохраните запись, нажав кнопку «**Сохранить**».
5. Обновите страницу в браузере.
6. Рядом с названием документа появится кнопка «**Подписать**».

   ![Добавление подписанта для документа](https://kb.comindware.ru/assets/img_633429e15bc05.png)

   Добавление подписанта для документа
7. Нажмите кнопку «**Подписать**».
8. Отобразится окно «**Подписание**».
9. Выберите сертификат.
10. Нажмите кнопку «**Подписать**».

    ![Выбор сертификата для подписания документа](https://kb.comindware.ru/assets/img_65fc25f9d781a.png)

    Выбор сертификата для подписания документа
11. Подтвердите операцию с ЭП для веб-сайта и при необходимости введите пароль.

    ![Подтверждение операции с ЭП](https://kb.comindware.ru/assets/img_63342cf0954aa.png)

    Подтверждение операции с ЭП
12. Документ будет подписан ЭП и рядом с его названием отобразятся статус «**Документ подписан**» и дата подписания.

    ![Представление подписанного документа](https://kb.comindware.ru/assets/img_65fc271adfbdb.png)

    Представление подписанного документа
13. Чтобы подписать документ с помощью другого сертификата, нажмите кнопку «**Отозвать подпись**» и подпишите документ заново.
14. При необходимости загрузите подпись в виде файла формата SIGN, нажав кнопку «**Скачать подпись**».
15. Чтобы просмотреть подробную информацию о документе и подписи, нажмите кнопку «**Перейти к форме**».
16. Отобразится форма с информацией о документе и подписях для него, также содержащая сам подписанный документ.

    ![Форма со сведениями о документе, подписанном ЭП](https://kb.comindware.ru/assets/img_63342e3a80378.png)

    Форма со сведениями о документе, подписанном ЭП

{% include-markdown ".snippets/hyperlinks_mkdocs_to_kb_map.md" %}
