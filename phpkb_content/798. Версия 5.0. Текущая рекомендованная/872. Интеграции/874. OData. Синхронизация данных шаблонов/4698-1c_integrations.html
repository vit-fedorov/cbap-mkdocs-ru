<h1>Интеграция с 1С по OData. Настройка для импорта данных</h1><div class="mce-toc">
<h2 class="toc-heading">Содержание</h2>
<ul>
<li><a href="#mcetoc_1horl73u20">Введение</a></li>
<li><a href="#mcetoc_1horl83ln1">Настройка подключения</a></li>
<li><a href="#mcetoc_1horlb9fd2">Настройка интеграции</a></li>
<li><a href="#mcetoc_1hd6l4lq42">Связанные статьи</a></li>
</ul>
</div>
<h2 id="mcetoc_1horl73u20">Введение</h2>
<p>В <strong>Comindware</strong> <strong>Business</strong> <strong>Application</strong> <strong>Platform</strong> можно настраивать интеграции с внешними службами посредством OData без помощи разработчиков — силами аналитика. Для этого достаточно настроить подключение к внешней службе и сопоставление атрибутов между приложением и внешней службой.</p>
<p>После настройки интеграции синхронизацию данных между приложением и внешней службой можно запускать как вручную, так и автоматически.</p>
<p>В этой статье представлен пример настройки интеграции с 1С.</p>
<h2 id="mcetoc_1horl83ln1">Настройка подключения</h2>
<ol class="colored_numbers_list">
<li>
<p>Создайте новое <a href="https://kb.comindware.ru/article\.php\?id=4702">подключение для <strong>синхронизации с веб-сервисом</strong></a>.</p>
</li>
<li>
<p>Настройте свойства подключения:</p>
<ul>
<li><strong>Название </strong>— наглядное наименование подключения, например <em>1С</em>.</li>
<li><strong>Тип исходящего подключения</strong><strong> </strong>— <strong>OData</strong>.</li>
<li><strong>Адрес веб-сервиса</strong> — введите URL-адрес OData-сервера 1C.</li>
<li><strong>Тип аутентификации</strong> — <strong>Обычная</strong>.
<ul>
<li><strong>Имя пользователя</strong> — введите логин для подключения к OData-серверу 1C.</li>
<li><strong>Пароль</strong> — введите пароль для подключения к OData-серверу 1C.</li>
</ul>
</li>
<li><strong>Версия </strong><strong>OData</strong> — выберите версию протокола OData, которую поддерживает OData-сервер 1C, например V3.</li>
<li><strong>Заголовок</strong><strong> </strong>— при необходимости введите заголовки HTTP-запроса к OData-серверу 1C.</li>
</ul>
</li>
<li>Нажмите кнопку «<strong>Проверить соединение</strong>».</li>
<li>В случае успешного соединения в области «<strong>Результаты</strong>» отобразится список справочников из базы данных 1С. В случае неуспешного соединения — сообщение «<strong>Произошла ошибка</strong>». В таком случае проверьте правильность введенных данных и наличие прав на доступ к службе 1С у пользователя, под которым настраиваете аутентификацию.</li>
<li>Сохраните подключение. <br/>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Настройка подключения к OData-сервису" class="img-responsive" height="795" src="https://kb.comindware.ru/assets/3.1_2021-12-16_183857.png" width="1183"/></p>
<p class="caption" style="font-size: 15px !important;">Настройка подключения к OData-сервису</p>
</div>
</li>
</ol>
<h2 id="mcetoc_1horlb9fd2"><span style="letter-spacing: 0.2px;">Настройка интеграции</span></h2>
<ol class="colored_numbers_list">
<li><span style="letter-spacing: 0.2px;">Откройте приложение, в котором будете настраивать интеграцию</span></li>
<li><span style="letter-spacing: 0.2px;">Выберите пункт «</span><strong style="letter-spacing: 0.2px;">Интеграции</strong><span style="letter-spacing: 0.2px;">». </span>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Расположение раздела «Интеграции»" class="img-responsive" height="508" src="https://kb.comindware.ru/assets/3.2_2021-12-20_162559.png" width="953"/></p>
<p class="caption" style="font-size: 15px !important;">Расположение раздела «Интеграции»</p>
</div>
</li>
<li><span style="font-size: 11.5pt; font-family: 'Arial',sans-serif; color: #545764; letter-spacing: .15pt;">Нажмите кнопку «<strong>Создать</strong>».</span></li>
<li><span style="font-size: 11.5pt; font-family: 'Arial',sans-serif; color: #545764; letter-spacing: .15pt;">Отобразится окно свойств интеграции.</span></li>
<li><span style="font-size: 11.5pt; font-family: 'Arial',sans-serif; color: #545764; letter-spacing: .15pt;"> Настройте параметры на вкладке «<strong>Основные настройки</strong>»: </span>
<ul>
<li><strong>Название </strong>— введите наглядное название интеграции, например <em>«Номенклатурные объекты»</em>.</li>
<li><strong>Подключение по </strong><strong>OData</strong> — выберите ранее созданное подключение для синхронизации с веб-сервисом, например <em>«1С»</em>.</li>
<li><strong>Тип</strong><strong> </strong>— <strong>Импорт</strong>.</li>
<li><strong>Шаблон записи</strong> — шаблон записи, в который будут импортироваться данные, например <em>«(1С) Номенклатура. Объекты»</em>.</li>
<li><strong>Внешняя сущность</strong> — источник данных, из которого будут импортироваться данные в шаблон, например <em>«Catalog_Номенклатура»</em>.</li>
<li><strong>Какие объекты синхронизировать</strong> — <strong>Все</strong>.</li>
<li><strong>Тип запуска</strong> — <strong>Вручную</strong>.</li>
<li><strong>Преобразование атрибутов</strong> — настройте сопоставление атрибутов между <strong>шаблоном записи</strong> и <strong>внешней сущностью</strong>:
<ul style="list-style-type: circle;">
<li><strong>Внутренние данные</strong> — укажите атрибуты шаблона записи, в которые будут записываться импортируемые данные;</li>
<li><strong>Внешние данные</strong> — укажите атрибут <strong>внешней сущности</strong>, из которых будут импортироваться данные (в нашем примере это поля справочника <em>«Catalog_Номенклатура»</em>);</li>
<li><strong>Ключевое свойство</strong> — укажите пару атрибутов, являющихся первичными ключами (primary_key). Если при импорте записи совпадут значения этих атрибутов в имеющейся записи в шаблоне и в импортируемой записи, то запись в шаблоне будет обновлена импортируемыми данными. В противном случае в шаблоне будет создана новая запись с импортированными данными.
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Настройка основных свойств интеграции в приложении" class="img-responsive" height="884" src="https://kb.comindware.ru/assets/3.3_2021-12-20_143746.png" width="1183"/></p>
<p class="caption" style="font-size: 15px !important;">Настройка основных свойств интеграции в приложении</p>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><span style="letter-spacing: 0.2px;">Настройте параметры вкладку «</span><strong style="letter-spacing: 0.2px;">Настройки импорта</strong><span style="letter-spacing: 0.2px;">». Заполните следующие данные: </span>
<ul>
<li><strong>Зависит от</strong> — выберите другую интеграцию, синхронизацию по которой необходимо запускать перед текущей интеграцией. В нашем примере выбрана интеграция <em>«Единица изм.»</em>, потому что в записях в шаблоне <em>«(1С) Номенклатура. Объекты» </em>указаны единицы измерения и их необходимо актуализировать перед импортом данных.</li>
<li><strong>Добавить новую настройку постпроцессинга</strong> — нажмите эту кнопку, чтобы настроить устанавливать значения в атрибутах типа «<strong>Запись</strong>» посредством сопоставления значений ключевых атрибутов в импортируемых записях и связанных записях.</li>
<li><strong>Целевой атрибут </strong>— выберите атрибут типа «<strong>Запись</strong>» к которому требуется привязать имеющиеся записи из связанного шаблона, например «<em>Ед.Изм.</em>».</li>
<li><strong>Атрибут в выбранном шаблоне</strong> — выберите атрибут из шаблона записи, связанного с атрибутом <em>«Ед.изм.»</em>, в котором хранятся уникальные значения, с которыми будут сравниваться значения <strong>атрибута в ссылочном шаблоне</strong>;</li>
<li><strong>Атрибут в ссылочном шаблоне</strong><em> </em>— выберите атрибут из шаблона «<em>1С_Номенклатуры.Объекты</em>», в который будут импортироваться уникальные идентификаторы единиц измерения из базы данных 1C.
<div class="notice notice-warning">
<p class="admonition-title">Логика постпроцессинга</p>
<p>Постпроцессинг позволяет привязать импортируемые записи к имеющимся записям в связанном шаблоне.</p>
<p>В таблице «<strong>Преобразование атрибутов</strong>» необходимо выбрать ключевые атрибуты связанных шаблонов записи, содержащие уникальные идентификаторы записей, которые требуется связать между собой посредством <strong>целевого атрибута</strong>.</p>
<p>Эти значения будут сравниваться при импорте записей. Если значения ключевых атрибутов в импортируемой записи и в имеющейся записи связанного шаблона совпадут, то эти записи будут связаны посредством выбранного <strong>целевого атрибута</strong>.</p>
</div>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Настройки импорта данных из 1C" class="img-responsive" height="919" src="https://kb.comindware.ru/assets/3.4_2021-12-20_153936.png" width="1183"/></p>
<p class="caption" style="font-size: 15px !important;">Настройки импорта данных из 1C</p>
</div>
</li>
</ul>
</li>
<li><span style="letter-spacing: 0.2px;">Сохраните интеграцию</span><span style="letter-spacing: 0.2px;">. </span></li>
<li><span style="letter-spacing: 0.2px;">В списке интеграций установите флажок выбора у настроенной интеграции и нажмите «</span><strong style="letter-spacing: 0.2px;">Запуск синхронизации</strong><span style="letter-spacing: 0.2px;">».</span></li>
<li><span style="letter-spacing: 0.2px;">Затем перейдите в журналы, откройте таблицу «</span><strong style="letter-spacing: 0.2px;">Интеграция по OData</strong><span style="letter-spacing: 0.2px;">».</span></li>
<li><span style="letter-spacing: 0.2px;">При неудачных интеграциях ознакомьтесь с логами для более детальной информации об ошибках.</span></li>
</ol>
<div class="screenshot_with_caption" style="font-size: 15px !important;">
<p><img alt="Журнал сеансов интеграции по OData" class="img-responsive" height="676" src="https://kb.comindware.ru/assets/2022-02-15_09h13_27.png" width="1350"/></p>
<p class="caption" style="font-size: 15px !important;">Журнал сеансов интеграции по OData</p>
</div>
<h2 id="mcetoc_1hd6l4lq42">Связанные статьи</h2>
<p><strong><samp data-name="aid" data-title="" data-value="4702"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Подключение для синхронизации с веб-сервисом {Article-ID:4702}</span></samp> </strong></p>
<p class="caption" style="font-size: 15px !important;"><strong><samp data-name="aid" data-title="" data-value="4697"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Интеграция по OData {Article-ID:4697}</span></samp> </strong></p>
<p class="caption" style="font-size: 15px !important;"><strong><samp data-name="aid" data-title="" data-value="4673"><span style="color: #0066bc; font-family: Tahoma;"><img src="https://kb.comindware.ru/images/marker.png" style="vertical-align: middle;"/>Журналы событий {Article-ID:4673}</span></samp> </strong></p>
<p><a class="md-top md-icon mkdocs_imported_link" href="#"> <em class="fa-light fa-arrow-up">‌</em> К началу </a></p>
<p> </p>